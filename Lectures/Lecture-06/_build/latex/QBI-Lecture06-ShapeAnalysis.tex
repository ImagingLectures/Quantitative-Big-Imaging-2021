%% Generated by Sphinx.
\def\sphinxdocclass{report}
\documentclass[letterpaper,10pt,english]{sphinxmanual}
\ifdefined\pdfpxdimen
   \let\sphinxpxdimen\pdfpxdimen\else\newdimen\sphinxpxdimen
\fi \sphinxpxdimen=.75bp\relax

\PassOptionsToPackage{warn}{textcomp}
\usepackage[utf8]{inputenc}
\ifdefined\DeclareUnicodeCharacter
% support both utf8 and utf8x syntaxes
  \ifdefined\DeclareUnicodeCharacterAsOptional
    \def\sphinxDUC#1{\DeclareUnicodeCharacter{"#1}}
  \else
    \let\sphinxDUC\DeclareUnicodeCharacter
  \fi
  \sphinxDUC{00A0}{\nobreakspace}
  \sphinxDUC{2500}{\sphinxunichar{2500}}
  \sphinxDUC{2502}{\sphinxunichar{2502}}
  \sphinxDUC{2514}{\sphinxunichar{2514}}
  \sphinxDUC{251C}{\sphinxunichar{251C}}
  \sphinxDUC{2572}{\textbackslash}
\fi
\usepackage{cmap}
\usepackage[T1]{fontenc}
\usepackage{amsmath,amssymb,amstext}
\usepackage{babel}



\usepackage{times}
\expandafter\ifx\csname T@LGR\endcsname\relax
\else
% LGR was declared as font encoding
  \substitutefont{LGR}{\rmdefault}{cmr}
  \substitutefont{LGR}{\sfdefault}{cmss}
  \substitutefont{LGR}{\ttdefault}{cmtt}
\fi
\expandafter\ifx\csname T@X2\endcsname\relax
  \expandafter\ifx\csname T@T2A\endcsname\relax
  \else
  % T2A was declared as font encoding
    \substitutefont{T2A}{\rmdefault}{cmr}
    \substitutefont{T2A}{\sfdefault}{cmss}
    \substitutefont{T2A}{\ttdefault}{cmtt}
  \fi
\else
% X2 was declared as font encoding
  \substitutefont{X2}{\rmdefault}{cmr}
  \substitutefont{X2}{\sfdefault}{cmss}
  \substitutefont{X2}{\ttdefault}{cmtt}
\fi


\usepackage[Bjarne]{fncychap}
\usepackage[,numfigreset=1,mathnumfig]{sphinx}

\fvset{fontsize=\small}
\usepackage{geometry}


% Include hyperref last.
\usepackage{hyperref}
% Fix anchor placement for figures with captions.
\usepackage{hypcap}% it must be loaded after hyperref.
% Set up styles of URL: it should be placed after hyperref.
\urlstyle{same}


\usepackage{sphinxmessages}




\title{Quantitative Big Imaging - Shape Analysis}
\date{Apr 01, 2021}
\release{}
\author{Anders Kaestner}
\newcommand{\sphinxlogo}{\vbox{}}
\renewcommand{\releasename}{}
\makeindex
\begin{document}

\pagestyle{empty}
\sphinxmaketitle
\pagestyle{plain}
\sphinxtableofcontents
\pagestyle{normal}
\phantomsection\label{\detokenize{preface::doc}}


\sphinxAtStartPar
This is the lecture notes fot the 6th lecture of the Quantitative big imaging class given during the spring semester 2021 at ETH Zurich, Switzerland.


\chapter{Shape analysis}
\label{\detokenize{06-ShapeAnalysis:shape-analysis}}\label{\detokenize{06-ShapeAnalysis::doc}}





\section{Previously on QBI …}
\label{\detokenize{06-ShapeAnalysis:previously-on-qbi}}

\begin{itemize}
\item {} 
\sphinxAtStartPar
Highlighting the contrast of interest

\item {} 
\sphinxAtStartPar
Minimizing Noise



\item {} 
\sphinxAtStartPar
Understanding value histograms

\item {} 
\sphinxAtStartPar
Dealing with multi\sphinxhyphen{}valued data



\item {} 
\sphinxAtStartPar
Hysteresis Method

\item {} 
\sphinxAtStartPar
K\sphinxhyphen{}Means Analysis



\item {} 
\sphinxAtStartPar
Contouring



\end{itemize}


\section{Learning Objectives}
\label{\detokenize{06-ShapeAnalysis:learning-objectives}}

\subsection{Motivation (Why and How?)}
\label{\detokenize{06-ShapeAnalysis:motivation-why-and-how}}\begin{itemize}
\item {} 
\sphinxAtStartPar
How do we quantify where and \sphinxstylestrong{how big} our objects are?

\item {} 
\sphinxAtStartPar
How can we say something about the \sphinxstylestrong{shape}?

\item {} 
\sphinxAtStartPar
How can we compare objects of \sphinxstylestrong{different sizes}?

\item {} 
\sphinxAtStartPar
How can we \sphinxstylestrong{compare two images} on the basis of the shape as calculated from the images?

\item {} 
\sphinxAtStartPar
How can we put objects into an
\begin{itemize}
\item {} 
\sphinxAtStartPar
finite element simulation?

\item {} 
\sphinxAtStartPar
or make pretty renderings?

\end{itemize}

\end{itemize}


\section{Outline}
\label{\detokenize{06-ShapeAnalysis:outline}}\begin{itemize}
\item {} 
\sphinxAtStartPar
Motivation (Why and How?)

\item {} 
\sphinxAtStartPar
Object Characterization

\item {} 
\sphinxAtStartPar
Volume

\item {} 
\sphinxAtStartPar
Center and Extents

\item {} 
\sphinxAtStartPar
Anisotropy

\end{itemize}


\section{Metrics}
\label{\detokenize{06-ShapeAnalysis:metrics}}\begin{itemize}
\item {} 
\sphinxAtStartPar
Shape Tensor

\item {} 
\sphinxAtStartPar
Principal Component Analysis

\item {} 
\sphinxAtStartPar
Ellipsoid Representation

\item {} 
\sphinxAtStartPar
Scale\sphinxhyphen{}free metrics

\item {} 
\sphinxAtStartPar
Anisotropy, Oblateness

\item {} 
\sphinxAtStartPar
Meshing

\item {} 
\sphinxAtStartPar
Marching Cubes

\item {} 
\sphinxAtStartPar
Isosurfaces

\item {} 
\sphinxAtStartPar
Surface Area

\end{itemize}


\section{Motivation}
\label{\detokenize{06-ShapeAnalysis:motivation}}
\sphinxAtStartPar
We have dramatically simplified our data, but there is still too much.
\begin{itemize}
\item {} 
\sphinxAtStartPar
We perform an experiment bone to see how big the cells are inside the tissue
\$\(\downarrow\)\$ \sphinxincludegraphics{{tomoimage}.png}

\end{itemize}

\sphinxAtStartPar
\sphinxstylestrong{2560 x 2560 x 2160 x 32 bit}
\sphinxstyleemphasis{56GB / sample}
\begin{itemize}
\item {} 
\sphinxAtStartPar
Filtering and Enhancement!\$\(\downarrow\)\$

\item {} 
\sphinxAtStartPar
56GB of less noisy data

\end{itemize}


\bigskip\hrule\bigskip

\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Segmentation}

\end{itemize}
\begin{equation*}
\begin{split}\downarrow\end{split}
\end{equation*}
\sphinxAtStartPar
\sphinxstylestrong{2560 x 2560 x 2160 x 1 bit}
(1.75GB / sample)
\begin{itemize}
\item {} 
\sphinxAtStartPar
Still an aweful lot of data

\end{itemize}


\subsection{What did we want in the first place?}
\label{\detokenize{06-ShapeAnalysis:what-did-we-want-in-the-first-place}}
\sphinxAtStartPar
\sphinxstyleemphasis{Single numbers} :
\begin{itemize}
\item {} 
\sphinxAtStartPar
volume fraction,

\item {} 
\sphinxAtStartPar
cell count,

\item {} 
\sphinxAtStartPar
average cell stretch,

\item {} 
\sphinxAtStartPar
cell volume variability

\end{itemize}


\section{Literature / Useful References}
\label{\detokenize{06-ShapeAnalysis:literature-useful-references}}\begin{itemize}
\item {} 
\sphinxAtStartPar
Jean Claude, Morphometry with R
\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxhref{http://link.springer.com/book/10.1007\%2F978-0-387-77789-4}{Online} through ETHZ

\end{itemize}

\item {} 
\sphinxAtStartPar
John C. Russ, “The Image Processing Handbook”,(Boca Raton, CRC Press)
\begin{itemize}
\item {} 
\sphinxAtStartPar
Available \sphinxhref{http://dx.doi.org/10.1201/9780203881095}{online} within domain \sphinxhref{http://ethz.ch}{ethz.ch} (or \sphinxhref{http://proxy.ethz.ch}{proxy.ethz.ch} / public VPN)

\end{itemize}

\item {} 
\sphinxAtStartPar
Principal Component Analysis
\begin{itemize}
\item {} 
\sphinxAtStartPar
Venables, W. N. and B. D. Ripley (2002). Modern Applied Statistics with S, Springer\sphinxhyphen{}Verlag

\end{itemize}

\item {} 
\sphinxAtStartPar
Shape Tensors
\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxurl{http://www.cs.utah.edu/~gk/papers/vissym04/}

\item {} 
\sphinxAtStartPar
Doube, M.,et al. (2010). BoneJ: Free and extensible bone image analysis in ImageJ. Bone, 47, 1076\textendash{}9. doi:10.1016/j.bone.2010.08.023

\item {} 
\sphinxAtStartPar
Mader, K. , et al. (2013). A quantitative framework for the 3D characterization of the osteocyte lacunar system. Bone, 57(1), 142\textendash{}154. doi:10.1016/j.bone.2013.06.026

\item {} 
\sphinxAtStartPar
Wilhelm Burger, Mark Burge. Principles of Digital Image Processing: Core Algorithms. Springer\sphinxhyphen{}Verlag, London, 2009.

\item {} 
\sphinxAtStartPar
B. Jähne. Digital Image Processing. Springer\sphinxhyphen{}Verlag,
Berlin\sphinxhyphen{}Heidelberg, 6. edition, 2005.

\item {} 
\sphinxAtStartPar
T. H. Reiss. Recognizing Planar Objects Using Invariant Image
Features, from Lecture notes in computer science, p. 676. Springer,
Berlin, 1993.

\item {} 
\sphinxAtStartPar
\sphinxhref{http://en.wikipedia.org/wiki/Image\_moment}{Image moments}

\end{itemize}

\end{itemize}


\section{Let’s load some modules for python}
\label{\detokenize{06-ShapeAnalysis:let-s-load-some-modules-for-python}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{pandas} \PYG{k}{as} \PYG{n+nn}{pd}
\PYG{k+kn}{import} \PYG{n+nn}{seaborn} \PYG{k}{as} \PYG{n+nn}{sns}
\PYG{k+kn}{import} \PYG{n+nn}{matplotlib}\PYG{n+nn}{.}\PYG{n+nn}{pyplot} \PYG{k}{as} \PYG{n+nn}{plt}
\PYG{k+kn}{from} \PYG{n+nn}{matplotlib}\PYG{n+nn}{.}\PYG{n+nn}{collections} \PYG{k+kn}{import} \PYG{n}{PatchCollection}
\PYG{k+kn}{from} \PYG{n+nn}{matplotlib}\PYG{n+nn}{.}\PYG{n+nn}{patches}     \PYG{k+kn}{import} \PYG{n}{Rectangle}

\PYG{k+kn}{from} \PYG{n+nn}{matplotlib}\PYG{n+nn}{.}\PYG{n+nn}{animation} \PYG{k+kn}{import} \PYG{n}{FuncAnimation}
\PYG{k+kn}{from} \PYG{n+nn}{IPython}\PYG{n+nn}{.}\PYG{n+nn}{display}      \PYG{k+kn}{import} \PYG{n}{HTML}
\PYG{k+kn}{from} \PYG{n+nn}{skimage}\PYG{n+nn}{.}\PYG{n+nn}{morphology}   \PYG{k+kn}{import} \PYG{n}{label}
\PYG{k+kn}{from} \PYG{n+nn}{skimage}\PYG{n+nn}{.}\PYG{n+nn}{morphology}   \PYG{k+kn}{import} \PYG{n}{erosion}\PYG{p}{,} \PYG{n}{disk}
\PYG{k+kn}{from} \PYG{n+nn}{skimage}\PYG{n+nn}{.}\PYG{n+nn}{measure}      \PYG{k+kn}{import} \PYG{n}{regionprops}
\PYG{k+kn}{from} \PYG{n+nn}{skimage}\PYG{n+nn}{.}\PYG{n+nn}{io}           \PYG{k+kn}{import} \PYG{n}{imread}

\PYG{k+kn}{from} \PYG{n+nn}{IPython}\PYG{n+nn}{.}\PYG{n+nn}{display}        \PYG{k+kn}{import} \PYG{n}{Markdown}\PYG{p}{,} \PYG{n}{display}
\PYG{k+kn}{from} \PYG{n+nn}{sklearn}\PYG{n+nn}{.}\PYG{n+nn}{neighbors}      \PYG{k+kn}{import} \PYG{n}{KNeighborsClassifier}
\PYG{k+kn}{from} \PYG{n+nn}{sklearn}\PYG{n+nn}{.}\PYG{n+nn}{decomposition}  \PYG{k+kn}{import} \PYG{n}{PCA}
\PYG{k+kn}{import} \PYG{n+nn}{webcolors}

\PYG{k+kn}{from} \PYG{n+nn}{collections} \PYG{k+kn}{import} \PYG{n}{defaultdict}

\PYG{o}{\PYGZpc{}}\PYG{k}{matplotlib} inline

\PYG{n}{plt}\PYG{o}{.}\PYG{n}{rcParams}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{figure.figsize}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]} \PYG{o}{=} \PYG{p}{(}\PYG{l+m+mi}{8}\PYG{p}{,} \PYG{l+m+mi}{8}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{rcParams}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{figure.dpi}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]} \PYG{o}{=} \PYG{l+m+mi}{150}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{rcParams}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{font.size}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]} \PYG{o}{=} \PYG{l+m+mi}{14}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{rcParams}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{font.family}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sans\PYGZhy{}serif}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{rcParams}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{font.sans\PYGZhy{}serif}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{DejaVu Sans}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{style}\PYG{o}{.}\PYG{n}{use}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{default}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{sns}\PYG{o}{.}\PYG{n}{set\PYGZus{}style}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{whitegrid}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{axes.grid}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{k+kc}{False}\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gt}{\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}}
\PYG{n+ne}{ModuleNotFoundError}\PYG{g+gWhitespace}{                       }Traceback (most recent call last)
\PYG{o}{\PYGZlt{}}\PYG{n}{ipython}\PYG{o}{\PYGZhy{}}\PYG{n+nb}{input}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{309296}\PYG{n}{dda6d3}\PYG{o}{\PYGZgt{}} \PYG{o+ow}{in} \PYG{o}{\PYGZlt{}}\PYG{n}{module}\PYG{o}{\PYGZgt{}}
\PYG{g+gWhitespace}{      }\PYG{l+m+mi}{1} \PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{n+ne}{\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZgt{} }\PYG{l+m+mi}{2} \PYG{k+kn}{import} \PYG{n+nn}{pandas} \PYG{k}{as} \PYG{n+nn}{pd}
\PYG{g+gWhitespace}{      }\PYG{l+m+mi}{3} \PYG{k+kn}{import} \PYG{n+nn}{seaborn} \PYG{k}{as} \PYG{n+nn}{sns}
\PYG{g+gWhitespace}{      }\PYG{l+m+mi}{4} \PYG{k+kn}{import} \PYG{n+nn}{matplotlib}\PYG{n+nn}{.}\PYG{n+nn}{pyplot} \PYG{k}{as} \PYG{n+nn}{plt}
\PYG{g+gWhitespace}{      }\PYG{l+m+mi}{5} \PYG{k+kn}{from} \PYG{n+nn}{matplotlib}\PYG{n+nn}{.}\PYG{n+nn}{collections} \PYG{k+kn}{import} \PYG{n}{PatchCollection}

\PYG{n+ne}{ModuleNotFoundError}: No module named \PYGZsq{}pandas\PYGZsq{}
\end{sphinxVerbatim}


\chapter{Component labelling}
\label{\detokenize{06-ShapeAnalysis:component-labelling}}

\section{Segmentation}
\label{\detokenize{06-ShapeAnalysis:segmentation}}\begin{itemize}
\item {} 
\sphinxAtStartPar
Segmentation identified pixels belonging to some class
\begin{itemize}
\item {} 
\sphinxAtStartPar
a single set containing all pixels!

\end{itemize}

\end{itemize}


\section{To measure objects in an image, they need to be uniquely identified.}
\label{\detokenize{06-ShapeAnalysis:to-measure-objects-in-an-image-they-need-to-be-uniquely-identified}}
\sphinxAtStartPar
Once we have a clearly segmented image, it is often helpful to identify the sub\sphinxhyphen{}components of this image. Connected component labeling is one of the first labeling algorithms you come across. This is the easist method for identifying these subcomponents which again uses the neighborhood \(\mathcal{N}\) as a criterion for connectivity. The principle of the this algorithm class is that it is it puts labels on all pixels that touch each other. This means that the algorithm searches the neighborhood of each pixel and checks if it is marked as an object. If, “yes” then the neighbor pixel will be assigned the same class a the pixels we started from. This is an iterative process until each object in the image has one unique label.

\sphinxAtStartPar
In general, the approach works well since usually when different regions are touching, they are related. It runs into issues when you have multiple regions which agglomerate together, for example a continuous pore network (1 object) or a cluster of touching cells.
\begin{itemize}
\item {} 
\sphinxAtStartPar
Basic component labelling
\begin{itemize}
\item {} 
\sphinxAtStartPar
give the same label to all pixels touching each other.

\item {} 
\sphinxAtStartPar
has its drawbacks… touching item are treated as one

\end{itemize}

\end{itemize}


\section{A cityscape image}
\label{\detokenize{06-ShapeAnalysis:a-cityscape-image}}
\sphinxAtStartPar
To demonsstrate the connected components labeling we need an image. Here, we show some examples from Cityscape Data taken in Aachen (\sphinxurl{https://www.cityscapes-dataset.com/}). The picture represents a street with cars in a city. The cars are also provided as a segmentation mask. This saves us the trouble of finding them in the first place.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{skimage}\PYG{n+nn}{.}\PYG{n+nn}{io} \PYG{k+kn}{import} \PYG{n}{imread}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{matplotlib}\PYG{n+nn}{.}\PYG{n+nn}{pyplot} \PYG{k}{as} \PYG{n+nn}{plt}
\PYG{o}{\PYGZpc{}}\PYG{k}{matplotlib} inline
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{car\PYGZus{}img} \PYG{o}{=} \PYG{n}{imread}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{figures/aachen\PYGZus{}img.png}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{seg\PYGZus{}img} \PYG{o}{=} \PYG{n}{imread}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{figures/aachen\PYGZus{}label.png}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{[}\PYG{p}{:}\PYG{p}{:}\PYG{l+m+mi}{4}\PYG{p}{,} \PYG{p}{:}\PYG{p}{:}\PYG{l+m+mi}{4}\PYG{p}{]} \PYG{o}{==} \PYG{l+m+mi}{26}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{image dimensions}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{car\PYGZus{}img}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{,} \PYG{n}{seg\PYGZus{}img}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{)}
\PYG{n}{fig}\PYG{p}{,} \PYG{p}{(}\PYG{n}{ax1}\PYG{p}{,} \PYG{n}{ax2}\PYG{p}{)} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{20}\PYG{p}{,} \PYG{l+m+mi}{8}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{ax1}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{n}{car\PYGZus{}img}\PYG{p}{)}
\PYG{n}{ax1}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Input Image}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{n}{ax2}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{n}{seg\PYGZus{}img}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{bone}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax2}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Segmented Image}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
image dimensions (256, 512, 4) (256, 512)
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{06-ShapeAnalysis_17_1}.png}


\section{Connected component labeling in python}
\label{\detokenize{06-ShapeAnalysis:connected-component-labeling-in-python}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{skimage}\PYG{n+nn}{.}\PYG{n+nn}{morphology} \PYG{k+kn}{import} \PYG{n}{label}
\PYG{n}{help}\PYG{p}{(}\PYG{n}{label}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
Help on function label in module skimage.measure.\PYGZus{}label:

label(input, neighbors=None, background=None, return\PYGZus{}num=False, connectivity=None)
    Label connected regions of an integer array.
    
    Two pixels are connected when they are neighbors and have the same value.
    In 2D, they can be neighbors either in a 1\PYGZhy{} or 2\PYGZhy{}connected sense.
    The value refers to the maximum number of orthogonal hops to consider a
    pixel/voxel a neighbor::
    
      1\PYGZhy{}connectivity     2\PYGZhy{}connectivity     diagonal connection close\PYGZhy{}up
    
           [ ]           [ ]  [ ]  [ ]             [ ]
            |               \PYGZbs{}  |  /                 |  \PYGZlt{}\PYGZhy{} hop 2
      [ ]\PYGZhy{}\PYGZhy{}[x]\PYGZhy{}\PYGZhy{}[ ]      [ ]\PYGZhy{}\PYGZhy{}[x]\PYGZhy{}\PYGZhy{}[ ]        [x]\PYGZhy{}\PYGZhy{}[ ]
            |               /  |  \PYGZbs{}             hop 1
           [ ]           [ ]  [ ]  [ ]
    
    Parameters
    \PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
    input : ndarray of dtype int
        Image to label.
    neighbors : \PYGZob{}4, 8\PYGZcb{}, int, optional
        Whether to use 4\PYGZhy{} or 8\PYGZhy{}\PYGZdq{}connectivity\PYGZdq{}.
        In 3D, 4\PYGZhy{}\PYGZdq{}connectivity\PYGZdq{} means connected pixels have to share face,
        whereas with 8\PYGZhy{}\PYGZdq{}connectivity\PYGZdq{}, they have to share only edge or vertex.
        **Deprecated, use** ``connectivity`` **instead.**
    background : int, optional
        Consider all pixels with this value as background pixels, and label
        them as 0. By default, 0\PYGZhy{}valued pixels are considered as background
        pixels.
    return\PYGZus{}num : bool, optional
        Whether to return the number of assigned labels.
    connectivity : int, optional
        Maximum number of orthogonal hops to consider a pixel/voxel
        as a neighbor.
        Accepted values are ranging from  1 to input.ndim. If ``None``, a full
        connectivity of ``input.ndim`` is used.
    
    Returns
    \PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
    labels : ndarray of dtype int
        Labeled array, where all connected regions are assigned the
        same integer value.
    num : int, optional
        Number of labels, which equals the maximum label index and is only
        returned if return\PYGZus{}num is `True`.
    
    See Also
    \PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
    regionprops
    
    References
    \PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
    .. [1] Christophe Fiorio and Jens Gustedt, \PYGZdq{}Two linear time Union\PYGZhy{}Find
           strategies for image processing\PYGZdq{}, Theoretical Computer Science
           154 (1996), pp. 165\PYGZhy{}181.
    .. [2] Kensheng Wu, Ekow Otoo and Arie Shoshani, \PYGZdq{}Optimizing connected
           component labeling algorithms\PYGZdq{}, Paper LBNL\PYGZhy{}56864, 2005,
           Lawrence Berkeley National Laboratory (University of California),
           http://repositories.cdlib.org/lbnl/LBNL\PYGZhy{}56864
    
    Examples
    \PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
    \PYGZgt{}\PYGZgt{}\PYGZgt{} import numpy as np
    \PYGZgt{}\PYGZgt{}\PYGZgt{} x = np.eye(3).astype(int)
    \PYGZgt{}\PYGZgt{}\PYGZgt{} print(x)
    [[1 0 0]
     [0 1 0]
     [0 0 1]]
    \PYGZgt{}\PYGZgt{}\PYGZgt{} print(label(x, connectivity=1))
    [[1 0 0]
     [0 2 0]
     [0 0 3]]
    \PYGZgt{}\PYGZgt{}\PYGZgt{} print(label(x, connectivity=2))
    [[1 0 0]
     [0 1 0]
     [0 0 1]]
    \PYGZgt{}\PYGZgt{}\PYGZgt{} print(label(x, background=\PYGZhy{}1))
    [[1 2 2]
     [2 1 2]
     [2 2 1]]
    \PYGZgt{}\PYGZgt{}\PYGZgt{} x = np.array([[1, 0, 0],
    ...               [1, 1, 5],
    ...               [0, 0, 0]])
    \PYGZgt{}\PYGZgt{}\PYGZgt{} print(label(x))
    [[1 0 0]
     [1 1 2]
     [0 0 0]]
\end{sphinxVerbatim}


\section{Labels in the cityscape image}
\label{\detokenize{06-ShapeAnalysis:labels-in-the-cityscape-image}}
\sphinxAtStartPar
When we apply the \sphinxcode{\sphinxupquote{label}} operation on the car mask, we see the that each car is assigned a color. There are however some cars that get multiple classes. This is because they were divided into several segments due to objects like tree and trafic signs.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{fig}\PYG{p}{,} \PYG{p}{(}\PYG{n}{ax1}\PYG{p}{,} \PYG{n}{ax2}\PYG{p}{)} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{20}\PYG{p}{,} \PYG{l+m+mi}{8}\PYG{p}{)}\PYG{p}{,} \PYG{n}{dpi}\PYG{o}{=}\PYG{l+m+mi}{100}\PYG{p}{)}
\PYG{n}{ax1}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{n}{seg\PYGZus{}img}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{bone}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax1}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Segmented Image}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}  
\PYG{n}{lab\PYGZus{}img} \PYG{o}{=} \PYG{n}{label}\PYG{p}{(}\PYG{n}{seg\PYGZus{}img}\PYG{p}{)}
\PYG{n}{ax2}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{n}{lab\PYGZus{}img}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{n}{plt}\PYG{o}{.}\PYG{n}{cm}\PYG{o}{.}\PYG{n}{tab10}\PYG{p}{)}
\PYG{n}{ax2}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Labeled Image}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{06-ShapeAnalysis_22_0}.png}


\section{Area of each segment}
\label{\detokenize{06-ShapeAnalysis:area-of-each-segment}}
\sphinxAtStartPar
Now, we can start making measurements in the image. A first thing that comes to mind is to compute the area of the objects. This is a very simple operation; we only have to count the number of pixels belonging to each label.
\begin{equation*}
\begin{split}Area_i=\#\{x|f(x)\in{}i\}\end{split}
\end{equation*}
\sphinxAtStartPar
Usually, we want to know the are of all items in the images. We could do this by writing a loop that goes through all labels in the image and compute each one of them. There is however an operation that does this much easier: the histogram.

\sphinxAtStartPar
We can use a histogram with the same number of bins are there are labels in the image. This would give us the size distribution in of the objects in one single operation.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{fig}\PYG{p}{,} \PYG{p}{(}\PYG{n}{ax3}\PYG{p}{)} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{dpi}\PYG{o}{=}\PYG{l+m+mi}{150}\PYG{p}{)}
\PYG{n}{ax3}\PYG{o}{.}\PYG{n}{hist}\PYG{p}{(}\PYG{n}{lab\PYGZus{}img}\PYG{o}{.}\PYG{n}{ravel}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{ax3}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Label Counts}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax3}\PYG{o}{.}\PYG{n}{set\PYGZus{}yscale}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{log}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{06-ShapeAnalysis_27_0}.png}


\chapter{A component labeling algorithm}
\label{\detokenize{06-ShapeAnalysis:a-component-labeling-algorithm}}
\sphinxAtStartPar
We start off with all of the pixels in either foreground (1) or background (0)

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{seg\PYGZus{}img} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{eye}\PYG{p}{(}\PYG{l+m+mi}{9}\PYG{p}{,} \PYG{n}{dtype}\PYG{o}{=}\PYG{n+nb}{int}\PYG{p}{)}
\PYG{n}{seg\PYGZus{}img}\PYG{p}{[}\PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+m+mi}{4}\PYG{p}{]} \PYG{o}{=} \PYG{l+m+mi}{0}
\PYG{n}{seg\PYGZus{}img} \PYG{o}{+}\PYG{o}{=} \PYG{n}{seg\PYGZus{}img}\PYG{p}{[}\PYG{p}{:}\PYG{p}{:}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]} 
\PYG{n}{sns}\PYG{o}{.}\PYG{n}{heatmap}\PYG{p}{(}\PYG{n}{seg\PYGZus{}img}\PYG{p}{,} \PYG{n}{annot}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,} \PYG{n}{fmt}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{d}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{06-ShapeAnalysis_29_0}.png}


\section{Labeling initialization}
\label{\detokenize{06-ShapeAnalysis:labeling-initialization}}
\sphinxAtStartPar
Give each point in the image a unique label
\begin{itemize}
\item {} 
\sphinxAtStartPar
For each point \((x,y)\in\text{Foreground}\)

\item {} 
\sphinxAtStartPar
Set value to \(I_{x,y} = x+y*width+1\)

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{idx\PYGZus{}img} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{zeros\PYGZus{}like}\PYG{p}{(}\PYG{n}{seg\PYGZus{}img}\PYG{p}{)}
\PYG{k}{for} \PYG{n}{x} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{seg\PYGZus{}img}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{for} \PYG{n}{y} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{seg\PYGZus{}img}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{:}
        \PYG{k}{if} \PYG{n}{seg\PYGZus{}img}\PYG{p}{[}\PYG{n}{x}\PYG{p}{,} \PYG{n}{y}\PYG{p}{]} \PYG{o}{\PYGZgt{}} \PYG{l+m+mi}{0}\PYG{p}{:}
            \PYG{n}{idx\PYGZus{}img}\PYG{p}{[}\PYG{n}{x}\PYG{p}{,} \PYG{n}{y}\PYG{p}{]} \PYG{o}{=} \PYG{n}{x}\PYG{o}{+}\PYG{n}{y}\PYG{o}{*}\PYG{n}{seg\PYGZus{}img}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{+}\PYG{l+m+mi}{1}
\PYG{n}{sns}\PYG{o}{.}\PYG{n}{heatmap}\PYG{p}{(}\PYG{n}{idx\PYGZus{}img}\PYG{p}{,} \PYG{n}{annot}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,}
            \PYG{n}{fmt}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{d}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{nipy\PYGZus{}spectral}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{06-ShapeAnalysis_31_0}.png}


\section{A brushfire labeling algorithm}
\label{\detokenize{06-ShapeAnalysis:a-brushfire-labeling-algorithm}}
\sphinxAtStartPar
In a \sphinxhref{http://www.sciencedirect.com/science/article/pii/S0921889007000966}{brushfire}\sphinxhyphen{}style algorithm
\begin{itemize}
\item {} 
\sphinxAtStartPar
For each point \((x,y)\in\text{Foreground}\)
\begin{itemize}
\item {} 
\sphinxAtStartPar
For each point \((x^{\prime},y^{\prime})\in\mathcal{N}(x,y)\)

\item {} 
\sphinxAtStartPar
if \((x^{\prime},y^{\prime})\in\text{Foreground}\)
\begin{itemize}
\item {} 
\sphinxAtStartPar
Set the label to \(\min(I_{x,y}, I_{x^{\prime},y^{\prime}})\)

\end{itemize}

\end{itemize}

\item {} 
\sphinxAtStartPar
Repeat until no more labels have been changed

\end{itemize}


\subsection{Implementation of the brush fire algorithm}
\label{\detokenize{06-ShapeAnalysis:implementation-of-the-brush-fire-algorithm}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{last\PYGZus{}img} \PYG{o}{=} \PYG{n}{idx\PYGZus{}img}\PYG{o}{.}\PYG{n}{copy}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{img\PYGZus{}list} \PYG{o}{=} \PYG{p}{[}\PYG{n}{last\PYGZus{}img}\PYG{p}{]}
\PYG{k}{for} \PYG{n}{iteration}\PYG{p}{,} \PYG{n}{c\PYGZus{}ax} \PYG{o+ow}{in} \PYG{n+nb}{enumerate}\PYG{p}{(}\PYG{n}{m\PYGZus{}axs}\PYG{o}{.}\PYG{n}{flatten}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{cur\PYGZus{}img} \PYG{o}{=} \PYG{n}{last\PYGZus{}img}\PYG{o}{.}\PYG{n}{copy}\PYG{p}{(}\PYG{p}{)}

    \PYG{k}{for} \PYG{n}{x} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{last\PYGZus{}img}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{:}
        \PYG{k}{for} \PYG{n}{y} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{last\PYGZus{}img}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{:}
            \PYG{k}{if} \PYG{n}{last\PYGZus{}img}\PYG{p}{[}\PYG{n}{x}\PYG{p}{,} \PYG{n}{y}\PYG{p}{]} \PYG{o}{\PYGZgt{}} \PYG{l+m+mi}{0}\PYG{p}{:}
                \PYG{n}{i\PYGZus{}xy} \PYG{o}{=} \PYG{n}{last\PYGZus{}img}\PYG{p}{[}\PYG{n}{x}\PYG{p}{,} \PYG{n}{y}\PYG{p}{]}
                \PYG{k}{for} \PYG{n}{xp} \PYG{o+ow}{in} \PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{:}
                    \PYG{k}{if} \PYG{p}{(}\PYG{n}{x}\PYG{o}{+}\PYG{n}{xp} \PYG{o}{\PYGZlt{}} \PYG{n}{last\PYGZus{}img}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)} \PYG{o+ow}{and} \PYG{p}{(}\PYG{n}{x}\PYG{o}{+}\PYG{n}{xp} \PYG{o}{\PYGZgt{}}\PYG{o}{=} \PYG{l+m+mi}{0}\PYG{p}{)}\PYG{p}{:}
                        \PYG{k}{for} \PYG{n}{yp} \PYG{o+ow}{in} \PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{:}
                            \PYG{k}{if} \PYG{p}{(}\PYG{n}{y}\PYG{o}{+}\PYG{n}{yp} \PYG{o}{\PYGZlt{}} \PYG{n}{last\PYGZus{}img}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)} \PYG{o+ow}{and} \PYG{p}{(}\PYG{n}{y}\PYG{o}{+}\PYG{n}{yp} \PYG{o}{\PYGZgt{}}\PYG{o}{=} \PYG{l+m+mi}{0}\PYG{p}{)}\PYG{p}{:}
                                \PYG{n}{i\PYGZus{}xpyp} \PYG{o}{=} \PYG{n}{last\PYGZus{}img}\PYG{p}{[}\PYG{n}{x}\PYG{o}{+}\PYG{n}{xp}\PYG{p}{,} \PYG{n}{y}\PYG{o}{+}\PYG{n}{yp}\PYG{p}{]}
                                \PYG{k}{if} \PYG{n}{i\PYGZus{}xpyp} \PYG{o}{\PYGZgt{}} \PYG{l+m+mi}{0}\PYG{p}{:}

                                    \PYG{n}{new\PYGZus{}val} \PYG{o}{=} \PYG{n+nb}{min}\PYG{p}{(}\PYG{n}{i\PYGZus{}xy}\PYG{p}{,} \PYG{n}{i\PYGZus{}xpyp}\PYG{p}{,} \PYG{n}{cur\PYGZus{}img}\PYG{p}{[}\PYG{n}{x}\PYG{p}{,} \PYG{n}{y}\PYG{p}{]}\PYG{p}{)}
                                    \PYG{k}{if} \PYG{n}{cur\PYGZus{}img}\PYG{p}{[}\PYG{n}{x}\PYG{p}{,} \PYG{n}{y}\PYG{p}{]} \PYG{o}{!=} \PYG{n}{new\PYGZus{}val}\PYG{p}{:}
                                        \PYG{n+nb}{print}\PYG{p}{(}\PYG{p}{(}\PYG{n}{x}\PYG{p}{,} \PYG{n}{y}\PYG{p}{)}\PYG{p}{,} \PYG{n}{i\PYGZus{}xy}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{vs}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{p}{(}\PYG{n}{x}\PYG{o}{+}\PYG{n}{xp}\PYG{p}{,}
                                                                   \PYG{n}{y}\PYG{o}{+}\PYG{n}{yp}\PYG{p}{)}\PYG{p}{,} \PYG{n}{i\PYGZus{}xpyp}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZhy{}\PYGZgt{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{new\PYGZus{}val}\PYG{p}{)}
                                        \PYG{n}{cur\PYGZus{}img}\PYG{p}{[}\PYG{n}{x}\PYG{p}{,} \PYG{n}{y}\PYG{p}{]} \PYG{o}{=} \PYG{n}{new\PYGZus{}val}

    \PYG{n}{img\PYGZus{}list} \PYG{o}{+}\PYG{o}{=} \PYG{p}{[}\PYG{n}{cur\PYGZus{}img}\PYG{p}{]}
    \PYG{k}{if} \PYG{p}{(}\PYG{n}{cur\PYGZus{}img} \PYG{o}{==} \PYG{n}{last\PYGZus{}img}\PYG{p}{)}\PYG{o}{.}\PYG{n}{all}\PYG{p}{(}\PYG{p}{)}\PYG{p}{:}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Done}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{k}{break}
    \PYG{k}{else}\PYG{p}{:}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Iteration}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{iteration}\PYG{p}{,}
              \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Groups}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{unique}\PYG{p}{(}\PYG{n}{cur\PYGZus{}img}\PYG{p}{[}\PYG{n}{cur\PYGZus{}img} \PYG{o}{\PYGZgt{}} \PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{ravel}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}
              \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Changes}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{np}\PYG{o}{.}\PYG{n}{sum}\PYG{p}{(}\PYG{n}{cur\PYGZus{}img} \PYG{o}{!=} \PYG{n}{last\PYGZus{}img}\PYG{p}{)}\PYG{p}{)}
        \PYG{n}{last\PYGZus{}img} \PYG{o}{=} \PYG{n}{cur\PYGZus{}img}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
(0, 8) 73 vs (1, 7) 65 \PYGZhy{}\PYGZgt{} 65
(1, 1) 11 vs (0, 0) 1 \PYGZhy{}\PYGZgt{} 1
(1, 7) 65 vs (2, 6) 57 \PYGZhy{}\PYGZgt{} 57
(2, 2) 21 vs (1, 1) 11 \PYGZhy{}\PYGZgt{} 11
(2, 6) 57 vs (3, 5) 49 \PYGZhy{}\PYGZgt{} 49
(3, 3) 31 vs (2, 2) 21 \PYGZhy{}\PYGZgt{} 21
(5, 3) 33 vs (6, 2) 25 \PYGZhy{}\PYGZgt{} 25
(6, 2) 25 vs (7, 1) 17 \PYGZhy{}\PYGZgt{} 17
(6, 6) 61 vs (5, 5) 51 \PYGZhy{}\PYGZgt{} 51
(7, 1) 17 vs (8, 0) 9 \PYGZhy{}\PYGZgt{} 9
(7, 7) 71 vs (6, 6) 61 \PYGZhy{}\PYGZgt{} 61
(8, 8) 81 vs (7, 7) 71 \PYGZhy{}\PYGZgt{} 71
Iteration 1 Groups 12 Changes 12
(0, 8) 65 vs (1, 7) 57 \PYGZhy{}\PYGZgt{} 57
(1, 7) 57 vs (2, 6) 49 \PYGZhy{}\PYGZgt{} 49
(2, 2) 11 vs (1, 1) 1 \PYGZhy{}\PYGZgt{} 1
(3, 3) 21 vs (2, 2) 11 \PYGZhy{}\PYGZgt{} 11
(5, 3) 25 vs (6, 2) 17 \PYGZhy{}\PYGZgt{} 17
(6, 2) 17 vs (7, 1) 9 \PYGZhy{}\PYGZgt{} 9
(7, 7) 61 vs (6, 6) 51 \PYGZhy{}\PYGZgt{} 51
(8, 8) 71 vs (7, 7) 61 \PYGZhy{}\PYGZgt{} 61
Iteration 2 Groups 8 Changes 8
(0, 8) 57 vs (1, 7) 49 \PYGZhy{}\PYGZgt{} 49
(3, 3) 11 vs (2, 2) 1 \PYGZhy{}\PYGZgt{} 1
(5, 3) 17 vs (6, 2) 9 \PYGZhy{}\PYGZgt{} 9
(8, 8) 61 vs (7, 7) 51 \PYGZhy{}\PYGZgt{} 51
Iteration 3 Groups 4 Changes 4
Done
\end{sphinxVerbatim}


\subsection{Looking at the iterations}
\label{\detokenize{06-ShapeAnalysis:looking-at-the-iterations}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{fig}\PYG{p}{,} \PYG{n}{m\PYGZus{}axs} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{15}\PYG{p}{,} \PYG{l+m+mi}{10}\PYG{p}{)}\PYG{p}{)}\PYG{p}{;} \PYG{n}{m\PYGZus{}axs}\PYG{o}{=}\PYG{n}{m\PYGZus{}axs}\PYG{o}{.}\PYG{n}{ravel}\PYG{p}{(}\PYG{p}{)}
\PYG{k}{for} \PYG{n}{c\PYGZus{}ax}\PYG{p}{,}\PYG{n}{cur\PYGZus{}img} \PYG{o+ow}{in} \PYG{n+nb}{zip}\PYG{p}{(}\PYG{n}{m\PYGZus{}axs}\PYG{p}{,}\PYG{n}{img\PYGZus{}list}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{sns}\PYG{o}{.}\PYG{n}{heatmap}\PYG{p}{(}\PYG{n}{cur\PYGZus{}img}\PYG{p}{,}
                \PYG{n}{annot}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,}
                \PYG{n}{fmt}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{d}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
                \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{nipy\PYGZus{}spectral}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                \PYG{n}{ax}\PYG{o}{=}\PYG{n}{c\PYGZus{}ax}\PYG{p}{)}
    \PYG{n}{c\PYGZus{}ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Iteration \PYGZsh{}}\PYG{l+s+si}{\PYGZob{}\PYGZcb{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{iteration}\PYG{p}{)}\PYG{p}{)}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{06-ShapeAnalysis_36_0}.png}


\subsection{Some comments on the brushfire algorithm}
\label{\detokenize{06-ShapeAnalysis:some-comments-on-the-brushfire-algorithm}}\begin{itemize}
\item {} 
\sphinxAtStartPar
The image very quickly converges and after 4 iterations the task is complete.

\item {} 
\sphinxAtStartPar
For larger more complicated images with thousands of components this task can take longer,

\item {} 
\sphinxAtStartPar
There exist much more efficient \sphinxhref{https://www.cs.princeton.edu/~rs/AlgsDS07/01UnionFind.pdf}{algorithms} for labeling components which alleviate this issue.
\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxhref{https://doi.org/10.1145/321356.321357}{Rosenfeld \& Pfalz, \sphinxstyleemphasis{Sequential Operations in Digital Picture Processing}, 1966}

\item {} 
\sphinxAtStartPar
\sphinxhref{https://doi.org/10.1007/978-3-662-05088-0}{Soille, Morphological Image Processing, page 38, 2004}

\end{itemize}

\end{itemize}


\subsection{Let’s animate the iterations}
\label{\detokenize{06-ShapeAnalysis:let-s-animate-the-iterations}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{fig}\PYG{p}{,} \PYG{n}{c\PYGZus{}ax} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,} \PYG{l+m+mi}{5}\PYG{p}{)}\PYG{p}{,} \PYG{n}{dpi}\PYG{o}{=}\PYG{l+m+mi}{100}\PYG{p}{)}

\PYG{k}{def} \PYG{n+nf}{update\PYGZus{}frame}\PYG{p}{(}\PYG{n}{i}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{plt}\PYG{o}{.}\PYG{n}{cla}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{sns}\PYG{o}{.}\PYG{n}{heatmap}\PYG{p}{(}\PYG{n}{img\PYGZus{}list}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{,}
                \PYG{n}{annot}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,}
                \PYG{n}{fmt}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{d}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
                \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{nipy\PYGZus{}spectral}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                \PYG{n}{ax}\PYG{o}{=}\PYG{n}{c\PYGZus{}ax}\PYG{p}{,}
                \PYG{n}{cbar}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{,}
                \PYG{n}{vmin}\PYG{o}{=}\PYG{n}{img\PYGZus{}list}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{min}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,}
                \PYG{n}{vmax}\PYG{o}{=}\PYG{n}{img\PYGZus{}list}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{max}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
    \PYG{n}{c\PYGZus{}ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Iteration \PYGZsh{}}\PYG{l+s+si}{\PYGZob{}\PYGZcb{}}\PYG{l+s+s1}{, Groups }\PYG{l+s+si}{\PYGZob{}\PYGZcb{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{i}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{,}
                                                     \PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{unique}\PYG{p}{(}\PYG{n}{img\PYGZus{}list}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{[}\PYG{n}{img\PYGZus{}list}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]} \PYG{o}{\PYGZgt{}} \PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{ravel}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} write animation frames}
\PYG{n}{anim\PYGZus{}code} \PYG{o}{=} \PYG{n}{FuncAnimation}\PYG{p}{(}\PYG{n}{fig}\PYG{p}{,} \PYG{n}{update\PYGZus{}frame}\PYG{p}{,} \PYG{n}{frames}\PYG{o}{=}\PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{img\PYGZus{}list}\PYG{p}{)}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{,}
                          \PYG{n}{interval}\PYG{o}{=}\PYG{l+m+mi}{1000}\PYG{p}{,} \PYG{n}{repeat\PYGZus{}delay}\PYG{o}{=}\PYG{l+m+mi}{2000}\PYG{p}{)}\PYG{o}{.}\PYG{n}{to\PYGZus{}html5\PYGZus{}video}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{close}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{all}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{HTML}\PYG{p}{(}\PYG{n}{anim\PYGZus{}code}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZlt{}IPython.core.display.HTML object\PYGZgt{}
\end{sphinxVerbatim}


\section{Bigger Images}
\label{\detokenize{06-ShapeAnalysis:bigger-images}}
\sphinxAtStartPar
How does the same algorithm apply to bigger images?

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{seg\PYGZus{}img} \PYG{o}{=} \PYG{p}{(}\PYG{n}{imread}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{figures/aachen\PYGZus{}label.png}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{[}\PYG{p}{:}\PYG{p}{:}\PYG{l+m+mi}{4}\PYG{p}{,} \PYG{p}{:}\PYG{p}{:}\PYG{l+m+mi}{4}\PYG{p}{]} \PYG{o}{==} \PYG{l+m+mi}{26}\PYG{p}{)}\PYG{p}{[}\PYG{l+m+mi}{110}\PYG{p}{:}\PYG{l+m+mi}{130}\PYG{p}{:}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{370}\PYG{p}{:}\PYG{l+m+mi}{420}\PYG{p}{:}\PYG{l+m+mi}{3}\PYG{p}{]}
\PYG{n}{seg\PYGZus{}img}\PYG{p}{[}\PYG{l+m+mi}{9}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{]} \PYG{o}{=} \PYG{l+m+mi}{1}
\PYG{n}{\PYGZus{}}\PYG{p}{,} \PYG{p}{(}\PYG{n}{ax1}\PYG{p}{,} \PYG{n}{ax2}\PYG{p}{)} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{15}\PYG{p}{,} \PYG{l+m+mi}{7}\PYG{p}{)}\PYG{p}{,} \PYG{n}{dpi}\PYG{o}{=}\PYG{l+m+mi}{150}\PYG{p}{)}
\PYG{n}{sns}\PYG{o}{.}\PYG{n}{heatmap}\PYG{p}{(}\PYG{n}{seg\PYGZus{}img}\PYG{p}{,} \PYG{n}{annot}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,} \PYG{n}{fmt}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{d}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{ax}\PYG{o}{=}\PYG{n}{ax1}\PYG{p}{,}
            \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{nipy\PYGZus{}spectral}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{cbar}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}
\PYG{n}{ax1}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Binary image}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{n}{idx\PYGZus{}img} \PYG{o}{=} \PYG{n}{seg\PYGZus{}img} \PYG{o}{*} \PYG{n}{np}\PYG{o}{.}\PYG{n}{arange}\PYG{p}{(}\PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{seg\PYGZus{}img}\PYG{o}{.}\PYG{n}{ravel}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}\PYG{o}{.}\PYG{n}{reshape}\PYG{p}{(}\PYG{n}{seg\PYGZus{}img}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{)}
\PYG{n}{sns}\PYG{o}{.}\PYG{n}{heatmap}\PYG{p}{(}\PYG{n}{idx\PYGZus{}img}\PYG{p}{,} \PYG{n}{annot}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,} \PYG{n}{fmt}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{d}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{ax}\PYG{o}{=}\PYG{n}{ax2}\PYG{p}{,}
            \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{nipy\PYGZus{}spectral}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{cbar}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}
\PYG{n}{ax2}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Initial labels}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{06-ShapeAnalysis_41_0}.png}


\subsection{Run the labelling on the car image}
\label{\detokenize{06-ShapeAnalysis:run-the-labelling-on-the-car-image}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{last\PYGZus{}img} \PYG{o}{=} \PYG{n}{idx\PYGZus{}img}\PYG{o}{.}\PYG{n}{copy}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{img\PYGZus{}list} \PYG{o}{=} \PYG{p}{[}\PYG{n}{last\PYGZus{}img}\PYG{p}{]}
\PYG{k}{for} \PYG{n}{iteration} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{99}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{cur\PYGZus{}img} \PYG{o}{=} \PYG{n}{last\PYGZus{}img}\PYG{o}{.}\PYG{n}{copy}\PYG{p}{(}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{x} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{last\PYGZus{}img}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{:}
        \PYG{k}{for} \PYG{n}{y} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{last\PYGZus{}img}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{:}
            \PYG{k}{if} \PYG{n}{last\PYGZus{}img}\PYG{p}{[}\PYG{n}{x}\PYG{p}{,} \PYG{n}{y}\PYG{p}{]} \PYG{o}{\PYGZgt{}} \PYG{l+m+mi}{0}\PYG{p}{:}
                \PYG{n}{i\PYGZus{}xy} \PYG{o}{=} \PYG{n}{last\PYGZus{}img}\PYG{p}{[}\PYG{n}{x}\PYG{p}{,} \PYG{n}{y}\PYG{p}{]}
                \PYG{k}{for} \PYG{n}{xp} \PYG{o+ow}{in} \PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{:}
                    \PYG{k}{if} \PYG{p}{(}\PYG{n}{x}\PYG{o}{+}\PYG{n}{xp} \PYG{o}{\PYGZlt{}} \PYG{n}{last\PYGZus{}img}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)} \PYG{o+ow}{and} \PYG{p}{(}\PYG{n}{x}\PYG{o}{+}\PYG{n}{xp} \PYG{o}{\PYGZgt{}}\PYG{o}{=} \PYG{l+m+mi}{0}\PYG{p}{)}\PYG{p}{:}
                        \PYG{k}{for} \PYG{n}{yp} \PYG{o+ow}{in} \PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{:}
                            \PYG{k}{if} \PYG{p}{(}\PYG{n}{y}\PYG{o}{+}\PYG{n}{yp} \PYG{o}{\PYGZlt{}} \PYG{n}{last\PYGZus{}img}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)} \PYG{o+ow}{and} \PYG{p}{(}\PYG{n}{y}\PYG{o}{+}\PYG{n}{yp} \PYG{o}{\PYGZgt{}}\PYG{o}{=} \PYG{l+m+mi}{0}\PYG{p}{)}\PYG{p}{:}
                                \PYG{n}{i\PYGZus{}xpyp} \PYG{o}{=} \PYG{n}{last\PYGZus{}img}\PYG{p}{[}\PYG{n}{x}\PYG{o}{+}\PYG{n}{xp}\PYG{p}{,} \PYG{n}{y}\PYG{o}{+}\PYG{n}{yp}\PYG{p}{]}
                                \PYG{k}{if} \PYG{n}{i\PYGZus{}xpyp} \PYG{o}{\PYGZgt{}} \PYG{l+m+mi}{0}\PYG{p}{:}
                                    \PYG{n}{new\PYGZus{}val} \PYG{o}{=} \PYG{n+nb}{min}\PYG{p}{(}\PYG{n}{i\PYGZus{}xy}\PYG{p}{,} \PYG{n}{i\PYGZus{}xpyp}\PYG{p}{,} \PYG{n}{cur\PYGZus{}img}\PYG{p}{[}\PYG{n}{x}\PYG{p}{,} \PYG{n}{y}\PYG{p}{]}\PYG{p}{)}
                                    \PYG{k}{if} \PYG{n}{cur\PYGZus{}img}\PYG{p}{[}\PYG{n}{x}\PYG{p}{,} \PYG{n}{y}\PYG{p}{]} \PYG{o}{!=} \PYG{n}{new\PYGZus{}val}\PYG{p}{:}
                                        \PYG{n}{cur\PYGZus{}img}\PYG{p}{[}\PYG{n}{x}\PYG{p}{,} \PYG{n}{y}\PYG{p}{]} \PYG{o}{=} \PYG{n}{new\PYGZus{}val}

    \PYG{n}{img\PYGZus{}list} \PYG{o}{+}\PYG{o}{=} \PYG{p}{[}\PYG{n}{cur\PYGZus{}img}\PYG{p}{]} \PYG{c+c1}{\PYGZsh{} stores the current image in the iteration list}
    \PYG{k}{if} \PYG{p}{(}\PYG{n}{cur\PYGZus{}img} \PYG{o}{==} \PYG{n}{last\PYGZus{}img}\PYG{p}{)}\PYG{o}{.}\PYG{n}{all}\PYG{p}{(}\PYG{p}{)}\PYG{p}{:}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Done}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{k}{break}
    \PYG{k}{else}\PYG{p}{:}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Iteration}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{iteration}\PYG{p}{,}
              \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Groups}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{unique}\PYG{p}{(}\PYG{n}{cur\PYGZus{}img}\PYG{p}{[}\PYG{n}{cur\PYGZus{}img} \PYG{o}{\PYGZgt{}} \PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{ravel}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}
              \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Changes}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{np}\PYG{o}{.}\PYG{n}{sum}\PYG{p}{(}\PYG{n}{cur\PYGZus{}img} \PYG{o}{!=} \PYG{n}{last\PYGZus{}img}\PYG{p}{)}\PYG{p}{)}
        \PYG{n}{last\PYGZus{}img} \PYG{o}{=} \PYG{n}{cur\PYGZus{}img}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
Iteration 0 Groups 62 Changes 79
Iteration 1 Groups 46 Changes 74
Iteration 2 Groups 32 Changes 68
Iteration 3 Groups 22 Changes 59
Iteration 4 Groups 14 Changes 46
Iteration 5 Groups 8 Changes 31
Iteration 6 Groups 5 Changes 17
Iteration 7 Groups 3 Changes 6
Iteration 8 Groups 2 Changes 1
Done
\end{sphinxVerbatim}


\subsection{Let’s animate the iterations}
\label{\detokenize{06-ShapeAnalysis:id1}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{fig}\PYG{p}{,} \PYG{n}{c\PYGZus{}ax} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,} \PYG{l+m+mi}{5}\PYG{p}{)}\PYG{p}{,} \PYG{n}{dpi}\PYG{o}{=}\PYG{l+m+mi}{100}\PYG{p}{)}

\PYG{k}{def} \PYG{n+nf}{update\PYGZus{}frame}\PYG{p}{(}\PYG{n}{i}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{plt}\PYG{o}{.}\PYG{n}{cla}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{sns}\PYG{o}{.}\PYG{n}{heatmap}\PYG{p}{(}\PYG{n}{img\PYGZus{}list}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{,}
                \PYG{n}{annot}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,}
                \PYG{n}{fmt}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{d}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
                \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{nipy\PYGZus{}spectral}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                \PYG{n}{ax}\PYG{o}{=}\PYG{n}{c\PYGZus{}ax}\PYG{p}{,}
                \PYG{n}{cbar}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{,}
                \PYG{n}{vmin}\PYG{o}{=}\PYG{n}{img\PYGZus{}list}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{min}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,}
                \PYG{n}{vmax}\PYG{o}{=}\PYG{n}{img\PYGZus{}list}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{max}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
    \PYG{n}{c\PYGZus{}ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Iteration \PYGZsh{}}\PYG{l+s+si}{\PYGZob{}\PYGZcb{}}\PYG{l+s+s1}{, Groups }\PYG{l+s+si}{\PYGZob{}\PYGZcb{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{i}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{,}
                                                     \PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{unique}\PYG{p}{(}\PYG{n}{img\PYGZus{}list}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{[}\PYG{n}{img\PYGZus{}list}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]} \PYG{o}{\PYGZgt{}} \PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{ravel}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}


\PYG{c+c1}{\PYGZsh{} write animation frames}
\PYG{n}{anim\PYGZus{}code} \PYG{o}{=} \PYG{n}{FuncAnimation}\PYG{p}{(}\PYG{n}{fig}\PYG{p}{,}
                          \PYG{n}{update\PYGZus{}frame}\PYG{p}{,}
                          \PYG{n}{frames}\PYG{o}{=}\PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{img\PYGZus{}list}\PYG{p}{)}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{,}
                          \PYG{n}{interval}\PYG{o}{=}\PYG{l+m+mi}{500}\PYG{p}{,}
                          \PYG{n}{repeat\PYGZus{}delay}\PYG{o}{=}\PYG{l+m+mi}{1000}\PYG{p}{)}\PYG{o}{.}\PYG{n}{to\PYGZus{}html5\PYGZus{}video}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{close}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{all}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{HTML}\PYG{p}{(}\PYG{n}{anim\PYGZus{}code}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZlt{}IPython.core.display.HTML object\PYGZgt{}
\end{sphinxVerbatim}


\section{Different Neighborhoods}
\label{\detokenize{06-ShapeAnalysis:different-neighborhoods}}
\sphinxAtStartPar
We can expand beyond the 3x3 neighborhood to a 5x5 for example

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{last\PYGZus{}img} \PYG{o}{=} \PYG{n}{idx\PYGZus{}img}\PYG{o}{.}\PYG{n}{copy}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{img\PYGZus{}list} \PYG{o}{=} \PYG{p}{[}\PYG{n}{last\PYGZus{}img}\PYG{p}{]}
\PYG{k}{for} \PYG{n}{iteration} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{99}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{cur\PYGZus{}img} \PYG{o}{=} \PYG{n}{last\PYGZus{}img}\PYG{o}{.}\PYG{n}{copy}\PYG{p}{(}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{x} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{last\PYGZus{}img}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{:}
        \PYG{k}{for} \PYG{n}{y} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{last\PYGZus{}img}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{:}
            \PYG{k}{if} \PYG{n}{last\PYGZus{}img}\PYG{p}{[}\PYG{n}{x}\PYG{p}{,} \PYG{n}{y}\PYG{p}{]} \PYG{o}{\PYGZgt{}} \PYG{l+m+mi}{0}\PYG{p}{:}
                \PYG{n}{i\PYGZus{}xy} \PYG{o}{=} \PYG{n}{last\PYGZus{}img}\PYG{p}{[}\PYG{n}{x}\PYG{p}{,} \PYG{n}{y}\PYG{p}{]}
                \PYG{k}{for} \PYG{n}{xp} \PYG{o+ow}{in} \PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{]}\PYG{p}{:}
                    \PYG{k}{if} \PYG{p}{(}\PYG{n}{x}\PYG{o}{+}\PYG{n}{xp} \PYG{o}{\PYGZlt{}} \PYG{n}{last\PYGZus{}img}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)} \PYG{o+ow}{and} \PYG{p}{(}\PYG{n}{x}\PYG{o}{+}\PYG{n}{xp} \PYG{o}{\PYGZgt{}}\PYG{o}{=} \PYG{l+m+mi}{0}\PYG{p}{)}\PYG{p}{:}
                        \PYG{k}{for} \PYG{n}{yp} \PYG{o+ow}{in} \PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{]}\PYG{p}{:}
                            \PYG{k}{if} \PYG{p}{(}\PYG{n}{y}\PYG{o}{+}\PYG{n}{yp} \PYG{o}{\PYGZlt{}} \PYG{n}{last\PYGZus{}img}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)} \PYG{o+ow}{and} \PYG{p}{(}\PYG{n}{y}\PYG{o}{+}\PYG{n}{yp} \PYG{o}{\PYGZgt{}}\PYG{o}{=} \PYG{l+m+mi}{0}\PYG{p}{)}\PYG{p}{:}
                                \PYG{n}{i\PYGZus{}xpyp} \PYG{o}{=} \PYG{n}{last\PYGZus{}img}\PYG{p}{[}\PYG{n}{x}\PYG{o}{+}\PYG{n}{xp}\PYG{p}{,} \PYG{n}{y}\PYG{o}{+}\PYG{n}{yp}\PYG{p}{]}
                                \PYG{k}{if} \PYG{n}{i\PYGZus{}xpyp} \PYG{o}{\PYGZgt{}} \PYG{l+m+mi}{0}\PYG{p}{:}
                                    \PYG{n}{new\PYGZus{}val} \PYG{o}{=} \PYG{n+nb}{min}\PYG{p}{(}\PYG{n}{i\PYGZus{}xy}\PYG{p}{,} \PYG{n}{i\PYGZus{}xpyp}\PYG{p}{,} \PYG{n}{cur\PYGZus{}img}\PYG{p}{[}\PYG{n}{x}\PYG{p}{,} \PYG{n}{y}\PYG{p}{]}\PYG{p}{)}
                                    \PYG{k}{if} \PYG{n}{cur\PYGZus{}img}\PYG{p}{[}\PYG{n}{x}\PYG{p}{,} \PYG{n}{y}\PYG{p}{]} \PYG{o}{!=} \PYG{n}{new\PYGZus{}val}\PYG{p}{:}
                                        \PYG{n}{cur\PYGZus{}img}\PYG{p}{[}\PYG{n}{x}\PYG{p}{,} \PYG{n}{y}\PYG{p}{]} \PYG{o}{=} \PYG{n}{new\PYGZus{}val}

    \PYG{n}{img\PYGZus{}list} \PYG{o}{+}\PYG{o}{=} \PYG{p}{[}\PYG{n}{cur\PYGZus{}img}\PYG{p}{]}
    \PYG{k}{if} \PYG{p}{(}\PYG{n}{cur\PYGZus{}img} \PYG{o}{==} \PYG{n}{last\PYGZus{}img}\PYG{p}{)}\PYG{o}{.}\PYG{n}{all}\PYG{p}{(}\PYG{p}{)}\PYG{p}{:}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Done}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{k}{break}
    \PYG{k}{else}\PYG{p}{:}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Iteration}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{iteration}\PYG{p}{,}
              \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Groups}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{unique}\PYG{p}{(}\PYG{n}{cur\PYGZus{}img}\PYG{p}{[}\PYG{n}{cur\PYGZus{}img} \PYG{o}{\PYGZgt{}} \PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{ravel}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}
              \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Changes}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{np}\PYG{o}{.}\PYG{n}{sum}\PYG{p}{(}\PYG{n}{cur\PYGZus{}img} \PYG{o}{!=} \PYG{n}{last\PYGZus{}img}\PYG{p}{)}\PYG{p}{)}
        \PYG{n}{last\PYGZus{}img} \PYG{o}{=} \PYG{n}{cur\PYGZus{}img}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
Iteration 0 Groups 49 Changes 81
Iteration 1 Groups 24 Changes 71
Iteration 2 Groups 8 Changes 51
Iteration 3 Groups 2 Changes 20
Iteration 4 Groups 1 Changes 1
Done
\end{sphinxVerbatim}


\subsection{Animate the labeling iterations}
\label{\detokenize{06-ShapeAnalysis:animate-the-labeling-iterations}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{fig}\PYG{p}{,} \PYG{n}{c\PYGZus{}ax} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,} \PYG{l+m+mi}{5}\PYG{p}{)}\PYG{p}{,} \PYG{n}{dpi}\PYG{o}{=}\PYG{l+m+mi}{100}\PYG{p}{)}

\PYG{k}{def} \PYG{n+nf}{update\PYGZus{}frame}\PYG{p}{(}\PYG{n}{i}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{plt}\PYG{o}{.}\PYG{n}{cla}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{sns}\PYG{o}{.}\PYG{n}{heatmap}\PYG{p}{(}\PYG{n}{img\PYGZus{}list}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{,}
                \PYG{n}{annot}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,}
                \PYG{n}{fmt}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{d}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
                \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{nipy\PYGZus{}spectral}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                \PYG{n}{ax}\PYG{o}{=}\PYG{n}{c\PYGZus{}ax}\PYG{p}{,}
                \PYG{n}{cbar}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{,}
                \PYG{n}{vmin}\PYG{o}{=}\PYG{n}{img\PYGZus{}list}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{min}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,}
                \PYG{n}{vmax}\PYG{o}{=}\PYG{n}{img\PYGZus{}list}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{max}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
    \PYG{n}{c\PYGZus{}ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Iteration \PYGZsh{}}\PYG{l+s+si}{\PYGZob{}\PYGZcb{}}\PYG{l+s+s1}{, Groups }\PYG{l+s+si}{\PYGZob{}\PYGZcb{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{i}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{,}
                                                     \PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{unique}\PYG{p}{(}\PYG{n}{img\PYGZus{}list}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{[}\PYG{n}{img\PYGZus{}list}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]} \PYG{o}{\PYGZgt{}} \PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{ravel}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} write animation frames}
\PYG{n}{anim\PYGZus{}code} \PYG{o}{=} \PYG{n}{FuncAnimation}\PYG{p}{(}\PYG{n}{fig}\PYG{p}{,}
                          \PYG{n}{update\PYGZus{}frame}\PYG{p}{,}
                          \PYG{n}{frames}\PYG{o}{=}\PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{img\PYGZus{}list}\PYG{p}{)}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{,}
                          \PYG{n}{interval}\PYG{o}{=}\PYG{l+m+mi}{500}\PYG{p}{,}
                          \PYG{n}{repeat\PYGZus{}delay}\PYG{o}{=}\PYG{l+m+mi}{1000}\PYG{p}{)}\PYG{o}{.}\PYG{n}{to\PYGZus{}html5\PYGZus{}video}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{close}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{all}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{HTML}\PYG{p}{(}\PYG{n}{anim\PYGZus{}code}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZlt{}IPython.core.display.HTML object\PYGZgt{}
\end{sphinxVerbatim}


\section{Or a smaller kernel}
\label{\detokenize{06-ShapeAnalysis:or-a-smaller-kernel}}
\sphinxAtStartPar
By using a smaller kernel (in this case where \(\sqrt{x^2+y^2}<=1\), we cause the number of iterations to fill to increase and prevent the last pixel from being grouped since it is only connected diagonally


\begin{savenotes}\sphinxattablestart
\centering
\begin{tabulary}{\linewidth}[t]{|T|T|T|}
\hline

\sphinxAtStartPar

&
\sphinxAtStartPar

&
\sphinxAtStartPar

\\
\hline
\sphinxAtStartPar
0
&
\sphinxAtStartPar
1
&
\sphinxAtStartPar
0
\\
\hline
\sphinxAtStartPar
1
&
\sphinxAtStartPar
1
&
\sphinxAtStartPar
1
\\
\hline
\sphinxAtStartPar
0
&
\sphinxAtStartPar
1
&
\sphinxAtStartPar
0
\\
\hline
\end{tabulary}
\par
\sphinxattableend\end{savenotes}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{last\PYGZus{}img} \PYG{o}{=} \PYG{n}{idx\PYGZus{}img}\PYG{o}{.}\PYG{n}{copy}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{img\PYGZus{}list} \PYG{o}{=} \PYG{p}{[}\PYG{n}{last\PYGZus{}img}\PYG{p}{]}
\PYG{k}{for} \PYG{n}{iteration} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{99}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{cur\PYGZus{}img} \PYG{o}{=} \PYG{n}{last\PYGZus{}img}\PYG{o}{.}\PYG{n}{copy}\PYG{p}{(}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{x} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{last\PYGZus{}img}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{:}
        \PYG{k}{for} \PYG{n}{y} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{last\PYGZus{}img}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{:}
            \PYG{k}{if} \PYG{n}{last\PYGZus{}img}\PYG{p}{[}\PYG{n}{x}\PYG{p}{,} \PYG{n}{y}\PYG{p}{]} \PYG{o}{\PYGZgt{}} \PYG{l+m+mi}{0}\PYG{p}{:}
                \PYG{n}{i\PYGZus{}xy} \PYG{o}{=} \PYG{n}{last\PYGZus{}img}\PYG{p}{[}\PYG{n}{x}\PYG{p}{,} \PYG{n}{y}\PYG{p}{]}
                \PYG{k}{for} \PYG{n}{xp} \PYG{o+ow}{in} \PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{:}
                    \PYG{k}{if} \PYG{p}{(}\PYG{n}{x}\PYG{o}{+}\PYG{n}{xp} \PYG{o}{\PYGZlt{}} \PYG{n}{last\PYGZus{}img}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)} \PYG{o+ow}{and} \PYG{p}{(}\PYG{n}{x}\PYG{o}{+}\PYG{n}{xp} \PYG{o}{\PYGZgt{}}\PYG{o}{=} \PYG{l+m+mi}{0}\PYG{p}{)}\PYG{p}{:}
                        \PYG{k}{for} \PYG{n}{yp} \PYG{o+ow}{in} \PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{:}
                            \PYG{k}{if} \PYG{n}{np}\PYG{o}{.}\PYG{n}{abs}\PYG{p}{(}\PYG{n}{xp}\PYG{p}{)}\PYG{o}{+}\PYG{n}{np}\PYG{o}{.}\PYG{n}{abs}\PYG{p}{(}\PYG{n}{yp}\PYG{p}{)} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{l+m+mi}{1}\PYG{p}{:}
                                \PYG{k}{if} \PYG{p}{(}\PYG{n}{y}\PYG{o}{+}\PYG{n}{yp} \PYG{o}{\PYGZlt{}} \PYG{n}{last\PYGZus{}img}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)} \PYG{o+ow}{and} \PYG{p}{(}\PYG{n}{y}\PYG{o}{+}\PYG{n}{yp} \PYG{o}{\PYGZgt{}}\PYG{o}{=} \PYG{l+m+mi}{0}\PYG{p}{)}\PYG{p}{:}
                                    \PYG{n}{i\PYGZus{}xpyp} \PYG{o}{=} \PYG{n}{last\PYGZus{}img}\PYG{p}{[}\PYG{n}{x}\PYG{o}{+}\PYG{n}{xp}\PYG{p}{,} \PYG{n}{y}\PYG{o}{+}\PYG{n}{yp}\PYG{p}{]}
                                    \PYG{k}{if} \PYG{n}{i\PYGZus{}xpyp} \PYG{o}{\PYGZgt{}} \PYG{l+m+mi}{0}\PYG{p}{:}
                                        \PYG{n}{new\PYGZus{}val} \PYG{o}{=} \PYG{n+nb}{min}\PYG{p}{(}
                                            \PYG{n}{i\PYGZus{}xy}\PYG{p}{,} \PYG{n}{i\PYGZus{}xpyp}\PYG{p}{,} \PYG{n}{cur\PYGZus{}img}\PYG{p}{[}\PYG{n}{x}\PYG{p}{,} \PYG{n}{y}\PYG{p}{]}\PYG{p}{)}
                                        \PYG{k}{if} \PYG{n}{cur\PYGZus{}img}\PYG{p}{[}\PYG{n}{x}\PYG{p}{,} \PYG{n}{y}\PYG{p}{]} \PYG{o}{!=} \PYG{n}{new\PYGZus{}val}\PYG{p}{:}
                                            \PYG{n}{cur\PYGZus{}img}\PYG{p}{[}\PYG{n}{x}\PYG{p}{,} \PYG{n}{y}\PYG{p}{]} \PYG{o}{=} \PYG{n}{new\PYGZus{}val}

    \PYG{n}{img\PYGZus{}list} \PYG{o}{+}\PYG{o}{=} \PYG{p}{[}\PYG{n}{cur\PYGZus{}img}\PYG{p}{]}
    \PYG{k}{if} \PYG{p}{(}\PYG{n}{cur\PYGZus{}img} \PYG{o}{==} \PYG{n}{last\PYGZus{}img}\PYG{p}{)}\PYG{o}{.}\PYG{n}{all}\PYG{p}{(}\PYG{p}{)}\PYG{p}{:}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Done}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{k}{break}
    \PYG{k}{else}\PYG{p}{:}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Iteration}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{iteration}\PYG{p}{,}
              \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Groups}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{unique}\PYG{p}{(}\PYG{n}{cur\PYGZus{}img}\PYG{p}{[}\PYG{n}{cur\PYGZus{}img} \PYG{o}{\PYGZgt{}} \PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{ravel}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}
              \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Changes}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{np}\PYG{o}{.}\PYG{n}{sum}\PYG{p}{(}\PYG{n}{cur\PYGZus{}img} \PYG{o}{!=} \PYG{n}{last\PYGZus{}img}\PYG{p}{)}\PYG{p}{)}
        \PYG{n}{last\PYGZus{}img} \PYG{o}{=} \PYG{n}{cur\PYGZus{}img}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
Iteration 0 Groups 68 Changes 76
Iteration 1 Groups 54 Changes 73
Iteration 2 Groups 42 Changes 67
Iteration 3 Groups 31 Changes 62
Iteration 4 Groups 21 Changes 57
Iteration 5 Groups 13 Changes 49
Iteration 6 Groups 11 Changes 39
Iteration 7 Groups 9 Changes 34
Iteration 8 Groups 8 Changes 25
Iteration 9 Groups 7 Changes 20
Iteration 10 Groups 6 Changes 15
Iteration 11 Groups 5 Changes 10
Iteration 12 Groups 4 Changes 6
Iteration 13 Groups 3 Changes 2
Done
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{fig}\PYG{p}{,} \PYG{n}{c\PYGZus{}ax} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{6}\PYG{p}{,} \PYG{l+m+mi}{6}\PYG{p}{)}\PYG{p}{,} \PYG{n}{dpi}\PYG{o}{=}\PYG{l+m+mi}{100}\PYG{p}{)}


\PYG{k}{def} \PYG{n+nf}{update\PYGZus{}frame}\PYG{p}{(}\PYG{n}{i}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{plt}\PYG{o}{.}\PYG{n}{cla}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{sns}\PYG{o}{.}\PYG{n}{heatmap}\PYG{p}{(}\PYG{n}{img\PYGZus{}list}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{,}
                \PYG{n}{annot}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,}
                \PYG{n}{fmt}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{d}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
                \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{nipy\PYGZus{}spectral}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                \PYG{n}{ax}\PYG{o}{=}\PYG{n}{c\PYGZus{}ax}\PYG{p}{,}
                \PYG{n}{cbar}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{,}
                \PYG{n}{vmin}\PYG{o}{=}\PYG{n}{img\PYGZus{}list}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{min}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,}
                \PYG{n}{vmax}\PYG{o}{=}\PYG{n}{img\PYGZus{}list}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{max}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
    \PYG{n}{c\PYGZus{}ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Iteration \PYGZsh{}}\PYG{l+s+si}{\PYGZob{}\PYGZcb{}}\PYG{l+s+s1}{, Groups }\PYG{l+s+si}{\PYGZob{}\PYGZcb{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{i}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{,}
                                                     \PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{unique}\PYG{p}{(}\PYG{n}{img\PYGZus{}list}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{[}\PYG{n}{img\PYGZus{}list}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]} \PYG{o}{\PYGZgt{}} \PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{ravel}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}


\PYG{c+c1}{\PYGZsh{} write animation frames}
\PYG{n}{anim\PYGZus{}code} \PYG{o}{=} \PYG{n}{FuncAnimation}\PYG{p}{(}\PYG{n}{fig}\PYG{p}{,}
                          \PYG{n}{update\PYGZus{}frame}\PYG{p}{,}
                          \PYG{n}{frames}\PYG{o}{=}\PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{img\PYGZus{}list}\PYG{p}{)}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{,}
                          \PYG{n}{interval}\PYG{o}{=}\PYG{l+m+mi}{500}\PYG{p}{,}
                          \PYG{n}{repeat\PYGZus{}delay}\PYG{o}{=}\PYG{l+m+mi}{1000}\PYG{p}{)}\PYG{o}{.}\PYG{n}{to\PYGZus{}html5\PYGZus{}video}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{close}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{all}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{HTML}\PYG{p}{(}\PYG{n}{anim\PYGZus{}code}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZlt{}IPython.core.display.HTML object\PYGZgt{}
\end{sphinxVerbatim}


\section{Comparing different neighborhoods}
\label{\detokenize{06-ShapeAnalysis:comparing-different-neighborhoods}}

\begin{savenotes}\sphinxattablestart
\centering
\begin{tabulary}{\linewidth}[t]{|T|T|T|}
\hline
\sphinxstyletheadfamily 
\sphinxAtStartPar
Neighborhood size
&\sphinxstyletheadfamily 
\sphinxAtStartPar
Iterations
&\sphinxstyletheadfamily 
\sphinxAtStartPar
Segments
\\
\hline
\sphinxAtStartPar
3x3
&
\sphinxAtStartPar
9
&
\sphinxAtStartPar
2
\\
\hline
\sphinxAtStartPar
5x5
&
\sphinxAtStartPar
5
&
\sphinxAtStartPar
1
\\
\hline
\sphinxAtStartPar
cross
&
\sphinxAtStartPar
14
&
\sphinxAtStartPar
3
\\
\hline
\end{tabulary}
\par
\sphinxattableend\end{savenotes}


\chapter{Beyond component labeling \sphinxhyphen{} what can we measure?}
\label{\detokenize{06-ShapeAnalysis:beyond-component-labeling-what-can-we-measure}}
\sphinxAtStartPar
Now all the voxels which are connected have the same label. We can then perform simple metrics like
\begin{itemize}
\item {} 
\sphinxAtStartPar
counting the number of voxels in each label to estimate volume.

\item {} 
\sphinxAtStartPar
looking at the change in volume during erosion or dilation to estimate surface area

\end{itemize}


\section{What we would like to to do}
\label{\detokenize{06-ShapeAnalysis:what-we-would-like-to-to-do}}\begin{itemize}
\item {} 
\sphinxAtStartPar
Count the cells

\item {} 
\sphinxAtStartPar
Say something about the cells

\item {} 
\sphinxAtStartPar
Compare the cells in this image to another image

\end{itemize}

\sphinxAtStartPar
… But where do we start?


\section{Object position \sphinxhyphen{} Center of Volume (COV): With a single object}
\label{\detokenize{06-ShapeAnalysis:object-position-center-of-volume-cov-with-a-single-object}}\begin{equation*}
\begin{split} I_{id}(x,y) = 
\begin{cases}
1, & L(x,y) = id \\
0, & \text{otherwise}
\end{cases}\end{split}
\end{equation*}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{seg\PYGZus{}img} \PYG{o}{=} \PYG{n}{imread}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{figures/aachen\PYGZus{}label.png}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)} \PYG{o}{==} \PYG{l+m+mi}{26}
\PYG{n}{seg\PYGZus{}img} \PYG{o}{=} \PYG{n}{seg\PYGZus{}img}\PYG{p}{[}\PYG{p}{:}\PYG{p}{:}\PYG{l+m+mi}{4}\PYG{p}{,} \PYG{p}{:}\PYG{p}{:}\PYG{l+m+mi}{4}\PYG{p}{]}
\PYG{n}{seg\PYGZus{}img} \PYG{o}{=} \PYG{n}{seg\PYGZus{}img}\PYG{p}{[}\PYG{l+m+mi}{110}\PYG{p}{:}\PYG{l+m+mi}{130}\PYG{p}{:}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{370}\PYG{p}{:}\PYG{l+m+mi}{420}\PYG{p}{:}\PYG{l+m+mi}{3}\PYG{p}{]}
\PYG{n}{seg\PYGZus{}img}\PYG{p}{[}\PYG{l+m+mi}{9}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{]} \PYG{o}{=} \PYG{l+m+mi}{1}
\PYG{n}{lab\PYGZus{}img} \PYG{o}{=} \PYG{n}{label}\PYG{p}{(}\PYG{n}{seg\PYGZus{}img}\PYG{p}{)}
\PYG{n}{fig}\PYG{p}{,} \PYG{n}{ax} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{n}{figsize}\PYG{o}{=}\PYG{p}{[}\PYG{l+m+mi}{8}\PYG{p}{,}\PYG{l+m+mi}{6}\PYG{p}{]}\PYG{p}{,}\PYG{n}{dpi}\PYG{o}{=}\PYG{l+m+mi}{100}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Using matshow here just because it sets the ticks up nicely. imshow is faster.}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{matshow}\PYG{p}{(}\PYG{n}{lab\PYGZus{}img}\PYG{p}{,}\PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{viridis}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{k}{for} \PYG{p}{(}\PYG{n}{i}\PYG{p}{,} \PYG{n}{j}\PYG{p}{)}\PYG{p}{,} \PYG{n}{z} \PYG{o+ow}{in} \PYG{n}{np}\PYG{o}{.}\PYG{n}{ndenumerate}\PYG{p}{(}\PYG{n}{lab\PYGZus{}img}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{text}\PYG{p}{(}\PYG{n}{j}\PYG{p}{,} \PYG{n}{i}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+si}{\PYGZob{}\PYGZcb{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{z}\PYG{p}{)}\PYG{p}{,} \PYG{n}{ha}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{center}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{va}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{center}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{06-ShapeAnalysis_57_0}.png}


\subsection{Define a center}
\label{\detokenize{06-ShapeAnalysis:define-a-center}}\begin{equation*}
\begin{split} \bar{x} = \frac{1}{N} \sum_{\vec{v}\in I_{id}} \vec{v}\cdot\vec{i} \end{split}
\end{equation*}\begin{equation*}
\begin{split} \bar{y} = \frac{1}{N} \sum_{\vec{v}\in I_{id}} \vec{v}\cdot\vec{j} \end{split}
\end{equation*}\begin{equation*}
\begin{split} \bar{z} = \frac{1}{N} \sum_{\vec{v}\in I_{id}} \vec{v}\cdot\vec{k} \end{split}
\end{equation*}
\sphinxAtStartPar
i.e. the average position of all pixels in each direction.


\subsection{Center of a labeled item}
\label{\detokenize{06-ShapeAnalysis:center-of-a-labeled-item}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{x\PYGZus{}coord}\PYG{p}{,} \PYG{n}{y\PYGZus{}coord} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{p}{]}
\PYG{k}{for} \PYG{n}{x} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{lab\PYGZus{}img}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{for} \PYG{n}{y} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{lab\PYGZus{}img}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{:}
        \PYG{k}{if} \PYG{n}{lab\PYGZus{}img}\PYG{p}{[}\PYG{n}{x}\PYG{p}{,} \PYG{n}{y}\PYG{p}{]} \PYG{o}{==} \PYG{l+m+mi}{2}\PYG{p}{:}
            \PYG{n}{x\PYGZus{}coord} \PYG{o}{+}\PYG{o}{=} \PYG{p}{[}\PYG{n}{x}\PYG{p}{]}
            \PYG{n}{y\PYGZus{}coord} \PYG{o}{+}\PYG{o}{=} \PYG{p}{[}\PYG{n}{y}\PYG{p}{]}
\PYG{n}{items} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{o}{.}\PYG{n}{from\PYGZus{}dict}\PYG{p}{(}\PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{x}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{x\PYGZus{}coord}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{y}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{y\PYGZus{}coord}\PYG{p}{\PYGZcb{}}\PYG{p}{)}

\PYG{n}{fig}\PYG{p}{,} \PYG{n}{ax} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{l+m+mi}{2}\PYG{p}{,}\PYG{n}{figsize}\PYG{o}{=}\PYG{p}{[}\PYG{l+m+mi}{15}\PYG{p}{,}\PYG{l+m+mi}{6}\PYG{p}{]}\PYG{p}{,}\PYG{n}{dpi}\PYG{o}{=}\PYG{l+m+mi}{100}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Using matshow here just because it sets the ticks up nicely. imshow is faster.}
\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{matshow}\PYG{p}{(}\PYG{n}{lab\PYGZus{}img}\PYG{p}{,}\PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{viridis}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{n}{y\PYGZus{}coord}\PYG{p}{)}\PYG{p}{,}\PYG{n}{np}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{n}{x\PYGZus{}coord}\PYG{p}{)}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rX}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
        \PYG{n}{label}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{x=}\PYG{l+s+si}{\PYGZob{}0:0.2f\PYGZcb{}}\PYG{l+s+s2}{, y= }\PYG{l+s+si}{\PYGZob{}1:0.2f\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{n}{x\PYGZus{}coord}\PYG{p}{)}\PYG{p}{,} \PYG{n}{np}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{n}{y\PYGZus{}coord}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{legend}\PYG{p}{(}\PYG{p}{)}
\PYG{k}{for} \PYG{p}{(}\PYG{n}{i}\PYG{p}{,} \PYG{n}{j}\PYG{p}{)}\PYG{p}{,} \PYG{n}{z} \PYG{o+ow}{in} \PYG{n}{np}\PYG{o}{.}\PYG{n}{ndenumerate}\PYG{p}{(}\PYG{n}{lab\PYGZus{}img}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{text}\PYG{p}{(}\PYG{n}{j}\PYG{p}{,} \PYG{n}{i}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+si}{\PYGZob{}\PYGZcb{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{z}\PYG{p}{)}\PYG{p}{,} \PYG{n}{ha}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{center}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{va}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{center}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{pd}\PYG{o}{.}\PYG{n}{plotting}\PYG{o}{.}\PYG{n}{table}\PYG{p}{(}\PYG{n}{data}\PYG{o}{=}\PYG{n}{items}\PYG{p}{,} \PYG{n}{ax}\PYG{o}{=}\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{n}{loc}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{center}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Coordinates of Item 2}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;} \PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{axis}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{off}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{06-ShapeAnalysis_60_0}.png}


\section{Center of Mass (COM): With a single object}
\label{\detokenize{06-ShapeAnalysis:center-of-mass-com-with-a-single-object}}
\sphinxAtStartPar
If the gray values are kept (or other meaningful ones are used), this can be seen as a weighted center of volume or center of mass (using \(I_{gy}\) to distinguish it from the labels)


\subsection{Define a center}
\label{\detokenize{06-ShapeAnalysis:id2}}\begin{equation*}
\begin{split} \Sigma I_{gy} = \frac{1}{N} \sum_{\vec{v}\in I_{id}} I_{gy}(\vec{v}) \end{split}
\end{equation*}\begin{equation*}
\begin{split} \bar{x} = \frac{1}{\Sigma I_{gy}} \sum_{\vec{v}\in I_{id}} (\vec{v}\cdot\vec{i}) I_{gy}(\vec{v}) \end{split}
\end{equation*}\begin{equation*}
\begin{split} \bar{y} = \frac{1}{\Sigma I_{gy}} \sum_{\vec{v}\in I_{id}} (\vec{v}\cdot\vec{j}) I_{gy}(\vec{v}) \end{split}
\end{equation*}\begin{equation*}
\begin{split} \bar{z} = \frac{1}{\Sigma I_{gy}} \sum_{\vec{v}\in I_{id}} (\vec{v}\cdot\vec{k}) I_{gy}(\vec{v}) \end{split}
\end{equation*}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{xx}\PYG{p}{,} \PYG{n}{yy} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{meshgrid}\PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{linspace}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{10}\PYG{p}{,} \PYG{l+m+mi}{50}\PYG{p}{)}\PYG{p}{,}
                     \PYG{n}{np}\PYG{o}{.}\PYG{n}{linspace}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{10}\PYG{p}{,} \PYG{l+m+mi}{50}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{gray\PYGZus{}img} \PYG{o}{=} \PYG{l+m+mi}{100}\PYG{o}{*}\PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{abs}\PYG{p}{(}\PYG{n}{xx}\PYG{o}{*}\PYG{n}{yy}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{7}\PYG{p}{)} \PYG{o}{+} \PYG{n}{np}\PYG{o}{.}\PYG{n}{square}\PYG{p}{(}\PYG{n}{yy}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{4}\PYG{p}{)}\PYG{p}{)}\PYG{o}{+}\PYG{l+m+mf}{0.25}
\PYG{n}{gray\PYGZus{}img} \PYG{o}{*}\PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{abs}\PYG{p}{(}\PYG{n}{xx}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{5}\PYG{p}{)} \PYG{o}{\PYGZlt{}} \PYG{l+m+mi}{3}
\PYG{n}{gray\PYGZus{}img} \PYG{o}{*}\PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{abs}\PYG{p}{(}\PYG{n}{yy}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{5}\PYG{p}{)} \PYG{o}{\PYGZlt{}} \PYG{l+m+mi}{3}
\PYG{n}{gray\PYGZus{}img}\PYG{p}{[}\PYG{n}{gray\PYGZus{}img} \PYG{o}{\PYGZgt{}} \PYG{l+m+mi}{0}\PYG{p}{]} \PYG{o}{+}\PYG{o}{=} \PYG{l+m+mi}{5}
\PYG{n}{seg\PYGZus{}img} \PYG{o}{=} \PYG{p}{(}\PYG{n}{gray\PYGZus{}img} \PYG{o}{\PYGZgt{}} \PYG{l+m+mi}{0}\PYG{p}{)}\PYG{o}{.}\PYG{n}{astype}\PYG{p}{(}\PYG{n+nb}{int}\PYG{p}{)}
\PYG{n}{\PYGZus{}}\PYG{p}{,} \PYG{p}{(}\PYG{n}{ax1}\PYG{p}{,} \PYG{n}{ax2}\PYG{p}{)} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{14}\PYG{p}{,} \PYG{l+m+mi}{6}\PYG{p}{)}\PYG{p}{,} \PYG{n}{dpi}\PYG{o}{=}\PYG{l+m+mi}{150}\PYG{p}{)}

\PYG{n}{sns}\PYG{o}{.}\PYG{n}{heatmap}\PYG{p}{(}\PYG{n}{gray\PYGZus{}img}\PYG{p}{,}\PYG{n}{ax}\PYG{o}{=}\PYG{n}{ax1}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{bone\PYGZus{}r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{cbar}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}
\PYG{n}{ax1}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Intensity Image}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{n}{sns}\PYG{o}{.}\PYG{n}{heatmap}\PYG{p}{(}\PYG{n}{seg\PYGZus{}img}\PYG{p}{,} \PYG{n}{ax}\PYG{o}{=}\PYG{n}{ax2}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{bone}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{cbar}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}
\PYG{n}{ax2}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Segmented Image}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{06-ShapeAnalysis_62_0}.png}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Collect information}
\PYG{n}{x\PYGZus{}coord}\PYG{p}{,} \PYG{n}{y\PYGZus{}coord}\PYG{p}{,} \PYG{n}{i\PYGZus{}val} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{p}{]}
\PYG{k}{for} \PYG{n}{x} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{seg\PYGZus{}img}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{for} \PYG{n}{y} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{seg\PYGZus{}img}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{:}
        \PYG{k}{if} \PYG{n}{seg\PYGZus{}img}\PYG{p}{[}\PYG{n}{x}\PYG{p}{,} \PYG{n}{y}\PYG{p}{]} \PYG{o}{==} \PYG{l+m+mi}{1}\PYG{p}{:}
            \PYG{n}{x\PYGZus{}coord} \PYG{o}{+}\PYG{o}{=} \PYG{p}{[}\PYG{n}{x}\PYG{p}{]}
            \PYG{n}{y\PYGZus{}coord} \PYG{o}{+}\PYG{o}{=} \PYG{p}{[}\PYG{n}{y}\PYG{p}{]}
            \PYG{n}{i\PYGZus{}val}   \PYG{o}{+}\PYG{o}{=} \PYG{p}{[}\PYG{n}{gray\PYGZus{}img}\PYG{p}{[}\PYG{n}{x}\PYG{p}{,} \PYG{n}{y}\PYG{p}{]}\PYG{p}{]}

\PYG{n}{x\PYGZus{}coord} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{array}\PYG{p}{(}\PYG{n}{x\PYGZus{}coord}\PYG{p}{)}
\PYG{n}{y\PYGZus{}coord} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{array}\PYG{p}{(}\PYG{n}{y\PYGZus{}coord}\PYG{p}{)}
\PYG{n}{i\PYGZus{}val}   \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{array}\PYG{p}{(}\PYG{n}{i\PYGZus{}val}\PYG{p}{)}
\PYG{n}{cov\PYGZus{}x}   \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{n}{x\PYGZus{}coord}\PYG{p}{)}
\PYG{n}{cov\PYGZus{}y}   \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{n}{y\PYGZus{}coord}\PYG{p}{)}
\PYG{n}{com\PYGZus{}x}   \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{n}{x\PYGZus{}coord}\PYG{o}{*}\PYG{n}{i\PYGZus{}val}\PYG{p}{)}\PYG{o}{/}\PYG{n}{i\PYGZus{}val}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{com\PYGZus{}y}   \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{n}{y\PYGZus{}coord}\PYG{o}{*}\PYG{n}{i\PYGZus{}val}\PYG{p}{)}\PYG{o}{/}\PYG{n}{i\PYGZus{}val}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{p}{)}

\PYG{n}{\PYGZus{}}\PYG{p}{,} \PYG{p}{(}\PYG{n}{ax1}\PYG{p}{)} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{6}\PYG{p}{,} \PYG{l+m+mi}{6}\PYG{p}{)}\PYG{p}{,} \PYG{n}{dpi}\PYG{o}{=}\PYG{l+m+mi}{150}\PYG{p}{)}

\PYG{n}{im}\PYG{o}{=}\PYG{n}{ax1}\PYG{o}{.}\PYG{n}{matshow}\PYG{p}{(}\PYG{n}{gray\PYGZus{}img}\PYG{p}{,}\PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{bone\PYGZus{}r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;} \PYG{n}{fig}\PYG{o}{.}\PYG{n}{colorbar}\PYG{p}{(}\PYG{n}{im}\PYG{p}{,}\PYG{n}{ax}\PYG{o}{=}\PYG{n}{ax1}\PYG{p}{,} \PYG{n}{shrink}\PYG{o}{=}\PYG{l+m+mf}{0.8}\PYG{p}{)}
\PYG{n}{ax1}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Intensity Image}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax1}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{p}{[}\PYG{n}{cov\PYGZus{}y}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{n}{cov\PYGZus{}x}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ro}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{label}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{COV: \PYGZdl{}x\PYGZus{}v=\PYGZdl{} }\PYG{l+s+si}{\PYGZob{}0:0.2f\PYGZcb{}}\PYG{l+s+s1}{, \PYGZdl{}y\PYGZus{}v=\PYGZdl{}}\PYG{l+s+si}{\PYGZob{}1:0.2f\PYGZcb{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{cov\PYGZus{}x}\PYG{p}{,}\PYG{n}{cov\PYGZus{}y}\PYG{p}{)}\PYG{p}{,} \PYG{n}{markersize}\PYG{o}{=}\PYG{l+m+mi}{10}\PYG{p}{)}
\PYG{n}{ax1}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{p}{[}\PYG{n}{com\PYGZus{}y}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{n}{com\PYGZus{}x}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{bo}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{label}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{COM: \PYGZdl{}x\PYGZus{}m=\PYGZdl{} }\PYG{l+s+si}{\PYGZob{}0:0.2f\PYGZcb{}}\PYG{l+s+s1}{, \PYGZdl{}y\PYGZus{}m=\PYGZdl{}}\PYG{l+s+si}{\PYGZob{}1:0.2f\PYGZcb{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{com\PYGZus{}x}\PYG{p}{,}\PYG{n}{com\PYGZus{}y}\PYG{p}{)}\PYG{p}{,} \PYG{n}{markersize}\PYG{o}{=}\PYG{l+m+mi}{10}\PYG{p}{)}\PYG{p}{;} \PYG{n}{ax1}\PYG{o}{.}\PYG{n}{legend}\PYG{p}{(}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{06-ShapeAnalysis_63_0}.png}


\section{Further object metrics}
\label{\detokenize{06-ShapeAnalysis:further-object-metrics}}
\sphinxAtStartPar
The center tells the position of an object.

\sphinxAtStartPar
We want more! E.g. metrics like:
\begin{itemize}
\item {} 
\sphinxAtStartPar
Area

\item {} 
\sphinxAtStartPar
Perimeter length

\item {} 
\sphinxAtStartPar
Sphericity

\item {} 
\sphinxAtStartPar
Orientation

\end{itemize}

\sphinxAtStartPar
… and more

\sphinxAtStartPar
\sphinxcode{\sphinxupquote{regionprops}} gives us all this!


\subsection{Regionprops manual page}
\label{\detokenize{06-ShapeAnalysis:regionprops-manual-page}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{skimage}\PYG{n+nn}{.}\PYG{n+nn}{measure} \PYG{k+kn}{import} \PYG{n}{regionprops}
\PYG{n}{help}\PYG{p}{(}\PYG{n}{regionprops}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
Help on function regionprops in module skimage.measure.\PYGZus{}regionprops:

regionprops(label\PYGZus{}image, intensity\PYGZus{}image=None, cache=True, coordinates=None)
    Measure properties of labeled image regions.
    
    Parameters
    \PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
    label\PYGZus{}image : (N, M) ndarray
        Labeled input image. Labels with value 0 are ignored.
    
        .. versionchanged:: 0.14.1
            Previously, ``label\PYGZus{}image`` was processed by ``numpy.squeeze`` and
            so any number of singleton dimensions was allowed. This resulted in
            inconsistent handling of images with singleton dimensions. To
            recover the old behaviour, use
            ``regionprops(np.squeeze(label\PYGZus{}image), ...)``.
    intensity\PYGZus{}image : (N, M) ndarray, optional
        Intensity (i.e., input) image with same size as labeled image.
        Default is None.
    cache : bool, optional
        Determine whether to cache calculated properties. The computation is
        much faster for cached properties, whereas the memory consumption
        increases.
    coordinates : DEPRECATED
        This argument is deprecated and will be removed in a future version
        of scikit\PYGZhy{}image.
    
        See :ref:`Coordinate conventions \PYGZlt{}numpy\PYGZhy{}images\PYGZhy{}coordinate\PYGZhy{}conventions\PYGZgt{}`
        for more details.
    
        .. deprecated:: 0.16.0
            Use \PYGZdq{}rc\PYGZdq{} coordinates everywhere. It may be sufficient to call
            ``numpy.transpose`` on your label image to get the same values as
            0.15 and earlier. However, for some properties, the transformation
            will be less trivial. For example, the new orientation is
            :math:`\PYGZbs{}frac\PYGZob{}\PYGZbs{}pi\PYGZcb{}\PYGZob{}2\PYGZcb{}` plus the old orientation.
    
    
    Returns
    \PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
    properties : list of RegionProperties
        Each item describes one labeled region, and can be accessed using the
        attributes listed below.
    
    Notes
    \PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
    The following properties can be accessed as attributes or keys:
    
    **area** : int
        Number of pixels of the region.
    **bbox** : tuple
        Bounding box ``(min\PYGZus{}row, min\PYGZus{}col, max\PYGZus{}row, max\PYGZus{}col)``.
        Pixels belonging to the bounding box are in the half\PYGZhy{}open interval
        ``[min\PYGZus{}row; max\PYGZus{}row)`` and ``[min\PYGZus{}col; max\PYGZus{}col)``.
    **bbox\PYGZus{}area** : int
        Number of pixels of bounding box.
    **centroid** : array
        Centroid coordinate tuple ``(row, col)``.
    **convex\PYGZus{}area** : int
        Number of pixels of convex hull image, which is the smallest convex
        polygon that encloses the region.
    **convex\PYGZus{}image** : (H, J) ndarray
        Binary convex hull image which has the same size as bounding box.
    **coords** : (N, 2) ndarray
        Coordinate list ``(row, col)`` of the region.
    **eccentricity** : float
        Eccentricity of the ellipse that has the same second\PYGZhy{}moments as the
        region. The eccentricity is the ratio of the focal distance
        (distance between focal points) over the major axis length.
        The value is in the interval [0, 1).
        When it is 0, the ellipse becomes a circle.
    **equivalent\PYGZus{}diameter** : float
        The diameter of a circle with the same area as the region.
    **euler\PYGZus{}number** : int
        Euler characteristic of region. Computed as number of objects (= 1)
        subtracted by number of holes (8\PYGZhy{}connectivity).
    **extent** : float
        Ratio of pixels in the region to pixels in the total bounding box.
        Computed as ``area / (rows * cols)``
    **filled\PYGZus{}area** : int
        Number of pixels of the region will all the holes filled in. Describes
        the area of the filled\PYGZus{}image.
    **filled\PYGZus{}image** : (H, J) ndarray
        Binary region image with filled holes which has the same size as
        bounding box.
    **image** : (H, J) ndarray
        Sliced binary region image which has the same size as bounding box.
    **inertia\PYGZus{}tensor** : ndarray
        Inertia tensor of the region for the rotation around its mass.
    **inertia\PYGZus{}tensor\PYGZus{}eigvals** : tuple
        The eigenvalues of the inertia tensor in decreasing order.
    **intensity\PYGZus{}image** : ndarray
        Image inside region bounding box.
    **label** : int
        The label in the labeled input image.
    **local\PYGZus{}centroid** : array
        Centroid coordinate tuple ``(row, col)``, relative to region bounding
        box.
    **major\PYGZus{}axis\PYGZus{}length** : float
        The length of the major axis of the ellipse that has the same
        normalized second central moments as the region.
    **max\PYGZus{}intensity** : float
        Value with the greatest intensity in the region.
    **mean\PYGZus{}intensity** : float
        Value with the mean intensity in the region.
    **min\PYGZus{}intensity** : float
        Value with the least intensity in the region.
    **minor\PYGZus{}axis\PYGZus{}length** : float
        The length of the minor axis of the ellipse that has the same
        normalized second central moments as the region.
    **moments** : (3, 3) ndarray
        Spatial moments up to 3rd order::
    
            m\PYGZus{}ij = sum\PYGZob{} array(row, col) * row\PYGZca{}i * col\PYGZca{}j \PYGZcb{}
    
        where the sum is over the `row`, `col` coordinates of the region.
    **moments\PYGZus{}central** : (3, 3) ndarray
        Central moments (translation invariant) up to 3rd order::
    
            mu\PYGZus{}ij = sum\PYGZob{} array(row, col) * (row \PYGZhy{} row\PYGZus{}c)\PYGZca{}i * (col \PYGZhy{} col\PYGZus{}c)\PYGZca{}j \PYGZcb{}
    
        where the sum is over the `row`, `col` coordinates of the region,
        and `row\PYGZus{}c` and `col\PYGZus{}c` are the coordinates of the region\PYGZsq{}s centroid.
    **moments\PYGZus{}hu** : tuple
        Hu moments (translation, scale and rotation invariant).
    **moments\PYGZus{}normalized** : (3, 3) ndarray
        Normalized moments (translation and scale invariant) up to 3rd order::
    
            nu\PYGZus{}ij = mu\PYGZus{}ij / m\PYGZus{}00\PYGZca{}[(i+j)/2 + 1]
    
        where `m\PYGZus{}00` is the zeroth spatial moment.
    **orientation** : float
        Angle between the 0th axis (rows) and the major
        axis of the ellipse that has the same second moments as the region,
        ranging from `\PYGZhy{}pi/2` to `pi/2` counter\PYGZhy{}clockwise.
    **perimeter** : float
        Perimeter of object which approximates the contour as a line
        through the centers of border pixels using a 4\PYGZhy{}connectivity.
    **slice** : tuple of slices
        A slice to extract the object from the source image.
    **solidity** : float
        Ratio of pixels in the region to pixels of the convex hull image.
    **weighted\PYGZus{}centroid** : array
        Centroid coordinate tuple ``(row, col)`` weighted with intensity
        image.
    **weighted\PYGZus{}local\PYGZus{}centroid** : array
        Centroid coordinate tuple ``(row, col)``, relative to region bounding
        box, weighted with intensity image.
    **weighted\PYGZus{}moments** : (3, 3) ndarray
        Spatial moments of intensity image up to 3rd order::
    
            wm\PYGZus{}ij = sum\PYGZob{} array(row, col) * row\PYGZca{}i * col\PYGZca{}j \PYGZcb{}
    
        where the sum is over the `row`, `col` coordinates of the region.
    **weighted\PYGZus{}moments\PYGZus{}central** : (3, 3) ndarray
        Central moments (translation invariant) of intensity image up to
        3rd order::
    
            wmu\PYGZus{}ij = sum\PYGZob{} array(row, col) * (row \PYGZhy{} row\PYGZus{}c)\PYGZca{}i * (col \PYGZhy{} col\PYGZus{}c)\PYGZca{}j \PYGZcb{}
    
        where the sum is over the `row`, `col` coordinates of the region,
        and `row\PYGZus{}c` and `col\PYGZus{}c` are the coordinates of the region\PYGZsq{}s weighted
        centroid.
    **weighted\PYGZus{}moments\PYGZus{}hu** : tuple
        Hu moments (translation, scale and rotation invariant) of intensity
        image.
    **weighted\PYGZus{}moments\PYGZus{}normalized** : (3, 3) ndarray
        Normalized moments (translation and scale invariant) of intensity
        image up to 3rd order::
    
            wnu\PYGZus{}ij = wmu\PYGZus{}ij / wm\PYGZus{}00\PYGZca{}[(i+j)/2 + 1]
    
        where ``wm\PYGZus{}00`` is the zeroth spatial moment (intensity\PYGZhy{}weighted area).
    
    Each region also supports iteration, so that you can do::
    
      for prop in region:
          print(prop, region[prop])
    
    See Also
    \PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
    label
    
    References
    \PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
    .. [1] Wilhelm Burger, Mark Burge. Principles of Digital Image Processing:
           Core Algorithms. Springer\PYGZhy{}Verlag, London, 2009.
    .. [2] B. Jähne. Digital Image Processing. Springer\PYGZhy{}Verlag,
           Berlin\PYGZhy{}Heidelberg, 6. edition, 2005.
    .. [3] T. H. Reiss. Recognizing Planar Objects Using Invariant Image
           Features, from Lecture notes in computer science, p. 676. Springer,
           Berlin, 1993.
    .. [4] https://en.wikipedia.org/wiki/Image\PYGZus{}moment
    
    Examples
    \PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
    \PYGZgt{}\PYGZgt{}\PYGZgt{} from skimage import data, util
    \PYGZgt{}\PYGZgt{}\PYGZgt{} from skimage.measure import label
    \PYGZgt{}\PYGZgt{}\PYGZgt{} img = util.img\PYGZus{}as\PYGZus{}ubyte(data.coins()) \PYGZgt{} 110
    \PYGZgt{}\PYGZgt{}\PYGZgt{} label\PYGZus{}img = label(img, connectivity=img.ndim)
    \PYGZgt{}\PYGZgt{}\PYGZgt{} props = regionprops(label\PYGZus{}img)
    \PYGZgt{}\PYGZgt{}\PYGZgt{} \PYGZsh{} centroid of first labeled object
    \PYGZgt{}\PYGZgt{}\PYGZgt{} props[0].centroid
    (22.72987986048314, 81.91228523446583)
    \PYGZgt{}\PYGZgt{}\PYGZgt{} \PYGZsh{} centroid of first labeled object
    \PYGZgt{}\PYGZgt{}\PYGZgt{} props[0][\PYGZsq{}centroid\PYGZsq{}]
    (22.72987986048314, 81.91228523446583)
\end{sphinxVerbatim}


\subsection{Let’s try regionprops on our image}
\label{\detokenize{06-ShapeAnalysis:let-s-try-regionprops-on-our-image}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{skimage}\PYG{n+nn}{.}\PYG{n+nn}{measure} \PYG{k+kn}{import} \PYG{n}{regionprops}
\PYG{n}{all\PYGZus{}regs} \PYG{o}{=} \PYG{n}{regionprops}\PYG{p}{(}\PYG{n}{seg\PYGZus{}img}\PYG{p}{,} \PYG{n}{intensity\PYGZus{}image}\PYG{o}{=}\PYG{n}{gray\PYGZus{}img}\PYG{p}{)}
\PYG{n}{attr}\PYG{o}{=}\PYG{p}{\PYGZob{}}\PYG{p}{\PYGZcb{}}
\PYG{k}{for} \PYG{n}{c\PYGZus{}reg} \PYG{o+ow}{in} \PYG{n}{all\PYGZus{}regs}\PYG{p}{:}
    \PYG{k}{for} \PYG{n}{k} \PYG{o+ow}{in} \PYG{n+nb}{dir}\PYG{p}{(}\PYG{n}{c\PYGZus{}reg}\PYG{p}{)}\PYG{p}{:}
        \PYG{k}{if} \PYG{o+ow}{not} \PYG{n}{k}\PYG{o}{.}\PYG{n}{startswith}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZus{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)} \PYG{o+ow}{and} \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{image}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o+ow}{not} \PYG{o+ow}{in} \PYG{n}{k}\PYG{p}{)}\PYG{p}{:}
            \PYG{n}{attr}\PYG{p}{[}\PYG{n}{k}\PYG{p}{]}\PYG{o}{=}\PYG{n+nb}{getattr}\PYG{p}{(}\PYG{n}{c\PYGZus{}reg}\PYG{p}{,} \PYG{n}{k}\PYG{p}{)}
\PYG{n}{attr\PYGZus{}df}\PYG{o}{=}\PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{o}{.}\PYG{n}{from\PYGZus{}dict}\PYG{p}{(}\PYG{n}{attr}\PYG{p}{,} \PYG{n}{orient}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{index}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{n}{attr\PYGZus{}df}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
                                                                             0
area                                                                       900
bbox                                                          (10, 10, 40, 40)
bbox\PYGZus{}area                                                                  900
centroid                                                          (24.5, 24.5)
convex\PYGZus{}area                                                                900
coords                       [[10, 10], [10, 11], [10, 12], [10, 13], [10, ...
eccentricity                                                                 0
equivalent\PYGZus{}diameter                                                    33.8514
euler\PYGZus{}number                                                                 1
extent                                                                       1
filled\PYGZus{}area                                                                900
inertia\PYGZus{}tensor               [[74.91666666666667, \PYGZhy{}0.0], [\PYGZhy{}0.0, 74.91666666...
inertia\PYGZus{}tensor\PYGZus{}eigvals                  [74.91666666666667, 74.91666666666667]
label                                                                        1
local\PYGZus{}centroid                                                    (14.5, 14.5)
major\PYGZus{}axis\PYGZus{}length                                                      34.6218
max\PYGZus{}intensity                                                          7207.62
mean\PYGZus{}intensity                                                         2223.91
min\PYGZus{}intensity                                                          41.4433
minor\PYGZus{}axis\PYGZus{}length                                                      34.6218
moments                      [[900.0, 13050.0, 256650.0, 5676750.0], [13050...
moments\PYGZus{}central              [[900.0, 0.0, 67425.0, 0.0], [0.0, 0.0, 0.0, 0...
moments\PYGZus{}hu                   [0.16648148148148148, 0.0, 0.0, 0.0, 0.0, 0.0,...
moments\PYGZus{}normalized           [[nan, nan, 0.08324074074074074, 0.0], [nan, 0...
orientation                                                           0.785398
perimeter                                                                  116
slice                               (slice(10, 40, None), slice(10, 40, None))
solidity                                                                     1
weighted\PYGZus{}centroid                      (29.27320794892042, 27.898230520694007)
weighted\PYGZus{}local\PYGZus{}centroid                [19.27320794892042, 17.898230520694007]
weighted\PYGZus{}moments             [[2001517.0866305707, 35823614.20762183, 76860...
weighted\PYGZus{}moments\PYGZus{}central     [[2001517.0866305707, \PYGZhy{}4.3655745685100555e\PYGZhy{}09,...
weighted\PYGZus{}moments\PYGZus{}hu          [6.219233313138948e\PYGZhy{}05, 2.8996448632098516e\PYGZhy{}11...
weighted\PYGZus{}moments\PYGZus{}normalized  [[nan, nan, 3.1809307780004445e\PYGZhy{}05, \PYGZhy{}8.2096428...
\end{sphinxVerbatim}


\subsection{Lots of information}
\label{\detokenize{06-ShapeAnalysis:lots-of-information}}
\sphinxAtStartPar
We can tell a lot about each object now, but…
\begin{itemize}
\item {} 
\sphinxAtStartPar
Too abstract

\item {} 
\sphinxAtStartPar
Too specific

\end{itemize}

\sphinxAtStartPar
Ask biologists in the class if they ever asked
\begin{itemize}
\item {} 
\sphinxAtStartPar
“How long is a cell in the \(x\) direction?”

\item {} 
\sphinxAtStartPar
“how about \(y\)?”

\end{itemize}


\section{Extents: With a single object}
\label{\detokenize{06-ShapeAnalysis:extents-with-a-single-object}}
\sphinxAtStartPar
Exents or caliper lenghts are the size of the object in a given direction. Since the coordinates of our image our \(x\) and \(y\) the extents are calculated in these directions

\sphinxAtStartPar
Define extents as the minimum and maximum values along the projection of the shape in each direction
\$\( \text{Ext}_x = \left\{ \forall \vec{v}\in I_{id}: max(\vec{v}\cdot\vec{i})-min(\vec{v}\cdot\vec{i})  \right\} \)\(
\)\( \text{Ext}_y = \left\{ \forall \vec{v}\in I_{id}: max(\vec{v}\cdot\vec{j})-min(\vec{v}\cdot\vec{j})  \right\} \)\(
\)\( \text{Ext}_z = \left\{ \forall \vec{v}\in I_{id}: max(\vec{v}\cdot\vec{k})-min(\vec{v}\cdot\vec{k})  \right\} \)\$


\subsection{Where is this information useful?}
\label{\detokenize{06-ShapeAnalysis:where-is-this-information-useful}}

\subsubsection{Let’s look at a car item}
\label{\detokenize{06-ShapeAnalysis:let-s-look-at-a-car-item}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{seg\PYGZus{}img} \PYG{o}{=} \PYG{n}{imread}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{figures/aachen\PYGZus{}label.png}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)} \PYG{o}{==} \PYG{l+m+mi}{26}
\PYG{n}{seg\PYGZus{}img} \PYG{o}{=} \PYG{n}{seg\PYGZus{}img}\PYG{p}{[}\PYG{p}{:}\PYG{p}{:}\PYG{l+m+mi}{4}\PYG{p}{,} \PYG{p}{:}\PYG{p}{:}\PYG{l+m+mi}{4}\PYG{p}{]}
\PYG{n}{seg\PYGZus{}img} \PYG{o}{=} \PYG{n}{seg\PYGZus{}img}\PYG{p}{[}\PYG{l+m+mi}{110}\PYG{p}{:}\PYG{l+m+mi}{130}\PYG{p}{:}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{378}\PYG{p}{:}\PYG{l+m+mi}{420}\PYG{p}{:}\PYG{l+m+mi}{3}\PYG{p}{]} \PYG{o}{\PYGZgt{}} \PYG{l+m+mi}{0}
\PYG{n}{seg\PYGZus{}img} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{pad}\PYG{p}{(}\PYG{n}{seg\PYGZus{}img}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{,} \PYG{n}{mode}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{constant}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{\PYGZus{}}\PYG{p}{,} \PYG{p}{(}\PYG{n}{ax1}\PYG{p}{)} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,}
                        \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{7}\PYG{p}{,} \PYG{l+m+mi}{7}\PYG{p}{)}\PYG{p}{,}
                        \PYG{n}{dpi}\PYG{o}{=}\PYG{l+m+mi}{100}\PYG{p}{)}
\PYG{n}{ax1}\PYG{o}{.}\PYG{n}{matshow}\PYG{p}{(}\PYG{n}{seg\PYGZus{}img}\PYG{p}{,}
            \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{bone\PYGZus{}r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{06-ShapeAnalysis_72_0}.png}


\subsection{Finding a bounding box}
\label{\detokenize{06-ShapeAnalysis:finding-a-bounding-box}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{x\PYGZus{}coord}\PYG{p}{,} \PYG{n}{y\PYGZus{}coord} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{p}{]}
\PYG{k}{for} \PYG{n}{x} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{seg\PYGZus{}img}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{for} \PYG{n}{y} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{seg\PYGZus{}img}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{:}
        \PYG{k}{if} \PYG{n}{seg\PYGZus{}img}\PYG{p}{[}\PYG{n}{x}\PYG{p}{,} \PYG{n}{y}\PYG{p}{]} \PYG{o}{==} \PYG{l+m+mi}{1}\PYG{p}{:}
            \PYG{n}{x\PYGZus{}coord} \PYG{o}{+}\PYG{o}{=} \PYG{p}{[}\PYG{n}{x}\PYG{p}{]}
            \PYG{n}{y\PYGZus{}coord} \PYG{o}{+}\PYG{o}{=} \PYG{p}{[}\PYG{n}{y}\PYG{p}{]}
\PYG{n}{xmin} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{min}\PYG{p}{(}\PYG{n}{x\PYGZus{}coord}\PYG{p}{)}
\PYG{n}{xmax} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{max}\PYG{p}{(}\PYG{n}{x\PYGZus{}coord}\PYG{p}{)}
\PYG{n}{ymin} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{min}\PYG{p}{(}\PYG{n}{y\PYGZus{}coord}\PYG{p}{)}
\PYG{n}{ymax} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{max}\PYG{p}{(}\PYG{n}{y\PYGZus{}coord}\PYG{p}{)}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{X \PYGZhy{}\PYGZgt{} }\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Min:}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{xmin}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Max:}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{xmax}\PYG{p}{)}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Y \PYGZhy{}\PYGZgt{} }\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Min:}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{ymin}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Max:}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{ymax}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
X \PYGZhy{}\PYGZgt{}  Min: 4 Max: 12
Y \PYGZhy{}\PYGZgt{}  Min: 3 Max: 15
\end{sphinxVerbatim}


\subsection{Draw the box}
\label{\detokenize{06-ShapeAnalysis:draw-the-box}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{\PYGZus{}}\PYG{p}{,} \PYG{p}{(}\PYG{n}{ax1}\PYG{p}{)} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{7}\PYG{p}{,} \PYG{l+m+mi}{7}\PYG{p}{)}\PYG{p}{,} \PYG{n}{dpi}\PYG{o}{=}\PYG{l+m+mi}{100}\PYG{p}{)}

\PYG{n}{ax1}\PYG{o}{.}\PYG{n}{matshow}\PYG{p}{(}\PYG{n}{seg\PYGZus{}img}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{bone\PYGZus{}r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{n}{xw} \PYG{o}{=} \PYG{p}{(}\PYG{n}{xmax}\PYG{o}{\PYGZhy{}}\PYG{n}{xmin}\PYG{p}{)}
\PYG{n}{yw} \PYG{o}{=} \PYG{p}{(}\PYG{n}{ymax}\PYG{o}{\PYGZhy{}}\PYG{n}{ymin}\PYG{p}{)}

\PYG{n}{c\PYGZus{}bbox} \PYG{o}{=} \PYG{p}{[}\PYG{n}{Rectangle}\PYG{p}{(}\PYG{n}{xy}\PYG{o}{=}\PYG{p}{(}\PYG{n}{ymin}\PYG{p}{,} \PYG{n}{xmin}\PYG{p}{)}\PYG{p}{,}
                    \PYG{n}{width}\PYG{o}{=}\PYG{n}{yw}\PYG{p}{,}
                    \PYG{n}{height}\PYG{o}{=}\PYG{n}{xw}
                    \PYG{p}{)}\PYG{p}{]}
\PYG{n}{c\PYGZus{}bb\PYGZus{}patch} \PYG{o}{=} \PYG{n}{PatchCollection}\PYG{p}{(}\PYG{n}{c\PYGZus{}bbox}\PYG{p}{,}
                             \PYG{n}{facecolor}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{none}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                             \PYG{n}{edgecolor}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{red}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                             \PYG{n}{linewidth}\PYG{o}{=}\PYG{l+m+mi}{4}\PYG{p}{,}
                             \PYG{n}{alpha}\PYG{o}{=}\PYG{l+m+mf}{0.5}\PYG{p}{)}
\PYG{n}{ax1}\PYG{o}{.}\PYG{n}{add\PYGZus{}collection}\PYG{p}{(}\PYG{n}{c\PYGZus{}bb\PYGZus{}patch}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{06-ShapeAnalysis_76_0}.png}


\chapter{Using regionprops on real images}
\label{\detokenize{06-ShapeAnalysis:using-regionprops-on-real-images}}
\sphinxAtStartPar
So how can we begin to apply the tools we have developed?

\sphinxAtStartPar
We take the original car scene from before.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{car\PYGZus{}img} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{clip}\PYG{p}{(}\PYG{n}{imread}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{figures/aachen\PYGZus{}img.png}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
                  \PYG{p}{[}\PYG{l+m+mi}{75}\PYG{p}{:}\PYG{l+m+mi}{150}\PYG{p}{]}\PYG{o}{*}\PYG{l+m+mf}{2.0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{255}\PYG{p}{)}\PYG{o}{.}\PYG{n}{astype}\PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{uint8}\PYG{p}{)}
\PYG{n}{lab\PYGZus{}img} \PYG{o}{=} \PYG{n}{label}\PYG{p}{(}\PYG{n}{imread}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{figures/aachen\PYGZus{}label.png}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{[}\PYG{p}{:}\PYG{p}{:}\PYG{l+m+mi}{4}\PYG{p}{,} \PYG{p}{:}\PYG{p}{:}\PYG{l+m+mi}{4}\PYG{p}{]} \PYG{o}{==} \PYG{l+m+mi}{26}\PYG{p}{)}\PYG{p}{[}\PYG{l+m+mi}{75}\PYG{p}{:}\PYG{l+m+mi}{150}\PYG{p}{]}
\PYG{n}{fig}\PYG{p}{,} \PYG{p}{(}\PYG{n}{ax1}\PYG{p}{,} \PYG{n}{ax2}\PYG{p}{)} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{20}\PYG{p}{,} \PYG{l+m+mi}{8}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{ax1}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{n}{car\PYGZus{}img}\PYG{p}{)}
\PYG{n}{ax1}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Input Image}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}

\PYG{n}{plt}\PYG{o}{.}\PYG{n}{colorbar}\PYG{p}{(}\PYG{n}{ax2}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{n}{lab\PYGZus{}img}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{nipy\PYGZus{}spectral}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{ax2}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Labeled Image}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{06-ShapeAnalysis_78_0}.png}


\section{Shape Analysis}
\label{\detokenize{06-ShapeAnalysis:id3}}
\sphinxAtStartPar
We can perform shape analysis on the image and calculate basic shape parameters for each object

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{all\PYGZus{}regions} \PYG{o}{=} \PYG{n}{regionprops}\PYG{p}{(}\PYG{n}{lab\PYGZus{}img}\PYG{p}{)}
\PYG{n}{fig}\PYG{p}{,} \PYG{n}{ax1} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{12}\PYG{p}{,} \PYG{l+m+mi}{6}\PYG{p}{)}\PYG{p}{,} \PYG{n}{dpi}\PYG{o}{=}\PYG{l+m+mi}{100}\PYG{p}{)}
\PYG{n}{ax1}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{n}{car\PYGZus{}img}\PYG{p}{)}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Found }\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{all\PYGZus{}regions}\PYG{p}{)}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{regions}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{bbox\PYGZus{}list} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{k}{for} \PYG{n}{c\PYGZus{}reg} \PYG{o+ow}{in} \PYG{n}{all\PYGZus{}regions}\PYG{p}{:}
    \PYG{n}{ax1}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{c\PYGZus{}reg}\PYG{o}{.}\PYG{n}{centroid}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,} \PYG{n}{c\PYGZus{}reg}\PYG{o}{.}\PYG{n}{centroid}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{o}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{markersize}\PYG{o}{=}\PYG{l+m+mi}{5}\PYG{p}{)}
    \PYG{n}{bbox\PYGZus{}list} \PYG{o}{+}\PYG{o}{=} \PYG{p}{[}\PYG{n}{Rectangle}\PYG{p}{(}\PYG{n}{xy}\PYG{o}{=}\PYG{p}{(}\PYG{n}{c\PYGZus{}reg}\PYG{o}{.}\PYG{n}{bbox}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,}
                                \PYG{n}{c\PYGZus{}reg}\PYG{o}{.}\PYG{n}{bbox}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}
                            \PYG{n}{width}\PYG{o}{=}\PYG{n}{c\PYGZus{}reg}\PYG{o}{.}\PYG{n}{bbox}\PYG{p}{[}\PYG{l+m+mi}{3}\PYG{p}{]}\PYG{o}{\PYGZhy{}}\PYG{n}{c\PYGZus{}reg}\PYG{o}{.}\PYG{n}{bbox}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,}
                            \PYG{n}{height}\PYG{o}{=}\PYG{n}{c\PYGZus{}reg}\PYG{o}{.}\PYG{n}{bbox}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{o}{\PYGZhy{}}\PYG{n}{c\PYGZus{}reg}\PYG{o}{.}\PYG{n}{bbox}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}
                            \PYG{p}{)}\PYG{p}{]}
\PYG{n}{c\PYGZus{}bb\PYGZus{}patch} \PYG{o}{=} \PYG{n}{PatchCollection}\PYG{p}{(}\PYG{n}{bbox\PYGZus{}list}\PYG{p}{,}
                             \PYG{n}{facecolor}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{none}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                             \PYG{n}{edgecolor}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{red}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                             \PYG{n}{linewidth}\PYG{o}{=}\PYG{l+m+mi}{4}\PYG{p}{,}
                             \PYG{n}{alpha}\PYG{o}{=}\PYG{l+m+mf}{0.5}\PYG{p}{)}
\PYG{n}{ax1}\PYG{o}{.}\PYG{n}{add\PYGZus{}collection}\PYG{p}{(}\PYG{n}{c\PYGZus{}bb\PYGZus{}patch}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
Found  9 regions
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{06-ShapeAnalysis_80_1}.png}


\section{Statistics}
\label{\detokenize{06-ShapeAnalysis:statistics}}
\sphinxAtStartPar
We can then generate a table full of these basic parameters for each object. In this case, we add color as an additional description

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{ed\PYGZus{}img}\PYG{p}{(}\PYG{n}{in\PYGZus{}img}\PYG{p}{)}\PYG{p}{:}
    \PYG{c+c1}{\PYGZsh{} shrink an image to a few pixels}
    \PYG{n}{cur\PYGZus{}img} \PYG{o}{=} \PYG{n}{in\PYGZus{}img}\PYG{o}{.}\PYG{n}{copy}\PYG{p}{(}\PYG{p}{)}
    \PYG{k}{while} \PYG{n}{cur\PYGZus{}img}\PYG{o}{.}\PYG{n}{max}\PYG{p}{(}\PYG{p}{)} \PYG{o}{\PYGZgt{}} \PYG{l+m+mi}{0}\PYG{p}{:}
        \PYG{n}{last\PYGZus{}img} \PYG{o}{=} \PYG{n}{cur\PYGZus{}img}
        \PYG{n}{cur\PYGZus{}img} \PYG{o}{=} \PYG{n}{erosion}\PYG{p}{(}\PYG{n}{cur\PYGZus{}img}\PYG{p}{,} \PYG{n}{disk}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{)}
    \PYG{k}{return} \PYG{n}{last\PYGZus{}img}

\PYG{c+c1}{\PYGZsh{} guess color name based on rgb value}
\PYG{n}{color\PYGZus{}name\PYGZus{}class} \PYG{o}{=} \PYG{n}{KNeighborsClassifier}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
\PYG{n}{c\PYGZus{}names} \PYG{o}{=} \PYG{n+nb}{sorted}\PYG{p}{(}\PYG{n}{webcolors}\PYG{o}{.}\PYG{n}{CSS3\PYGZus{}NAMES\PYGZus{}TO\PYGZus{}HEX}\PYG{o}{.}\PYG{n}{keys}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{color\PYGZus{}name\PYGZus{}class}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{p}{[}\PYG{n+nb}{tuple}\PYG{p}{(}\PYG{n}{webcolors}\PYG{o}{.}\PYG{n}{name\PYGZus{}to\PYGZus{}rgb}\PYG{p}{(}\PYG{n}{k}\PYG{p}{)}\PYG{p}{)} \PYG{k}{for} \PYG{n}{k} \PYG{o+ow}{in} \PYG{n}{c\PYGZus{}names}\PYG{p}{]}\PYG{p}{,}\PYG{n}{c\PYGZus{}names}\PYG{p}{)}

\PYG{n}{reg\PYGZus{}df} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{p}{[}\PYG{n+nb}{dict}\PYG{p}{(}\PYG{n}{label}    \PYG{o}{=} \PYG{n}{c\PYGZus{}reg}\PYG{o}{.}\PYG{n}{label}\PYG{p}{,} \PYG{n}{bbox}     \PYG{o}{=} \PYG{n}{c\PYGZus{}reg}\PYG{o}{.}\PYG{n}{bbox}\PYG{p}{,}
                            \PYG{n}{area}     \PYG{o}{=} \PYG{n}{c\PYGZus{}reg}\PYG{o}{.}\PYG{n}{area}\PYG{p}{,}  \PYG{n}{centroid} \PYG{o}{=} \PYG{n}{c\PYGZus{}reg}\PYG{o}{.}\PYG{n}{centroid}\PYG{p}{,}
                            \PYG{n}{color}    \PYG{o}{=} \PYG{n}{color\PYGZus{}name\PYGZus{}class}\PYG{o}{.}\PYG{n}{predict}\PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{n}{car\PYGZus{}img}\PYG{p}{[}\PYG{n}{ed\PYGZus{}img}\PYG{p}{(}\PYG{n}{lab\PYGZus{}img} \PYG{o}{==} \PYG{n}{c\PYGZus{}reg}\PYG{o}{.}\PYG{n}{label}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{)}\PYG{p}{[}\PYG{p}{:}\PYG{l+m+mi}{3}\PYG{p}{]}\PYG{o}{.}\PYG{n}{reshape}\PYG{p}{(}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}
                       \PYG{k}{for} \PYG{n}{c\PYGZus{}reg} \PYG{o+ow}{in} \PYG{n}{all\PYGZus{}regions}\PYG{p}{]}\PYG{p}{)}

\PYG{n}{fig}\PYG{p}{,} \PYG{n}{m\PYGZus{}axs} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{floor}\PYG{p}{(}\PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{all\PYGZus{}regions}\PYG{p}{)}\PYG{o}{/}\PYG{l+m+mi}{3}\PYG{p}{)}\PYG{o}{.}\PYG{n}{astype}\PYG{p}{(}\PYG{n+nb}{int}\PYG{p}{)}\PYG{p}{,}\PYG{l+m+mi}{3}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{10}\PYG{p}{,}\PYG{l+m+mi}{10}\PYG{p}{)}\PYG{p}{)}
\PYG{k}{for} \PYG{n}{c\PYGZus{}ax}\PYG{p}{,} \PYG{n}{c\PYGZus{}reg} \PYG{o+ow}{in} \PYG{n+nb}{zip}\PYG{p}{(}\PYG{n}{m\PYGZus{}axs}\PYG{o}{.}\PYG{n}{ravel}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,} \PYG{n}{all\PYGZus{}regions}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{c\PYGZus{}ax}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{n}{car\PYGZus{}img}\PYG{p}{[}\PYG{n}{c\PYGZus{}reg}\PYG{o}{.}\PYG{n}{bbox}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{:}\PYG{n}{c\PYGZus{}reg}\PYG{o}{.}\PYG{n}{bbox}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{p}{,}\PYG{n}{c\PYGZus{}reg}\PYG{o}{.}\PYG{n}{bbox}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{:}\PYG{n}{c\PYGZus{}reg}\PYG{o}{.}\PYG{n}{bbox}\PYG{p}{[}\PYG{l+m+mi}{3}\PYG{p}{]}\PYG{p}{]}\PYG{p}{)}
    \PYG{n}{c\PYGZus{}ax}\PYG{o}{.}\PYG{n}{axis}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{off}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}     \PYG{n}{c\PYGZus{}ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Label }\PYG{l+s+si}{\PYGZob{}\PYGZcb{}}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{c\PYGZus{}reg}\PYG{o}{.}\PYG{n}{label}\PYG{p}{)}\PYG{p}{)}

\PYG{n}{reg\PYGZus{}df}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
   label                bbox  area                                  centroid  \PYGZbs{}
0      1  (30, 153, 58, 202)  1091   (43.64527956003666, 177.82218148487627)   
1      2    (33, 37, 51, 77)   535     (41.44299065420561, 58.7607476635514)   
2      3  (37, 370, 54, 385)   140   (45.871428571428574, 378.6642857142857)   
3      4  (37, 387, 54, 416)   342   (44.86257309941521, 398.66959064327483)   
4      5  (38, 431, 53, 463)   323   (44.526315789473685, 446.9133126934984)   
5      6  (46, 469, 52, 474)    22    (48.63636363636363, 471.1818181818182)   
6      7  (46, 475, 54, 482)    44   (49.09090909090909, 478.22727272727275)   
7      8  (47, 492, 56, 511)   134  (50.992537313432834, 501.82089552238807)   
8      9  (48, 484, 54, 489)    25                           (50.92, 485.76)   

           color  
0        dimgrey  
1         silver  
2  darkslategray  
3  darkslategray  
4  darkslategray  
5        dimgrey  
6        dimgrey  
7     powderblue  
8           grey  
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{06-ShapeAnalysis_82_1}.png}


\chapter{Object anisotropy}
\label{\detokenize{06-ShapeAnalysis:object-anisotropy}}

\section{Anisotropy: What is it?}
\label{\detokenize{06-ShapeAnalysis:anisotropy-what-is-it}}
\sphinxAtStartPar
By definition (New Oxford American): \sphinxstylestrong{varying in magnitude according to the direction of measurement.}

It allows us to define metrics in respect to one another and thereby characterize shape.
\begin{itemize}
\item {} 
\sphinxAtStartPar
Is it:
\begin{itemize}
\item {} 
\sphinxAtStartPar
tall and skinny,

\item {} 
\sphinxAtStartPar
short and fat,

\item {} 
\sphinxAtStartPar
or perfectly round?

\end{itemize}

\end{itemize}


\section{A very vague definition}
\label{\detokenize{06-ShapeAnalysis:a-very-vague-definition}}
\sphinxAtStartPar
It can be mathematically characterized in many different very much unequal ways (in all cases 0 represents a sphere)
\begin{equation*}
\begin{split} A_{iso1} = \frac{\text{Longest Side}}{\text{Shortest Side}} - 1 \end{split}
\end{equation*}
\sphinxAtStartPar

\$\( A_{iso2} = \frac{\text{Longest Side}-\text{Shortest Side}}{\text{Longest Side}} \)\(
<br/><br/>
\)\( A_{iso3} = \frac{\text{Longest Side}}{\text{Average Side Length}} - 1 \)\(
<br/><br/>
\)\( A_{iso4} = \frac{\text{Longest Side}-\text{Shortest Side}}{\text{Average Side Length}} \)\(
<br/><br/>
\)\( \cdots \rightarrow \text{ ad nauseum} \)\$

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{collections} \PYG{k+kn}{import} \PYG{n}{defaultdict}
\PYG{k+kn}{from} \PYG{n+nn}{skimage}\PYG{n+nn}{.}\PYG{n+nn}{measure} \PYG{k+kn}{import} \PYG{n}{regionprops}
\PYG{k+kn}{import} \PYG{n+nn}{seaborn} \PYG{k}{as} \PYG{n+nn}{sns}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{matplotlib}\PYG{n+nn}{.}\PYG{n+nn}{pyplot} \PYG{k}{as} \PYG{n+nn}{plt}
\PYG{o}{\PYGZpc{}}\PYG{k}{matplotlib} inline
\end{sphinxVerbatim}


\subsection{Let’s define some of these metrics}
\label{\detokenize{06-ShapeAnalysis:let-s-define-some-of-these-metrics}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{xx}\PYG{p}{,} \PYG{n}{yy} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{meshgrid}\PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{linspace}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{5}\PYG{p}{,} \PYG{l+m+mi}{5}\PYG{p}{,} \PYG{l+m+mi}{100}\PYG{p}{)}\PYG{p}{,}
                     \PYG{n}{np}\PYG{o}{.}\PYG{n}{linspace}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{5}\PYG{p}{,} \PYG{l+m+mi}{5}\PYG{p}{,} \PYG{l+m+mi}{100}\PYG{p}{)}\PYG{p}{)}


\PYG{k}{def} \PYG{n+nf}{side\PYGZus{}len}\PYG{p}{(}\PYG{n}{c\PYGZus{}reg}\PYG{p}{)}\PYG{p}{:} \PYG{k}{return} \PYG{n+nb}{sorted}\PYG{p}{(}
    \PYG{p}{[}\PYG{n}{c\PYGZus{}reg}\PYG{o}{.}\PYG{n}{bbox}\PYG{p}{[}\PYG{l+m+mi}{3}\PYG{p}{]}\PYG{o}{\PYGZhy{}}\PYG{n}{c\PYGZus{}reg}\PYG{o}{.}\PYG{n}{bbox}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,} \PYG{n}{c\PYGZus{}reg}\PYG{o}{.}\PYG{n}{bbox}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{o}{\PYGZhy{}}\PYG{n}{c\PYGZus{}reg}\PYG{o}{.}\PYG{n}{bbox}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{]}\PYG{p}{)}


\PYG{n}{aiso\PYGZus{}funcs} \PYG{o}{=} \PYG{p}{[}\PYG{k}{lambda} \PYG{n}{x}\PYG{p}{:}  \PYG{n}{side\PYGZus{}len}\PYG{p}{(}\PYG{n}{x}\PYG{p}{)}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{/}\PYG{n}{side\PYGZus{}len}\PYG{p}{(}\PYG{n}{x}\PYG{p}{)}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{,}
              \PYG{k}{lambda} \PYG{n}{x}\PYG{p}{:} \PYG{p}{(}\PYG{n}{side\PYGZus{}len}\PYG{p}{(}\PYG{n}{x}\PYG{p}{)}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{\PYGZhy{}}\PYG{n}{side\PYGZus{}len}\PYG{p}{(}\PYG{n}{x}\PYG{p}{)}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}\PYG{o}{/}\PYG{n}{side\PYGZus{}len}\PYG{p}{(}\PYG{n}{x}\PYG{p}{)}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,}
              \PYG{k}{lambda} \PYG{n}{x}\PYG{p}{:}  \PYG{n}{side\PYGZus{}len}\PYG{p}{(}\PYG{n}{x}\PYG{p}{)}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{/}\PYG{n}{np}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{n}{side\PYGZus{}len}\PYG{p}{(}\PYG{n}{x}\PYG{p}{)}\PYG{p}{)}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{,}
              \PYG{k}{lambda} \PYG{n}{x}\PYG{p}{:} \PYG{p}{(}\PYG{n}{side\PYGZus{}len}\PYG{p}{(}\PYG{n}{x}\PYG{p}{)}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{\PYGZhy{}}\PYG{n}{side\PYGZus{}len}\PYG{p}{(}\PYG{n}{x}\PYG{p}{)}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}\PYG{o}{/}\PYG{n}{np}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{n}{side\PYGZus{}len}\PYG{p}{(}\PYG{n}{x}\PYG{p}{)}\PYG{p}{)}\PYG{p}{]}


\PYG{k}{def} \PYG{n+nf}{ell\PYGZus{}func}\PYG{p}{(}\PYG{n}{a}\PYG{p}{,} \PYG{n}{b}\PYG{p}{)}\PYG{p}{:} \PYG{k}{return} \PYG{n}{np}\PYG{o}{.}\PYG{n}{sqrt}\PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{square}\PYG{p}{(}\PYG{n}{xx}\PYG{o}{/}\PYG{n}{a}\PYG{p}{)}\PYG{o}{+}\PYG{n}{np}\PYG{o}{.}\PYG{n}{square}\PYG{p}{(}\PYG{n}{yy}\PYG{o}{/}\PYG{n}{b}\PYG{p}{)}\PYG{p}{)} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{l+m+mi}{1}
\end{sphinxVerbatim}


\subsection{How does the anisotropy metrics respond?}
\label{\detokenize{06-ShapeAnalysis:how-does-the-anisotropy-metrics-respond}}
\sphinxAtStartPar
In this demonstration, we look into how the four different anisotropy metrics respond to different radius ratios of an ellipse. The ellipse is nicely aligned with the x\sphinxhyphen{} and y\sphinxhyphen{} axes, therefore we can use the bounding box to identify the side lengths as diameters in the two directions. These side lengths will be used to compute the aniotropy with our four metrics.

\sphinxAtStartPar
Much of the code below is for the animated display.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{ab\PYGZus{}list} \PYG{o}{=} \PYG{p}{[}\PYG{p}{(}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{4}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{5}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{l+m+mf}{1.5}\PYG{p}{,} \PYG{l+m+mi}{5}\PYG{p}{)}\PYG{p}{,}
           \PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{5}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{l+m+mf}{0.5}\PYG{p}{,} \PYG{l+m+mi}{5}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{l+m+mf}{0.1}\PYG{p}{,} \PYG{l+m+mi}{5}\PYG{p}{)}\PYG{p}{,}  \PYG{p}{(}\PYG{l+m+mf}{0.05}\PYG{p}{,} \PYG{l+m+mi}{5}\PYG{p}{)}\PYG{p}{]}
\PYG{n}{func\PYGZus{}pts} \PYG{o}{=} \PYG{n}{defaultdict}\PYG{p}{(}\PYG{n+nb}{list}\PYG{p}{)}

\PYG{n}{fig}\PYG{p}{,} \PYG{n}{m\PYGZus{}axs} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{9}\PYG{p}{,} \PYG{l+m+mi}{6}\PYG{p}{)}\PYG{p}{,} \PYG{n}{dpi}\PYG{o}{=}\PYG{l+m+mi}{100}\PYG{p}{)}

\PYG{k}{def} \PYG{n+nf}{update\PYGZus{}frame}\PYG{p}{(}\PYG{n}{i}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{plt}\PYG{o}{.}\PYG{n}{cla}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{a}\PYG{p}{,} \PYG{n}{b}     \PYG{o}{=} \PYG{n}{ab\PYGZus{}list}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}
    \PYG{n}{c\PYGZus{}img}    \PYG{o}{=} \PYG{n}{ell\PYGZus{}func}\PYG{p}{(}\PYG{n}{a}\PYG{p}{,} \PYG{n}{b}\PYG{p}{)}
    \PYG{n}{reg\PYGZus{}info} \PYG{o}{=} \PYG{n}{regionprops}\PYG{p}{(}\PYG{n}{c\PYGZus{}img}\PYG{o}{.}\PYG{n}{astype}\PYG{p}{(}\PYG{n+nb}{int}\PYG{p}{)}\PYG{p}{)}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}
    \PYG{n}{m\PYGZus{}axs}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{n}{c\PYGZus{}img}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{gist\PYGZus{}earth}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{m\PYGZus{}axs}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Shape \PYGZsh{}}\PYG{l+s+si}{\PYGZob{}\PYGZcb{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{i}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{j}\PYG{p}{,} \PYG{p}{(}\PYG{n}{c\PYGZus{}func}\PYG{p}{,} \PYG{n}{c\PYGZus{}ax}\PYG{p}{)} \PYG{o+ow}{in} \PYG{n+nb}{enumerate}\PYG{p}{(}\PYG{n+nb}{zip}\PYG{p}{(}\PYG{n}{aiso\PYGZus{}funcs}\PYG{p}{,} \PYG{n}{m\PYGZus{}axs}\PYG{o}{.}\PYG{n}{flatten}\PYG{p}{(}\PYG{p}{)}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{:}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{func\PYGZus{}pts}\PYG{p}{[}\PYG{n}{j}\PYG{p}{]} \PYG{o}{+}\PYG{o}{=} \PYG{p}{[}\PYG{n}{c\PYGZus{}func}\PYG{p}{(}\PYG{n}{reg\PYGZus{}info}\PYG{p}{)}\PYG{p}{]}
        \PYG{n}{c\PYGZus{}ax}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{func\PYGZus{}pts}\PYG{p}{[}\PYG{n}{j}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{r\PYGZhy{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{n}{c\PYGZus{}ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Anisotropy \PYGZsh{}}\PYG{l+s+si}{\PYGZob{}\PYGZcb{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{j}\PYG{p}{)}\PYG{p}{)}
        \PYG{n}{c\PYGZus{}ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}ylim}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{o}{.}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{)}
    \PYG{n}{m\PYGZus{}axs}\PYG{o}{.}\PYG{n}{flatten}\PYG{p}{(}\PYG{p}{)}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{axis}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{off}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}


\PYG{c+c1}{\PYGZsh{} write animation frames}
\PYG{n}{anim\PYGZus{}code} \PYG{o}{=} \PYG{n}{FuncAnimation}\PYG{p}{(}\PYG{n}{fig}\PYG{p}{,}
                          \PYG{n}{update\PYGZus{}frame}\PYG{p}{,}
                          \PYG{n}{frames}\PYG{o}{=}\PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{ab\PYGZus{}list}\PYG{p}{)}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{,}
                          \PYG{n}{interval}\PYG{o}{=}\PYG{l+m+mi}{500}\PYG{p}{,}
                          \PYG{n}{repeat\PYGZus{}delay}\PYG{o}{=}\PYG{l+m+mi}{2000}\PYG{p}{)}\PYG{o}{.}\PYG{n}{to\PYGZus{}html5\PYGZus{}video}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{close}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{all}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{HTML}\PYG{p}{(}\PYG{n}{anim\PYGZus{}code}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZlt{}IPython.core.display.HTML object\PYGZgt{}
\end{sphinxVerbatim}


\chapter{Statistical tools}
\label{\detokenize{06-ShapeAnalysis:statistical-tools}}

\section{Useful Statistical Tools}
\label{\detokenize{06-ShapeAnalysis:useful-statistical-tools}}
\sphinxAtStartPar
While many of the topics covered in
\begin{itemize}
\item {} 
\sphinxAtStartPar
Linear Algebra

\item {} 
\sphinxAtStartPar
and Statistics courses

\end{itemize}

\sphinxAtStartPar
might not seem very applicable to real problems at first glance.

\sphinxAtStartPar
at least a few of them come in handy for dealing distributions of pixels

\sphinxAtStartPar
\sphinxstyleemphasis{(they will only be briefly covered, for more detailed review look at some of the suggested material)}


\section{Principal Component Analysis \sphinxhyphen{} PCA}
\label{\detokenize{06-ShapeAnalysis:principal-component-analysis-pca}}\begin{itemize}
\item {} 
\sphinxAtStartPar
Similar to K\sphinxhyphen{}Means insofar as we start with a series of points in a vector space and want to condense the information.

\end{itemize}

\sphinxAtStartPar
With PCA
\begin{itemize}
\item {} 
\sphinxAtStartPar
doesn’t search for distinct groups,

\item {} 
\sphinxAtStartPar
we find a linear combination of components which best explain the variance in the system.

\end{itemize}

\sphinxAtStartPar
To read
\sphinxhref{https://doi.org/10.1098/rsta.2015.0202}{Principal component analysis: a review and recent developments}


\section{PCA definition}
\label{\detokenize{06-ShapeAnalysis:pca-definition}}\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
Compute the covariance or correlation matrix from a set of images

\item {} 
\sphinxAtStartPar
Make an Eigen value or Singular Value Decomposition

\item {} 
\sphinxAtStartPar
Use
\begin{itemize}
\item {} 
\sphinxAtStartPar
singular values to measure the importance of each eigen value

\item {} 
\sphinxAtStartPar
eigen vectors to transform the data

\end{itemize}

\end{enumerate}


\section{PCA on spectroscopy}
\label{\detokenize{06-ShapeAnalysis:pca-on-spectroscopy}}
\sphinxAtStartPar
As an example we will use a very simple (simulated) example from spectroscopy:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{cm\PYGZus{}dm} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{linspace}\PYG{p}{(}\PYG{l+m+mi}{1000}\PYG{p}{,} \PYG{l+m+mi}{4000}\PYG{p}{,} \PYG{l+m+mi}{300}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} helper functions to build our test data}
\PYG{k}{def} \PYG{n+nf}{peak}\PYG{p}{(}\PYG{n}{cent}\PYG{p}{,} \PYG{n}{wid}\PYG{p}{,} \PYG{n}{h}\PYG{p}{)}\PYG{p}{:} \PYG{k}{return} \PYG{n}{h}\PYG{o}{/}\PYG{p}{(}\PYG{n}{wid}\PYG{o}{*}\PYG{n}{np}\PYG{o}{.}\PYG{n}{sqrt}\PYG{p}{(}\PYG{l+m+mi}{2}\PYG{o}{*}\PYG{n}{np}\PYG{o}{.}\PYG{n}{pi}\PYG{p}{)}\PYG{p}{)} \PYG{o}{*} \PYGZbs{}
    \PYG{n}{np}\PYG{o}{.}\PYG{n}{exp}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{n}{np}\PYG{o}{.}\PYG{n}{square}\PYG{p}{(}\PYG{p}{(}\PYG{n}{cm\PYGZus{}dm}\PYG{o}{\PYGZhy{}}\PYG{n}{cent}\PYG{p}{)}\PYG{o}{/}\PYG{n}{wid}\PYG{p}{)}\PYG{p}{)}

\PYG{k}{def} \PYG{n+nf}{peaks}\PYG{p}{(}\PYG{n}{plist}\PYG{p}{)}\PYG{p}{:} \PYG{k}{return} \PYG{n}{np}\PYG{o}{.}\PYG{n}{sum}\PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{stack}\PYG{p}{(}
    \PYG{p}{[}\PYG{n}{peak}\PYG{p}{(}\PYG{n}{cent}\PYG{p}{,} \PYG{n}{wid}\PYG{p}{,} \PYG{n}{h}\PYG{p}{)} \PYG{k}{for} \PYG{n}{cent}\PYG{p}{,} \PYG{n}{wid}\PYG{p}{,} \PYG{n}{h} \PYG{o+ow}{in} \PYG{n}{plist}\PYG{p}{]}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{)}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{)}\PYG{o}{+}\PYG{n}{np}\PYG{o}{.}\PYG{n}{random}\PYG{o}{.}\PYG{n}{uniform}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{size}\PYG{o}{=}\PYG{n}{cm\PYGZus{}dm}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Define material spectra}
\PYG{n}{fat\PYGZus{}curve}     \PYG{o}{=} \PYG{p}{[}\PYG{p}{(}\PYG{l+m+mi}{2900}\PYG{p}{,} \PYG{l+m+mi}{100}\PYG{p}{,} \PYG{l+m+mi}{500}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{l+m+mi}{1680}\PYG{p}{,} \PYG{l+m+mi}{200}\PYG{p}{,} \PYG{l+m+mi}{400}\PYG{p}{)}\PYG{p}{]}
\PYG{n}{protein\PYGZus{}curve} \PYG{o}{=} \PYG{p}{[}\PYG{p}{(}\PYG{l+m+mi}{2900}\PYG{p}{,} \PYG{l+m+mi}{50}\PYG{p}{,} \PYG{l+m+mi}{200}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{l+m+mi}{3400}\PYG{p}{,} \PYG{l+m+mi}{100}\PYG{p}{,} \PYG{l+m+mi}{600}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{l+m+mi}{1680}\PYG{p}{,} \PYG{l+m+mi}{200}\PYG{p}{,} \PYG{l+m+mi}{300}\PYG{p}{)}\PYG{p}{]}
\PYG{n}{noise\PYGZus{}curve}   \PYG{o}{=} \PYG{p}{[}\PYG{p}{(}\PYG{l+m+mi}{3000}\PYG{p}{,} \PYG{l+m+mi}{50}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{]}

\PYG{c+c1}{\PYGZsh{} Plotting}
\PYG{n}{fig}\PYG{p}{,} \PYG{n}{ax} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{4}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{15}\PYG{p}{,} \PYG{l+m+mi}{4}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{cm\PYGZus{}dm}\PYG{p}{,} \PYG{n}{peaks}\PYG{p}{(}\PYG{n}{fat\PYGZus{}curve}\PYG{p}{)}\PYG{p}{)}\PYG{p}{;}     \PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Fat IR Spectra}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{3}\PYG{p}{]}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{cm\PYGZus{}dm}\PYG{p}{,} \PYG{n}{peaks}\PYG{p}{(}\PYG{n}{protein\PYGZus{}curve}\PYG{p}{)}\PYG{p}{)}\PYG{p}{;} \PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{3}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Protein IR Spectra}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{cm\PYGZus{}dm}\PYG{p}{,} \PYG{n}{peaks}\PYG{p}{(}\PYG{n}{noise\PYGZus{}curve}\PYG{p}{)}\PYG{p}{)}\PYG{p}{;}   \PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Noise IR Spectra}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}ylim}\PYG{p}{(}\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{3}\PYG{p}{]}\PYG{o}{.}\PYG{n}{get\PYGZus{}ylim}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}ylim}\PYG{p}{(}\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{3}\PYG{p}{]}\PYG{o}{.}\PYG{n}{get\PYGZus{}ylim}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{data}\PYG{o}{=}\PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{cm\PYGZca{}(\PYGZhy{}1)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{cm\PYGZus{}dm}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{intensity}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{peaks}\PYG{p}{(}\PYG{n}{protein\PYGZus{}curve}\PYG{p}{)}\PYG{p}{\PYGZcb{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{head}\PYG{p}{(}\PYG{l+m+mi}{8}\PYG{p}{)}
\PYG{n}{pd}\PYG{o}{.}\PYG{n}{plotting}\PYG{o}{.}\PYG{n}{table}\PYG{p}{(}\PYG{n}{data}\PYG{o}{=}\PYG{n}{data}\PYG{o}{.}\PYG{n}{round}\PYG{p}{(}\PYG{n}{decimals}\PYG{o}{=}\PYG{l+m+mi}{2}\PYG{p}{)}\PYG{p}{,} \PYG{n}{ax}\PYG{o}{=}\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{n}{loc}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{center}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;} \PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{axis}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{off}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;} \PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Protein spectrum data}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{06-ShapeAnalysis_97_0}.png}


\section{Test Dataset of a number of curves}
\label{\detokenize{06-ShapeAnalysis:test-dataset-of-a-number-of-curves}}
\sphinxAtStartPar
We want to sort cells or samples into groups of being
\begin{itemize}
\item {} 
\sphinxAtStartPar
more fat like

\item {} 
\sphinxAtStartPar
or more protein like.

\end{itemize}


\subsection{How can we analyze this data without specifically looking for peaks or building models?}
\label{\detokenize{06-ShapeAnalysis:how-can-we-analyze-this-data-without-specifically-looking-for-peaks-or-building-models}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{test\PYGZus{}data} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{stack}\PYG{p}{(}\PYG{p}{[}\PYG{n}{peaks}\PYG{p}{(}\PYG{n}{c\PYGZus{}curve}\PYG{p}{)} \PYG{k}{for} \PYG{n}{\PYGZus{}} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{20}\PYG{p}{)}
                      \PYG{k}{for} \PYG{n}{c\PYGZus{}curve} \PYG{o+ow}{in} \PYG{p}{[}\PYG{n}{protein\PYGZus{}curve}\PYG{p}{,} \PYG{n}{fat\PYGZus{}curve}\PYG{p}{,} \PYG{n}{noise\PYGZus{}curve}\PYG{p}{]}\PYG{p}{]}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{)}
\PYG{n}{fig}\PYG{p}{,} \PYG{p}{(}\PYG{n}{ax1}\PYG{p}{,} \PYG{n}{ax2}\PYG{p}{)} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{14}\PYG{p}{,} \PYG{l+m+mi}{6}\PYG{p}{)}\PYG{p}{)}

\PYG{n}{ax1}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{test\PYGZus{}data}\PYG{p}{[}\PYG{p}{:}\PYG{l+m+mi}{4}\PYG{p}{]}\PYG{o}{.}\PYG{n}{T}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{.\PYGZhy{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax1}\PYG{o}{.}\PYG{n}{legend}\PYG{p}{(}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Curve 1}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Curve 2}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Curve 3}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Curve 4}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{n}{ax1}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Data curves with peaks}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax2}\PYG{o}{.}\PYG{n}{scatter}\PYG{p}{(}\PYG{n}{test\PYGZus{}data}\PYG{p}{[}\PYG{p}{:}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{n}{test\PYGZus{}data}\PYG{p}{[}\PYG{p}{:}\PYG{p}{,}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,} \PYG{n}{c}\PYG{o}{=}\PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{test\PYGZus{}data}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}
            \PYG{n}{s}\PYG{o}{=}\PYG{l+m+mi}{20}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{nipy\PYGZus{}spectral}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax2}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Scatter plot of curve 1 and 2}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;} \PYG{n}{ax2}\PYG{o}{.}\PYG{n}{set\PYGZus{}xlabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Curve 1}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;} \PYG{n}{ax2}\PYG{o}{.}\PYG{n}{set\PYGZus{}ylabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Curve 2}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;} 
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{06-ShapeAnalysis_100_0}.png}


\subsection{Fit the data with PCA}
\label{\detokenize{06-ShapeAnalysis:fit-the-data-with-pca}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{sklearn}\PYG{n+nn}{.}\PYG{n+nn}{decomposition} \PYG{k+kn}{import} \PYG{n}{PCA}
\PYG{n}{pca\PYGZus{}tool} \PYG{o}{=} \PYG{n}{PCA}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\PYG{n}{pca\PYGZus{}tool}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{test\PYGZus{}data}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
PCA(n\PYGZus{}components=5)
\end{sphinxVerbatim}


\subsection{Plot principal components}
\label{\detokenize{06-ShapeAnalysis:plot-principal-components}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{fig}\PYG{p}{,} \PYG{p}{(}\PYG{n}{ax1}\PYG{p}{,} \PYG{n}{ax2}\PYG{p}{)} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{14}\PYG{p}{,} \PYG{l+m+mi}{5}\PYG{p}{)}\PYG{p}{,}\PYG{n}{dpi}\PYG{o}{=}\PYG{l+m+mi}{100}\PYG{p}{)}
\PYG{n}{score\PYGZus{}matrix} \PYG{o}{=} \PYG{n}{pca\PYGZus{}tool}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{test\PYGZus{}data}\PYG{p}{)}
\PYG{n}{ax1}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{cm\PYGZus{}dm}\PYG{p}{,} \PYG{n}{pca\PYGZus{}tool}\PYG{o}{.}\PYG{n}{components\PYGZus{}}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{p}{:}\PYG{p}{]}\PYG{p}{,} \PYG{n}{label}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Component \PYGZsh{}1}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax1}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{cm\PYGZus{}dm}\PYG{p}{,} \PYG{n}{pca\PYGZus{}tool}\PYG{o}{.}\PYG{n}{components\PYGZus{}}\PYG{p}{[}
         \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{p}{:}\PYG{p}{]}\PYG{p}{,} \PYG{n}{label}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Component \PYGZsh{}2}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{alpha}\PYG{o}{=}\PYG{n}{pca\PYGZus{}tool}\PYG{o}{.}\PYG{n}{explained\PYGZus{}variance\PYGZus{}ratio\PYGZus{}}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}
\PYG{n}{ax1}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{cm\PYGZus{}dm}\PYG{p}{,} \PYG{n}{pca\PYGZus{}tool}\PYG{o}{.}\PYG{n}{components\PYGZus{}}\PYG{p}{[}
         \PYG{l+m+mi}{2}\PYG{p}{,} \PYG{p}{:}\PYG{p}{]}\PYG{p}{,} \PYG{n}{label}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Component \PYGZsh{}3}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{alpha}\PYG{o}{=}\PYG{n}{pca\PYGZus{}tool}\PYG{o}{.}\PYG{n}{explained\PYGZus{}variance\PYGZus{}ratio\PYGZus{}}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}
\PYG{n}{ax1}\PYG{o}{.}\PYG{n}{legend}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,} \PYG{n}{ax1}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Components}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax2}\PYG{o}{.}\PYG{n}{scatter}\PYG{p}{(}\PYG{n}{score\PYGZus{}matrix}\PYG{p}{[}\PYG{p}{:}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,}
            \PYG{n}{score\PYGZus{}matrix}\PYG{p}{[}\PYG{p}{:}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}
\PYG{n}{ax2}\PYG{o}{.}\PYG{n}{set\PYGZus{}xlabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Component 1}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax2}\PYG{o}{.}\PYG{n}{set\PYGZus{}ylabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Component 2}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{06-ShapeAnalysis_104_0}.png}


\subsection{How important is each component?}
\label{\detokenize{06-ShapeAnalysis:how-important-is-each-component}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{fig}\PYG{p}{,} \PYG{n}{ax1} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{8}\PYG{p}{,} \PYG{l+m+mi}{4}\PYG{p}{)}\PYG{p}{,} \PYG{n}{dpi}\PYG{o}{=}\PYG{l+m+mi}{100}\PYG{p}{)}
\PYG{n}{ax1}\PYG{o}{.}\PYG{n}{bar}\PYG{p}{(}\PYG{n}{x}\PYG{o}{=}\PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{pca\PYGZus{}tool}\PYG{o}{.}\PYG{n}{explained\PYGZus{}variance\PYGZus{}ratio\PYGZus{}}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}
        \PYG{n}{height}\PYG{o}{=}\PYG{l+m+mi}{100}\PYG{o}{*}\PYG{n}{pca\PYGZus{}tool}\PYG{o}{.}\PYG{n}{explained\PYGZus{}variance\PYGZus{}ratio\PYGZus{}}\PYG{p}{)}
\PYG{n}{ax1}\PYG{o}{.}\PYG{n}{set\PYGZus{}xlabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Components}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax1}\PYG{o}{.}\PYG{n}{set\PYGZus{}ylabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Explained Variance (}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{06-ShapeAnalysis_106_0}.png}


\chapter{PCA in materials science}
\label{\detokenize{06-ShapeAnalysis:pca-in-materials-science}}
\sphinxAtStartPar
Explore crystal textures in metals.


\section{Bragg egde imaging \sphinxhyphen{} the imaging technique}
\label{\detokenize{06-ShapeAnalysis:bragg-egde-imaging-the-imaging-technique}}\begin{itemize}
\item {} 
\sphinxAtStartPar
Wavelength resolved neutron imaging provides spectral images

\item {} 
\sphinxAtStartPar
Crystaline properties can be explored in the spectra

\item {} 
\sphinxAtStartPar
Bragg edges appear when the Bragg criterion is fulfilled
\$\(2d\sin{\theta}=n\lambda{}\)\$

\end{itemize}

\sphinxAtStartPar
\sphinxincludegraphics{{Braggs_Law}.png}


\section{Bragg edge imaging example}
\label{\detokenize{06-ShapeAnalysis:bragg-edge-imaging-example}}

\begin{savenotes}\sphinxattablestart
\centering
\begin{tabulary}{\linewidth}[t]{|T|T|T|}
\hline
\sphinxstyletheadfamily 
\sphinxAtStartPar
Samples
&\sphinxstyletheadfamily 
\sphinxAtStartPar
Spectrum
&\sphinxstyletheadfamily 
\sphinxAtStartPar
Wavelength scan
\\
\hline
\sphinxAtStartPar
\sphinxincludegraphics{{icon-spectrum}.png}
&
\sphinxAtStartPar
\sphinxincludegraphics{{energysamples}.png}
&
\sphinxAtStartPar
\sphinxincludegraphics{{energy_scan}.png}
\\
\hline
\end{tabulary}
\par
\sphinxattableend\end{savenotes}

\sphinxAtStartPar
Images courtesy of S. Peetermans


\section{Bragg edge imaging and PCA}
\label{\detokenize{06-ShapeAnalysis:bragg-edge-imaging-and-pca}}

\subsection{The data}
\label{\detokenize{06-ShapeAnalysis:the-data}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{data}\PYG{o}{=}\PYG{n}{np}\PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{data/tofdata.npy}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{fig}\PYG{p}{,}\PYG{n}{ax}\PYG{o}{=}\PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{l+m+mi}{3}\PYG{p}{,}\PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{15}\PYG{p}{,}\PYG{l+m+mi}{4}\PYG{p}{)}\PYG{p}{,}\PYG{n}{dpi}\PYG{o}{=}\PYG{l+m+mi}{100}\PYG{p}{)}
\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{n}{data}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{n}{axis}\PYG{o}{=}\PYG{l+m+mi}{2}\PYG{p}{)}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{viridis}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,} \PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Average image}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{n}{data}\PYG{p}{[}\PYG{p}{:}\PYG{p}{,}\PYG{p}{:}\PYG{p}{,}\PYG{l+m+mi}{100}\PYG{p}{]}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{viridis}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,} \PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Single wavelength bin}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{data}\PYG{p}{[}\PYG{l+m+mi}{20}\PYG{p}{:}\PYG{l+m+mi}{40}\PYG{p}{,}\PYG{l+m+mi}{10}\PYG{p}{:}\PYG{l+m+mi}{20}\PYG{p}{]}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{n}{axis}\PYG{o}{=}\PYG{l+m+mi}{0}\PYG{p}{)}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{n}{axis}\PYG{o}{=}\PYG{l+m+mi}{0}\PYG{p}{)}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Cornflowerblue}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{label} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Material}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{data}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{:}\PYG{l+m+mi}{5}\PYG{p}{,}\PYG{l+m+mi}{40}\PYG{p}{:}\PYG{l+m+mi}{60}\PYG{p}{]}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{n}{axis}\PYG{o}{=}\PYG{l+m+mi}{0}\PYG{p}{)}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{n}{axis}\PYG{o}{=}\PYG{l+m+mi}{0}\PYG{p}{)}\PYG{p}{,}   \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{coral}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}          \PYG{n}{label} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Air}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{data}\PYG{p}{[}\PYG{l+m+mi}{20}\PYG{p}{:}\PYG{l+m+mi}{40}\PYG{p}{,}\PYG{l+m+mi}{32}\PYG{p}{:}\PYG{l+m+mi}{35}\PYG{p}{]}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{n}{axis}\PYG{o}{=}\PYG{l+m+mi}{0}\PYG{p}{)}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{n}{axis}\PYG{o}{=}\PYG{l+m+mi}{0}\PYG{p}{)}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{green}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}          \PYG{n}{label} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Spacer}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Spectra}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;} \PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}xlabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Wavelength bins}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;} \PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}ylabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Transmission}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;} \PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{o}{.}\PYG{n}{legend}\PYG{p}{(}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{06-ShapeAnalysis_111_0}.png}


\subsection{Prepare the data for analysis}
\label{\detokenize{06-ShapeAnalysis:prepare-the-data-for-analysis}}\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
Rearrange the images into 1D arrays \(M\times{}N\times{}T\rightarrow{}M\cdot{}N\times{}T\)

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{fdata}\PYG{o}{=}\PYG{n}{data}\PYG{o}{.}\PYG{n}{reshape}\PYG{p}{(}\PYG{n}{data}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{*}\PYG{n}{data}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,}\PYG{n}{data}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
Compute mean and standard deviation

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{m}  \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{reshape}\PYG{p}{(}\PYG{n}{fdata}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{n}{axis}\PYG{o}{=}\PYG{l+m+mi}{0}\PYG{p}{)}\PYG{p}{,}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{n}{fdata}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{mm} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{ones}\PYG{p}{(}\PYG{p}{(}\PYG{n}{fdata}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{)}\PYG{o}{*}\PYG{n}{m}
\PYG{n}{s}  \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{reshape}\PYG{p}{(}\PYG{n}{fdata}\PYG{o}{.}\PYG{n}{std}\PYG{p}{(}\PYG{n}{axis}\PYG{o}{=}\PYG{l+m+mi}{0}\PYG{p}{)}\PYG{p}{,}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{n}{fdata}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{ss} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{ones}\PYG{p}{(}\PYG{p}{(}\PYG{n}{fdata}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{)}\PYG{o}{*}\PYG{n}{m}
\end{sphinxVerbatim}
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
Normalize data

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{mfdata}\PYG{o}{=}\PYG{p}{(}\PYG{n}{fdata}\PYG{o}{\PYGZhy{}}\PYG{n}{mm}\PYG{p}{)}\PYG{o}{/}\PYG{n}{ss}
\end{sphinxVerbatim}


\subsection{Run the PCA}
\label{\detokenize{06-ShapeAnalysis:run-the-pca}}\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
Initialize PCA with 5 components

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{pca\PYGZus{}tool} \PYG{o}{=} \PYG{n}{PCA}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
Fit data with PCA

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{pca\PYGZus{}tool}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{mfdata}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
PCA(n\PYGZus{}components=5)
\end{sphinxVerbatim}


\subsection{Inspect the PCA fit}
\label{\detokenize{06-ShapeAnalysis:inspect-the-pca-fit}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{score\PYGZus{}matrix} \PYG{o}{=} \PYG{n}{pca\PYGZus{}tool}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{mfdata}\PYG{p}{)}

\PYG{n}{fig}\PYG{p}{,} \PYG{n}{ax} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{15}\PYG{p}{,} \PYG{l+m+mi}{5}\PYG{p}{)}\PYG{p}{,}\PYG{n}{dpi}\PYG{o}{=}\PYG{l+m+mi}{100}\PYG{p}{)}
\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{semilogy}\PYG{p}{(}\PYG{n}{pca\PYGZus{}tool}\PYG{o}{.}\PYG{n}{explained\PYGZus{}variance\PYGZus{}ratio\PYGZus{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{o\PYGZhy{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;} 
\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Explained variance ratio}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;} \PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}xlabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Principal component \PYGZsh{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{pca\PYGZus{}tool}\PYG{o}{.}\PYG{n}{components\PYGZus{}}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{p}{:}\PYG{p}{]}\PYG{p}{,} \PYG{n}{label}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Component \PYGZsh{}1}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{pca\PYGZus{}tool}\PYG{o}{.}\PYG{n}{components\PYGZus{}}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{p}{:}\PYG{p}{]}\PYG{p}{,} \PYG{n}{label}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Component \PYGZsh{}2}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{pca\PYGZus{}tool}\PYG{o}{.}\PYG{n}{components\PYGZus{}}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{p}{:}\PYG{p}{]}\PYG{p}{,} \PYG{n}{label}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Component \PYGZsh{}3}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{legend}\PYG{p}{(}\PYG{p}{)}\PYG{p}{;} \PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Components}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{o}{.}\PYG{n}{scatter}\PYG{p}{(}\PYG{n}{score\PYGZus{}matrix}\PYG{p}{[}\PYG{p}{:}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{n}{score\PYGZus{}matrix}\PYG{p}{[}\PYG{p}{:}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{;} \PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}xlabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Component 1}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;} \PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}ylabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Component 2}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{06-ShapeAnalysis_124_0}.png}


\subsection{Improve the scatter plot}
\label{\detokenize{06-ShapeAnalysis:improve-the-scatter-plot}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{fig}\PYG{p}{,} \PYG{n}{ax} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{15}\PYG{p}{,} \PYG{l+m+mi}{7}\PYG{p}{)}\PYG{p}{,}\PYG{n}{dpi}\PYG{o}{=}\PYG{l+m+mi}{100}\PYG{p}{)}
\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{scatter}\PYG{p}{(}\PYG{n}{score\PYGZus{}matrix}\PYG{p}{[}\PYG{p}{:}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{n}{score\PYGZus{}matrix}\PYG{p}{[}\PYG{p}{:}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{;} \PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}xlabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Component 1}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;} \PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}ylabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Component 2}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+sa}{r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Marker \PYGZdl{}}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{alpha\PYGZdl{}=1}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{scatter}\PYG{p}{(}\PYG{n}{score\PYGZus{}matrix}\PYG{p}{[}\PYG{p}{:}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{n}{score\PYGZus{}matrix}\PYG{p}{[}\PYG{p}{:}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,} \PYG{n}{alpha}\PYG{o}{=}\PYG{l+m+mf}{0.05}\PYG{p}{)}\PYG{p}{;} \PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}xlabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Component 1}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;} \PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}ylabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Component 2}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+sa}{r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Marker \PYGZdl{}}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{alpha\PYGZdl{}=0.05}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{06-ShapeAnalysis_126_0}.png}


\subsection{Visualize the PCAs with color coding}
\label{\detokenize{06-ShapeAnalysis:visualize-the-pcas-with-color-coding}}
\sphinxAtStartPar
Inspired by \sphinxhref{https://doi.org/10.1088/2399-6528/ab5575}{PCA in materials science}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Reshape the first three principal components}
\PYG{n}{cdata} \PYG{o}{=} \PYG{n}{score\PYGZus{}matrix}\PYG{p}{[}\PYG{p}{:}\PYG{p}{,}\PYG{p}{:}\PYG{l+m+mi}{3}\PYG{p}{]}\PYG{o}{.}\PYG{n}{reshape}\PYG{p}{(}\PYG{p}{[}\PYG{n}{data}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,}\PYG{n}{data}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,}\PYG{l+m+mi}{3}\PYG{p}{]}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Normalize the chanels}
\PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{3}\PYG{p}{)} \PYG{p}{:}
    \PYG{n}{cdata}\PYG{p}{[}\PYG{p}{:}\PYG{p}{,}\PYG{p}{:}\PYG{p}{,}\PYG{n}{i}\PYG{p}{]}\PYG{o}{=}\PYG{p}{(}\PYG{n}{cdata}\PYG{p}{[}\PYG{p}{:}\PYG{p}{,}\PYG{p}{:}\PYG{p}{,}\PYG{n}{i}\PYG{p}{]}\PYG{o}{\PYGZhy{}}\PYG{n}{cdata}\PYG{p}{[}\PYG{p}{:}\PYG{p}{,}\PYG{p}{:}\PYG{p}{,}\PYG{n}{i}\PYG{p}{]}\PYG{o}{.}\PYG{n}{min}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}\PYG{o}{/}\PYG{p}{(}\PYG{n}{cdata}\PYG{p}{[}\PYG{p}{:}\PYG{p}{,}\PYG{p}{:}\PYG{p}{,}\PYG{n}{i}\PYG{p}{]}\PYG{o}{.}\PYG{n}{max}\PYG{p}{(}\PYG{p}{)}\PYG{o}{\PYGZhy{}}\PYG{n}{cdata}\PYG{p}{[}\PYG{p}{:}\PYG{p}{,}\PYG{p}{:}\PYG{p}{,}\PYG{n}{i}\PYG{p}{]}\PYG{o}{.}\PYG{n}{min}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
    
\PYG{n}{fig}\PYG{p}{,} \PYG{n}{ax} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{l+m+mi}{2}\PYG{p}{,}\PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{12}\PYG{p}{,}\PYG{l+m+mi}{6}\PYG{p}{)}\PYG{p}{,} \PYG{n}{dpi}\PYG{o}{=}\PYG{l+m+mi}{150}\PYG{p}{)}
\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{n}{data}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{n}{axis}\PYG{o}{=}\PYG{l+m+mi}{2}\PYG{p}{)}\PYG{p}{)}\PYG{p}{;} \PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{White beam image}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{n}{cdata}\PYG{p}{)}\PYG{p}{;} \PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{PCA enhanced image}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{06-ShapeAnalysis_128_0}.png}

\sphinxAtStartPar
The PCA enhanced image does not represent a physical reality, but it can be used as a qualitative tool to guide the material analysis.


\subsection{PCA and segmentation}
\label{\detokenize{06-ShapeAnalysis:pca-and-segmentation}}
\sphinxAtStartPar
The next step is to use the enhanced image for segmentation:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{fig}\PYG{p}{,} \PYG{n}{ax} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{l+m+mi}{2}\PYG{p}{,}\PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{12}\PYG{p}{,}\PYG{l+m+mi}{6}\PYG{p}{)}\PYG{p}{,} \PYG{n}{dpi}\PYG{o}{=}\PYG{l+m+mi}{150}\PYG{p}{)}
\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{n}{cdata}\PYG{p}{)}\PYG{p}{;} \PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{PCA enhanced image}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{scatter}\PYG{p}{(}\PYG{n}{score\PYGZus{}matrix}\PYG{p}{[}\PYG{p}{:}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{n}{score\PYGZus{}matrix}\PYG{p}{[}\PYG{p}{:}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,} \PYG{n}{alpha}\PYG{o}{=}\PYG{l+m+mf}{0.05}\PYG{p}{)}\PYG{p}{;} \PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}xlabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Component 1}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;} \PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}ylabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Component 2}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+sa}{r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Principal components}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{06-ShapeAnalysis_131_0}.png}

\sphinxAtStartPar
A project task…
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
Combine clustering and PCA to identify regions in the samples

\end{enumerate}


\chapter{Principal Component Analysis}
\label{\detokenize{06-ShapeAnalysis:principal-component-analysis}}

\section{SciKit\sphinxhyphen{}learn Face Analyis}
\label{\detokenize{06-ShapeAnalysis:scikit-learn-face-analyis}}
\sphinxAtStartPar
Here we show a more imaging related example from the scikit\sphinxhyphen{}learn documentation where we do basic face analysis with scikit\sphinxhyphen{}learn.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{sklearn}\PYG{n+nn}{.}\PYG{n+nn}{datasets} \PYG{k+kn}{import} \PYG{n}{fetch\PYGZus{}olivetti\PYGZus{}faces}
\PYG{k+kn}{from} \PYG{n+nn}{sklearn} \PYG{k+kn}{import} \PYG{n}{decomposition}
\PYG{c+c1}{\PYGZsh{} Load faces data}
\PYG{k}{try}\PYG{p}{:}
    \PYG{n}{dataset} \PYG{o}{=} \PYG{n}{fetch\PYGZus{}olivetti\PYGZus{}faces}\PYG{p}{(}
        \PYG{n}{shuffle}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,} \PYG{n}{random\PYGZus{}state}\PYG{o}{=}\PYG{l+m+mi}{2018}\PYG{p}{,} \PYG{n}{data\PYGZus{}home}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{.}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{faces} \PYG{o}{=} \PYG{n}{dataset}\PYG{o}{.}\PYG{n}{data}
\PYG{k}{except} \PYG{n+ne}{Exception} \PYG{k}{as} \PYG{n}{e}\PYG{p}{:}
    \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Face data not available}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{e}\PYG{p}{)}
    \PYG{n}{faces} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{random}\PYG{o}{.}\PYG{n}{uniform}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{p}{(}\PYG{l+m+mi}{400}\PYG{p}{,} \PYG{l+m+mi}{4096}\PYG{p}{)}\PYG{p}{)}

\PYG{n}{n\PYGZus{}samples}\PYG{p}{,} \PYG{n}{n\PYGZus{}features} \PYG{o}{=} \PYG{n}{faces}\PYG{o}{.}\PYG{n}{shape}
\PYG{n}{n\PYGZus{}row}\PYG{p}{,} \PYG{n}{n\PYGZus{}col} \PYG{o}{=} \PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{3}
\PYG{n}{n\PYGZus{}components} \PYG{o}{=} \PYG{n}{n\PYGZus{}row} \PYG{o}{*} \PYG{n}{n\PYGZus{}col}
\PYG{n}{image\PYGZus{}shape} \PYG{o}{=} \PYG{p}{(}\PYG{l+m+mi}{64}\PYG{p}{,} \PYG{l+m+mi}{64}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} global centering}
\PYG{n}{faces\PYGZus{}centered} \PYG{o}{=} \PYG{n}{faces} \PYG{o}{\PYGZhy{}} \PYG{n}{faces}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{n}{axis}\PYG{o}{=}\PYG{l+m+mi}{0}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} local centering}
\PYG{n}{faces\PYGZus{}centered} \PYG{o}{\PYGZhy{}}\PYG{o}{=} \PYG{n}{faces\PYGZus{}centered}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{n}{axis}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{o}{.}\PYG{n}{reshape}\PYG{p}{(}\PYG{n}{n\PYGZus{}samples}\PYG{p}{,} \PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{)}

\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Dataset consists of }\PYG{l+s+si}{\PYGZpc{}d}\PYG{l+s+s2}{ faces}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{\PYGZpc{}} \PYG{n}{n\PYGZus{}samples}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
downloading Olivetti faces from https://ndownloader.figshare.com/files/5976027 to .
Dataset consists of 400 faces
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{plot\PYGZus{}gallery}\PYG{p}{(}\PYG{n}{title}\PYG{p}{,} \PYG{n}{images}\PYG{p}{,} \PYG{n}{n\PYGZus{}col}\PYG{o}{=}\PYG{n}{n\PYGZus{}col}\PYG{p}{,} \PYG{n}{n\PYGZus{}row}\PYG{o}{=}\PYG{n}{n\PYGZus{}row}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{plt}\PYG{o}{.}\PYG{n}{figure}\PYG{p}{(}\PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mf}{2.} \PYG{o}{*} \PYG{n}{n\PYGZus{}col}\PYG{p}{,} \PYG{l+m+mf}{2.26} \PYG{o}{*} \PYG{n}{n\PYGZus{}row}\PYG{p}{)}\PYG{p}{)}
    \PYG{n}{plt}\PYG{o}{.}\PYG{n}{suptitle}\PYG{p}{(}\PYG{n}{title}\PYG{p}{,} \PYG{n}{size}\PYG{o}{=}\PYG{l+m+mi}{16}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{i}\PYG{p}{,} \PYG{n}{comp} \PYG{o+ow}{in} \PYG{n+nb}{enumerate}\PYG{p}{(}\PYG{n}{images}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplot}\PYG{p}{(}\PYG{n}{n\PYGZus{}row}\PYG{p}{,} \PYG{n}{n\PYGZus{}col}\PYG{p}{,} \PYG{n}{i} \PYG{o}{+} \PYG{l+m+mi}{1}\PYG{p}{)}
        \PYG{n}{vmax} \PYG{o}{=} \PYG{n+nb}{max}\PYG{p}{(}\PYG{n}{comp}\PYG{o}{.}\PYG{n}{max}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,} \PYG{o}{\PYGZhy{}}\PYG{n}{comp}\PYG{o}{.}\PYG{n}{min}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
        \PYG{n}{plt}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{n}{comp}\PYG{o}{.}\PYG{n}{reshape}\PYG{p}{(}\PYG{n}{image\PYGZus{}shape}\PYG{p}{)}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{n}{plt}\PYG{o}{.}\PYG{n}{cm}\PYG{o}{.}\PYG{n}{gray}\PYG{p}{,}
                   \PYG{n}{interpolation}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{nearest}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                   \PYG{n}{vmin}\PYG{o}{=}\PYG{o}{\PYGZhy{}}\PYG{n}{vmax}\PYG{p}{,} \PYG{n}{vmax}\PYG{o}{=}\PYG{n}{vmax}\PYG{p}{)}
        \PYG{n}{plt}\PYG{o}{.}\PYG{n}{xticks}\PYG{p}{(}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
        \PYG{n}{plt}\PYG{o}{.}\PYG{n}{yticks}\PYG{p}{(}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
    \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots\PYGZus{}adjust}\PYG{p}{(}\PYG{l+m+mf}{0.01}\PYG{p}{,} \PYG{l+m+mf}{0.05}\PYG{p}{,} \PYG{l+m+mf}{0.99}\PYG{p}{,} \PYG{l+m+mf}{0.93}\PYG{p}{,} \PYG{l+m+mf}{0.04}\PYG{p}{,} \PYG{l+m+mf}{0.}\PYG{p}{)}


\PYG{c+c1}{\PYGZsh{} \PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}}
\PYG{c+c1}{\PYGZsh{} List of the different estimators, whether to center and transpose the}
\PYG{c+c1}{\PYGZsh{} problem, and whether the transformer uses the clustering API.}
\PYG{n}{estimators} \PYG{o}{=} \PYG{p}{[}
    \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Eigenfaces \PYGZhy{} PCA using randomized SVD}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
     \PYG{n}{decomposition}\PYG{o}{.}\PYG{n}{PCA}\PYG{p}{(}\PYG{n}{n\PYGZus{}components}\PYG{o}{=}\PYG{n}{n\PYGZus{}components}\PYG{p}{,} \PYG{n}{svd\PYGZus{}solver}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{randomized}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                       \PYG{n}{whiten}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}\PYG{p}{,}
     \PYG{k+kc}{True}\PYG{p}{)}\PYG{p}{]}
\PYG{c+c1}{\PYGZsh{} \PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}}
\PYG{c+c1}{\PYGZsh{} Plot a sample of the input data}

\PYG{n}{plot\PYGZus{}gallery}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{First centered Olivetti faces}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{faces\PYGZus{}centered}\PYG{p}{[}\PYG{p}{:}\PYG{n}{n\PYGZus{}components}\PYG{p}{]}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} \PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}}
\PYG{c+c1}{\PYGZsh{} Do the estimation and plot it}

\PYG{k}{for} \PYG{n}{name}\PYG{p}{,} \PYG{n}{estimator}\PYG{p}{,} \PYG{n}{center} \PYG{o+ow}{in} \PYG{n}{estimators}\PYG{p}{:}
    \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Extracting the top }\PYG{l+s+si}{\PYGZpc{}d}\PYG{l+s+s2}{ }\PYG{l+s+si}{\PYGZpc{}s}\PYG{l+s+s2}{...}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{\PYGZpc{}} \PYG{p}{(}\PYG{n}{n\PYGZus{}components}\PYG{p}{,} \PYG{n}{name}\PYG{p}{)}\PYG{p}{)}
    \PYG{n}{data} \PYG{o}{=} \PYG{n}{faces}
    \PYG{k}{if} \PYG{n}{center}\PYG{p}{:}
        \PYG{n}{data} \PYG{o}{=} \PYG{n}{faces\PYGZus{}centered}
    \PYG{n}{estimator}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{data}\PYG{p}{)}

    \PYG{k}{if} \PYG{n+nb}{hasattr}\PYG{p}{(}\PYG{n}{estimator}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{cluster\PYGZus{}centers\PYGZus{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{components\PYGZus{}} \PYG{o}{=} \PYG{n}{estimator}\PYG{o}{.}\PYG{n}{cluster\PYGZus{}centers\PYGZus{}}
    \PYG{k}{else}\PYG{p}{:}
        \PYG{n}{components\PYGZus{}} \PYG{o}{=} \PYG{n}{estimator}\PYG{o}{.}\PYG{n}{components\PYGZus{}}
    \PYG{n}{plot\PYGZus{}gallery}\PYG{p}{(}\PYG{n}{name}\PYG{p}{,}
                 \PYG{n}{components\PYGZus{}}\PYG{p}{[}\PYG{p}{:}\PYG{n}{n\PYGZus{}components}\PYG{p}{]}\PYG{p}{)}

\PYG{n}{plt}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
Extracting the top 6 Eigenfaces \PYGZhy{} PCA using randomized SVD...
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{06-ShapeAnalysis_135_1}.png}

\noindent\sphinxincludegraphics{{06-ShapeAnalysis_135_2}.png}


\chapter{Applied PCA: Shape Tensor}
\label{\detokenize{06-ShapeAnalysis:applied-pca-shape-tensor}}

\section{How do these statistical analyses help us?}
\label{\detokenize{06-ShapeAnalysis:how-do-these-statistical-analyses-help-us}}
\sphinxAtStartPar
Going back to a single cell, we have the a distribution of \(x\) and \(y\) values.
\begin{itemize}
\item {} 
\sphinxAtStartPar
are not however completely independent

\item {} 
\sphinxAtStartPar
greatest variance does not normally lie in either x nor y alone.

\end{itemize}

\sphinxAtStartPar
A principal component analysis of the voxel positions, will calculate two new principal components (the components themselves are the relationships between the input variables and the scores are the final values.)
\begin{itemize}
\item {} 
\sphinxAtStartPar
An optimal rotation of the coordinate system

\end{itemize}

\sphinxAtStartPar
We start off by calculating the covariance matrix from the list of \(x\), \(y\), and \(z\) points that make up our object of interest.
\begin{equation*}
\begin{split} COV(I_{id}) = \frac{1}{N} \sum_{\forall\vec{v}\in I_{id}} \begin{bmatrix}
\vec{v}_x\vec{v}_x & \vec{v}_x\vec{v}_y & \vec{v}_x\vec{v}_z\\
\vec{v}_y\vec{v}_x & \vec{v}_y\vec{v}_y & \vec{v}_y\vec{v}_z\\
\vec{v}_z\vec{v}_x & \vec{v}_z\vec{v}_y & \vec{v}_z\vec{v}_z
\end{bmatrix} \end{split}
\end{equation*}
\sphinxAtStartPar
We then take the eigentransform of this array to obtain the eigenvectors (principal components, \(\vec{\Lambda}_{1\cdots 3}\)) and eigenvalues (scores, \(\lambda_{1\cdots 3}\))
\begin{equation*}
\begin{split} COV(I_{id}) \longrightarrow \underbrace{\begin{bmatrix}
\vec{\Lambda}_{1x} & \vec{\Lambda}_{1y} & \vec{\Lambda}_{1z} \\
\vec{\Lambda}_{2x} & \vec{\Lambda}_{2y} & \vec{\Lambda}_{2z} \\
\vec{\Lambda}_{3x} & \vec{\Lambda}_{3y} & \vec{\Lambda}_{3z} 
\end{bmatrix}}_{\textrm{Eigenvectors}} * \underbrace{\begin{bmatrix} 
\lambda_1 & 0 & 0 \\ 
0 & \lambda_2 & 0 \\
0 & 0 & \lambda_3
\end{bmatrix}}_{\textrm{Eigenvalues}} * \underbrace{\begin{bmatrix}
\vec{\Lambda}_{1x} & \vec{\Lambda}_{1y} & \vec{\Lambda}_{1z} \\
\vec{\Lambda}_{2x} & \vec{\Lambda}_{2y} & \vec{\Lambda}_{2z} \\
\vec{\Lambda}_{3x} & \vec{\Lambda}_{3y} & \vec{\Lambda}_{3z} 
\end{bmatrix}^{T}}_{\textrm{Eigenvectors}} \end{split}
\end{equation*}
\sphinxAtStartPar
The principal components tell us about the orientation of the object and the scores tell us about the corresponding magnitude (or length) in that direction.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{seg\PYGZus{}img} \PYG{o}{=} \PYG{n}{imread}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{figures/aachen\PYGZus{}label.png}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)} \PYG{o}{==} \PYG{l+m+mi}{26}
\PYG{n}{seg\PYGZus{}img} \PYG{o}{=} \PYG{n}{seg\PYGZus{}img}\PYG{p}{[}\PYG{p}{:}\PYG{p}{:}\PYG{l+m+mi}{4}\PYG{p}{,} \PYG{p}{:}\PYG{p}{:}\PYG{l+m+mi}{4}\PYG{p}{]}
\PYG{n}{seg\PYGZus{}img} \PYG{o}{=} \PYG{n}{seg\PYGZus{}img}\PYG{p}{[}\PYG{l+m+mi}{130}\PYG{p}{:}\PYG{l+m+mi}{110}\PYG{p}{:}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{378}\PYG{p}{:}\PYG{l+m+mi}{420}\PYG{p}{:}\PYG{l+m+mi}{3}\PYG{p}{]} \PYG{o}{\PYGZgt{}} \PYG{l+m+mi}{0}
\PYG{n}{seg\PYGZus{}img} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{pad}\PYG{p}{(}\PYG{n}{seg\PYGZus{}img}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{,} \PYG{n}{mode}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{constant}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{seg\PYGZus{}img}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{]} \PYG{o}{=} \PYG{l+m+mi}{0}
\PYG{n}{\PYGZus{}}\PYG{p}{,} \PYG{p}{(}\PYG{n}{ax1}\PYG{p}{)} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{7}\PYG{p}{,} \PYG{l+m+mi}{7}\PYG{p}{)}\PYG{p}{,} \PYG{n}{dpi}\PYG{o}{=}\PYG{l+m+mi}{100}\PYG{p}{)}
\PYG{n}{ax1}\PYG{o}{.}\PYG{n}{matshow}\PYG{p}{(}\PYG{n}{seg\PYGZus{}img}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{bone\PYGZus{}r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{06-ShapeAnalysis_138_0}.png}


\subsection{Eigenvectors of the positions}
\label{\detokenize{06-ShapeAnalysis:eigenvectors-of-the-positions}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{\PYGZus{}}\PYG{p}{,} \PYG{p}{(}\PYG{n}{ax1}\PYG{p}{)} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,}
                        \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{7}\PYG{p}{,} \PYG{l+m+mi}{7}\PYG{p}{)}\PYG{p}{,}
                        \PYG{n}{dpi}\PYG{o}{=}\PYG{l+m+mi}{100}\PYG{p}{)}


\PYG{n}{ax1}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{xy\PYGZus{}pts}\PYG{p}{[}\PYG{p}{:}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{\PYGZhy{}}\PYG{n}{np}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{n}{xy\PYGZus{}pts}\PYG{p}{[}\PYG{p}{:}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}
         \PYG{n}{xy\PYGZus{}pts}\PYG{p}{[}\PYG{p}{:}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{\PYGZhy{}}\PYG{n}{np}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{n}{xy\PYGZus{}pts}\PYG{p}{[}\PYG{p}{:}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{s}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lightgreen}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{label}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Points}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{markersize}\PYG{o}{=}\PYG{l+m+mi}{10}\PYG{p}{)}
\PYG{n}{ax1}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{n}{shape\PYGZus{}pca}\PYG{o}{.}\PYG{n}{explained\PYGZus{}variance\PYGZus{}}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{/}\PYG{l+m+mi}{2}\PYG{o}{*}\PYG{n}{shape\PYGZus{}pca}\PYG{o}{.}\PYG{n}{components\PYGZus{}}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{]}\PYG{p}{,}
         \PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{n}{shape\PYGZus{}pca}\PYG{o}{.}\PYG{n}{explained\PYGZus{}variance\PYGZus{}}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{/}\PYG{l+m+mi}{2}\PYG{o}{*}\PYG{n}{shape\PYGZus{}pca}\PYG{o}{.}\PYG{n}{components\PYGZus{}}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZhy{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{blueviolet}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{linewidth}\PYG{o}{=}\PYG{l+m+mi}{4}\PYG{p}{,}
         \PYG{n}{label}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{PCA1}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax1}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{n}{shape\PYGZus{}pca}\PYG{o}{.}\PYG{n}{explained\PYGZus{}variance\PYGZus{}}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{/}\PYG{l+m+mi}{2}\PYG{o}{*}\PYG{n}{shape\PYGZus{}pca}\PYG{o}{.}\PYG{n}{components\PYGZus{}}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{]}\PYG{p}{,}
         \PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{n}{shape\PYGZus{}pca}\PYG{o}{.}\PYG{n}{explained\PYGZus{}variance\PYGZus{}}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{/}\PYG{l+m+mi}{2}\PYG{o}{*}\PYG{n}{shape\PYGZus{}pca}\PYG{o}{.}\PYG{n}{components\PYGZus{}}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZhy{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{orange}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{linewidth}\PYG{o}{=}\PYG{l+m+mi}{4}\PYG{p}{,}
         \PYG{n}{label}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{PCA2}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax1}\PYG{o}{.}\PYG{n}{legend}\PYG{p}{(}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{06-ShapeAnalysis_140_0}.png}


\subsection{Rotate object using eigenvectors}
\label{\detokenize{06-ShapeAnalysis:rotate-object-using-eigenvectors}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{sklearn}\PYG{n+nn}{.}\PYG{n+nn}{decomposition} \PYG{k+kn}{import} \PYG{n}{PCA}
\PYG{n}{x\PYGZus{}coord}\PYG{p}{,} \PYG{n}{y\PYGZus{}coord} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{where}\PYG{p}{(}\PYG{n}{seg\PYGZus{}img} \PYG{o}{\PYGZgt{}} \PYG{l+m+mi}{0}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{} Get object coordinates}
\PYG{n}{xy\PYGZus{}pts} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{stack}\PYG{p}{(}\PYG{p}{[}\PYG{n}{x\PYGZus{}coord}\PYG{p}{,} \PYG{n}{y\PYGZus{}coord}\PYG{p}{]}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{} Build a N x 2 matrix}
\PYG{n}{shape\PYGZus{}pca} \PYG{o}{=} \PYG{n}{PCA}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{shape\PYGZus{}pca}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{xy\PYGZus{}pts}\PYG{p}{)}
\PYG{n}{pca\PYGZus{}xy\PYGZus{}vals} \PYG{o}{=} \PYG{n}{shape\PYGZus{}pca}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{xy\PYGZus{}pts}\PYG{p}{)}
\PYG{n}{\PYGZus{}}\PYG{p}{,} \PYG{p}{(}\PYG{n}{ax1}\PYG{p}{)} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,}
                        \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{7}\PYG{p}{,} \PYG{l+m+mi}{7}\PYG{p}{)}\PYG{p}{,}
                        \PYG{n}{dpi}\PYG{o}{=}\PYG{l+m+mi}{100}\PYG{p}{)}
\PYG{n}{ax1}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{pca\PYGZus{}xy\PYGZus{}vals}\PYG{p}{[}\PYG{p}{:}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{n}{pca\PYGZus{}xy\PYGZus{}vals}\PYG{p}{[}\PYG{p}{:}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{s}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{limegreen}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{markersize}\PYG{o}{=}\PYG{l+m+mi}{10}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{06-ShapeAnalysis_142_0}.png}


\section{Principal Component Analysis: Take home message}
\label{\detokenize{06-ShapeAnalysis:principal-component-analysis-take-home-message}}\begin{itemize}
\item {} 
\sphinxAtStartPar
We calculate the statistical distribution individually for \(x\), \(y\), and \(z\) and the ‘correlations’ between them.

\item {} 
\sphinxAtStartPar
From these values we can estimate the orientation in the direction of largest variance

\item {} 
\sphinxAtStartPar
We can also estimate magnitude

\item {} 
\sphinxAtStartPar
These functions are implemented as \sphinxcode{\sphinxupquote{princomp}} or \sphinxcode{\sphinxupquote{pca}} in various languages and scale well to very large datasets.

\end{itemize}


\section{Principal Component Analysis: Elliptical Model}
\label{\detokenize{06-ShapeAnalysis:principal-component-analysis-elliptical-model}}
\sphinxAtStartPar
While the eigenvalues and eigenvectors are in their own right useful
\begin{itemize}
\item {} 
\sphinxAtStartPar
Not obvious how to visually represent these tensor objects

\item {} 
\sphinxAtStartPar
Ellipsoidal (Ellipse in 2D) representation alleviates this issue

\end{itemize}


\subsection{Ellipsoidal Representation}
\label{\detokenize{06-ShapeAnalysis:ellipsoidal-representation}}\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
Center of Volume is calculated normally

\item {} 
\sphinxAtStartPar
Eigenvectors represent the unit vectors for the semiaxes of the ellipsoid

\item {} 
\sphinxAtStartPar
\(\sqrt{\text{Eigenvalues}}\) is proportional to the length of the semiaxis (\(\mathcal{l}=\sqrt{5\lambda_i}\)), derivation similar to moment of inertia tensor for ellipsoids.

\end{enumerate}


\bigskip\hrule\bigskip



\chapter{Next Time on QBI}
\label{\detokenize{06-ShapeAnalysis:next-time-on-qbi}}
\sphinxAtStartPar
So, while bounding box and ellipse\sphinxhyphen{}based models are useful for many object and cells, they do a very poor job with other samples


\bigskip\hrule\bigskip



\section{Why}
\label{\detokenize{06-ShapeAnalysis:why}}\begin{itemize}
\item {} 
\sphinxAtStartPar
We assume an entity consists of connected pixels (wrong)

\item {} 
\sphinxAtStartPar
We assume the objects are well modeled by an ellipse (also wrong)

\end{itemize}


\section{What to do?}
\label{\detokenize{06-ShapeAnalysis:what-to-do}}\begin{itemize}
\item {} 
\sphinxAtStartPar
Is it 3 connected objects which should all be analzed seperately?

\item {} 
\sphinxAtStartPar
If we could \sphinxstylestrong{divide it}, we could then analyze each spart as an ellipse

\item {} 
\sphinxAtStartPar
Is it one network of objects and we want to know about the constrictions?

\item {} 
\sphinxAtStartPar
Is it a cell or organelle with docking sites for cell?

\item {} 
\sphinxAtStartPar
Neither extents nor anisotropy are very meaningful, we need a \sphinxstylestrong{more specific metric} which can characterize

\end{itemize}


\chapter{Summary}
\label{\detokenize{06-ShapeAnalysis:summary}}

\section{Component labeling}
\label{\detokenize{06-ShapeAnalysis:component-labeling}}\begin{itemize}
\item {} 
\sphinxAtStartPar
What is it

\item {} 
\sphinxAtStartPar
What is the impact of difference neighborhoods

\end{itemize}


\section{Object description}
\label{\detokenize{06-ShapeAnalysis:object-description}}\begin{itemize}
\item {} 
\sphinxAtStartPar
Center of objects

\item {} 
\sphinxAtStartPar
Bounding boxes \sphinxhyphen{} extents

\end{itemize}


\section{Principal component analysis}
\label{\detokenize{06-ShapeAnalysis:id4}}\begin{itemize}
\item {} 
\sphinxAtStartPar
Definition

\item {} 
\sphinxAtStartPar
PCA in spectroscopy

\item {} 
\sphinxAtStartPar
PCA to analyze shapes

\end{itemize}


\chapter{Advanced Shape and Texture}
\label{\detokenize{06-AdvancedShapeAndTexture:advanced-shape-and-texture}}\label{\detokenize{06-AdvancedShapeAndTexture::doc}}




\sphinxAtStartPar
Quantitative Big Imaging ETHZ: 227\sphinxhyphen{}0966\sphinxhyphen{}00L


\sphinxAtStartPar
Part 2






\section{Literature / Useful References}
\label{\detokenize{06-AdvancedShapeAndTexture:literature-useful-references}}

\subsection{Books}
\label{\detokenize{06-AdvancedShapeAndTexture:books}}\begin{itemize}
\item {} 
\sphinxAtStartPar
Jean Claude, Morphometry with R

\item {} 
\sphinxAtStartPar
\sphinxhref{http://link.springer.com/book/10.1007\%2F978-0-387-77789-4}{Online} through ETHZ

\item {} 
\sphinxAtStartPar
\sphinxhref{http://www.amazon.com/Morphometrics-R-Use-Julien-Claude/dp/038777789X}{Buy it}

\item {} 
\sphinxAtStartPar
John C. Russ, “The Image Processing Handbook”,(Boca Raton, CRC Press)

\item {} 
\sphinxAtStartPar
Available \sphinxhref{http://dx.doi.org/10.1201/9780203881095}{online} within domain \sphinxhref{http://ethz.ch}{ethz.ch} (or \sphinxhref{http://proxy.ethz.ch}{proxy.ethz.ch} / public VPN)

\end{itemize}


\subsection{Papers / Sites}
\label{\detokenize{06-AdvancedShapeAndTexture:papers-sites}}\begin{itemize}
\item {} 
\sphinxAtStartPar
Thickness

\item {} 
\sphinxAtStartPar
\sphinxhref{http://scikit-image.org/docs/dev/auto\_examples/features\_detection/plot\_glcm.html}{1} Hildebrand, T., \& Ruegsegger, P. (1997). A new method for the model\sphinxhyphen{}independent assessment of thickness in three\sphinxhyphen{}dimensional images. Journal of Microscopy, 185(1), 67\textendash{}75. doi:10.1046/j.1365\sphinxhyphen{}2818.1997.1340694.x

\item {} 
\sphinxAtStartPar
Curvature

\item {} 
\sphinxAtStartPar
\sphinxurl{http://mathworld.wolfram.com/MeanCurvature.html}

\item {} 
\sphinxAtStartPar
{[}2{]} “Computation of Surface Curvature from Range Images Using Geometrically Intrinsic Weights”*, T. Kurita and P. Boulanger, 1992.

\item {} 
\sphinxAtStartPar
\sphinxurl{http://radiomics.io}

\end{itemize}


\section{Outline}
\label{\detokenize{06-AdvancedShapeAndTexture:outline}}\begin{itemize}
\item {} 
\sphinxAtStartPar
Motivation (Why and How?)

\item {} 
\sphinxAtStartPar
What are Distance Maps?

\item {} 
\sphinxAtStartPar
What are thickness maps?

\end{itemize}


\bigskip\hrule\bigskip

\begin{itemize}
\item {} 
\sphinxAtStartPar
Characteristic Shapes

\item {} 
\sphinxAtStartPar
Texture Analysis

\end{itemize}


\section{Learning Objectives}
\label{\detokenize{06-AdvancedShapeAndTexture:learning-objectives}}

\subsection{Motivation (Why and How?)}
\label{\detokenize{06-AdvancedShapeAndTexture:motivation-why-and-how}}

\subsubsection{Objects}
\label{\detokenize{06-AdvancedShapeAndTexture:objects}}\begin{itemize}
\item {} 
\sphinxAtStartPar
How can we measure sizes in complicated objects?

\item {} 
\sphinxAtStartPar
How do we measure sizes relavant for diffusion or other local processes?

\item {} 
\sphinxAtStartPar
How do we investigate surfaces in more detail and their shape?

\item {} 
\sphinxAtStartPar
How can we compare shape of complex objects when they grow?

\item {} 
\sphinxAtStartPar
Are there characteristic shape metrics?

\end{itemize}


\bigskip\hrule\bigskip



\subsubsection{Patterns}
\label{\detokenize{06-AdvancedShapeAndTexture:patterns}}\begin{itemize}
\item {} 
\sphinxAtStartPar
How to we quantify patterns inside images?

\item {} 
\sphinxAtStartPar
How can compare between different patterns?

\item {} 
\sphinxAtStartPar
How can we quantify as radiologists say \sphinxstyleemphasis{looking evil}?

\end{itemize}


\section{Let’s load some modules for the notebook}
\label{\detokenize{06-AdvancedShapeAndTexture:let-s-load-some-modules-for-the-notebook}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{os}
\PYG{k+kn}{from} \PYG{n+nn}{tqdm} \PYG{k+kn}{import} \PYG{n}{tqdm}

\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{pandas} \PYG{k}{as} \PYG{n+nn}{pd}
\PYG{k+kn}{import} \PYG{n+nn}{matplotlib}\PYG{n+nn}{.}\PYG{n+nn}{pyplot} \PYG{k}{as} \PYG{n+nn}{plt}
\PYG{k+kn}{import} \PYG{n+nn}{seaborn} \PYG{k}{as} \PYG{n+nn}{sns}


\PYG{k+kn}{from} \PYG{n+nn}{scipy} \PYG{k+kn}{import} \PYG{n}{ndimage}
\PYG{k+kn}{from} \PYG{n+nn}{matplotlib}\PYG{n+nn}{.}\PYG{n+nn}{animation} \PYG{k+kn}{import} \PYG{n}{FuncAnimation}
\PYG{k+kn}{from} \PYG{n+nn}{IPython}\PYG{n+nn}{.}\PYG{n+nn}{display} \PYG{k+kn}{import} \PYG{n}{HTML}

\PYG{k+kn}{from} \PYG{n+nn}{scipy}\PYG{n+nn}{.}\PYG{n+nn}{ndimage} \PYG{k+kn}{import} \PYG{n}{distance\PYGZus{}transform\PYGZus{}edt}

\PYG{k+kn}{import} \PYG{n+nn}{skimage}\PYG{n+nn}{.}\PYG{n+nn}{transform}
\PYG{k+kn}{from} \PYG{n+nn}{skimage}\PYG{n+nn}{.}\PYG{n+nn}{feature}\PYG{n+nn}{.}\PYG{n+nn}{texture} \PYG{k+kn}{import} \PYG{n}{greycomatrix}
\PYG{k+kn}{from} \PYG{n+nn}{skimage}\PYG{n+nn}{.}\PYG{n+nn}{util}            \PYG{k+kn}{import} \PYG{n}{montage} \PYG{k}{as} \PYG{n}{montage2d}
\PYG{k+kn}{from} \PYG{n+nn}{skimage}\PYG{n+nn}{.}\PYG{n+nn}{morphology}      \PYG{k+kn}{import} \PYG{n}{binary\PYGZus{}opening}\PYG{p}{,} \PYG{n}{binary\PYGZus{}closing}\PYG{p}{,} \PYG{n}{disk}
\PYG{k+kn}{from} \PYG{n+nn}{skimage}\PYG{n+nn}{.}\PYG{n+nn}{io}              \PYG{k+kn}{import} \PYG{n}{imread}
\PYG{k+kn}{from} \PYG{n+nn}{skimage}\PYG{n+nn}{.}\PYG{n+nn}{filters}         \PYG{k+kn}{import} \PYG{n}{gaussian}
\PYG{k+kn}{from} \PYG{n+nn}{skimage}                 \PYG{k+kn}{import} \PYG{n}{measure}
\PYG{k+kn}{from} \PYG{n+nn}{skimage}\PYG{n+nn}{.}\PYG{n+nn}{color}           \PYG{k+kn}{import} \PYG{n}{label2rgb}

\PYG{k+kn}{from} \PYG{n+nn}{mpl\PYGZus{}toolkits}\PYG{n+nn}{.}\PYG{n+nn}{mplot3d}\PYG{n+nn}{.}\PYG{n+nn}{art3d} \PYG{k+kn}{import} \PYG{n}{Poly3DCollection}

\PYG{k+kn}{import} \PYG{n+nn}{plotly}\PYG{n+nn}{.}\PYG{n+nn}{offline} \PYG{k}{as} \PYG{n+nn}{py}
\PYG{k+kn}{import} \PYG{n+nn}{plotly}\PYG{n+nn}{.}\PYG{n+nn}{graph\PYGZus{}objs} \PYG{k}{as} \PYG{n+nn}{go}
\PYG{k+kn}{import} \PYG{n+nn}{plotly}\PYG{n+nn}{.}\PYG{n+nn}{figure\PYGZus{}factory} \PYG{k}{as} \PYG{n+nn}{FF}

\PYG{k+kn}{import} \PYG{n+nn}{ipyvolume} \PYG{k}{as} \PYG{n+nn}{p3}

\PYG{o}{\PYGZpc{}}\PYG{k}{matplotlib} inline

\PYG{n}{plt}\PYG{o}{.}\PYG{n}{rcParams}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{figure.figsize}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]} \PYG{o}{=} \PYG{p}{(}\PYG{l+m+mi}{8}\PYG{p}{,} \PYG{l+m+mi}{8}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{rcParams}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{figure.dpi}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]} \PYG{o}{=} \PYG{l+m+mi}{150}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{rcParams}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{font.size}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]} \PYG{o}{=} \PYG{l+m+mi}{14}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{rcParams}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{font.family}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sans\PYGZhy{}serif}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{rcParams}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{font.sans\PYGZhy{}serif}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{DejaVu Sans}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{style}\PYG{o}{.}\PYG{n}{use}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{default}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{sns}\PYG{o}{.}\PYG{n}{set\PYGZus{}style}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{whitegrid}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{axes.grid}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{k+kc}{False}\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gt}{\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}}
\PYG{n+ne}{ModuleNotFoundError}\PYG{g+gWhitespace}{                       }Traceback (most recent call last)
\PYG{o}{\PYGZlt{}}\PYG{n}{ipython}\PYG{o}{\PYGZhy{}}\PYG{n+nb}{input}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{o}{\PYGZhy{}}\PYG{n}{d2b2621de869}\PYG{o}{\PYGZgt{}} \PYG{o+ow}{in} \PYG{o}{\PYGZlt{}}\PYG{n}{module}\PYG{o}{\PYGZgt{}}
\PYG{g+gWhitespace}{      }\PYG{l+m+mi}{3} 
\PYG{g+gWhitespace}{      }\PYG{l+m+mi}{4} \PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{n+ne}{\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZgt{} }\PYG{l+m+mi}{5} \PYG{k+kn}{import} \PYG{n+nn}{pandas} \PYG{k}{as} \PYG{n+nn}{pd}
\PYG{g+gWhitespace}{      }\PYG{l+m+mi}{6} \PYG{k+kn}{import} \PYG{n+nn}{matplotlib}\PYG{n+nn}{.}\PYG{n+nn}{pyplot} \PYG{k}{as} \PYG{n+nn}{plt}
\PYG{g+gWhitespace}{      }\PYG{l+m+mi}{7} \PYG{k+kn}{import} \PYG{n+nn}{seaborn} \PYG{k}{as} \PYG{n+nn}{sns}

\PYG{n+ne}{ModuleNotFoundError}: No module named \PYGZsq{}pandas\PYGZsq{}
\end{sphinxVerbatim}


\chapter{Distance Maps: What are they?}
\label{\detokenize{06-AdvancedShapeAndTexture:distance-maps-what-are-they}}
\sphinxAtStartPar
A distance map is:
\begin{itemize}
\item {} 
\sphinxAtStartPar
A map (or image) of distances.

\item {} 
\sphinxAtStartPar
Each point in the map is the distance that point is from a given feature of interest (surface of an object, ROI, center of object, etc)

\item {} 
\sphinxAtStartPar
Different metrics are used:
\begin{itemize}
\item {} 
\sphinxAtStartPar
Euclidean (and approximations)

\item {} 
\sphinxAtStartPar
City block (4\sphinxhyphen{}connected)

\item {} 
\sphinxAtStartPar
Checkerboard (8\sphinxhyphen{}connected)

\end{itemize}

\end{itemize}


\section{What does a distance map look like?}
\label{\detokenize{06-AdvancedShapeAndTexture:what-does-a-distance-map-look-like}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{generate\PYGZus{}dot\PYGZus{}image}\PYG{p}{(}\PYG{n}{size}\PYG{o}{=}\PYG{l+m+mi}{100}\PYG{p}{,} \PYG{n}{rad\PYGZus{}a}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{rad\PYGZus{}b}\PYG{o}{=}\PYG{k+kc}{None}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{xx}\PYG{p}{,} \PYG{n}{yy} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{meshgrid}\PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{linspace}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{size}\PYG{p}{)}\PYG{p}{,} \PYG{n}{np}\PYG{o}{.}\PYG{n}{linspace}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{size}\PYG{p}{)}\PYG{p}{)}
    \PYG{k}{if} \PYG{n}{rad\PYGZus{}b} \PYG{o+ow}{is} \PYG{k+kc}{None}\PYG{p}{:}
        \PYG{n}{rad\PYGZus{}b} \PYG{o}{=} \PYG{n}{rad\PYGZus{}a}
    \PYG{k}{return} \PYG{n}{np}\PYG{o}{.}\PYG{n}{sqrt}\PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{square}\PYG{p}{(}\PYG{n}{xx}\PYG{o}{/}\PYG{n}{rad\PYGZus{}a}\PYG{p}{)}\PYG{o}{+}\PYG{n}{np}\PYG{o}{.}\PYG{n}{square}\PYG{p}{(}\PYG{n}{yy}\PYG{o}{/}\PYG{n}{rad\PYGZus{}b}\PYG{p}{)}\PYG{p}{)} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{l+m+mf}{1.0}


\PYG{n}{img\PYGZus{}bw} \PYG{o}{=} \PYG{n}{generate\PYGZus{}dot\PYGZus{}image}\PYG{p}{(}\PYG{l+m+mi}{10}\PYG{p}{,} \PYG{l+m+mf}{0.8}\PYG{p}{)}

\PYG{n}{sns}\PYG{o}{.}\PYG{n}{heatmap}\PYG{p}{(}\PYG{n}{img\PYGZus{}bw}\PYG{p}{,} \PYG{n}{annot}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,} \PYG{n}{fmt}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{d}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{gray}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{gca}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{set\PYGZus{}aspect}\PYG{p}{(}\PYG{n}{aspect}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{equal}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{06-AdvancedShapeAndTexture_10_0}.png}


\subsection{The Euclidean distance map}
\label{\detokenize{06-AdvancedShapeAndTexture:the-euclidean-distance-map}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{dmap} \PYG{o}{=} \PYG{n}{ndimage}\PYG{o}{.}\PYG{n}{distance\PYGZus{}transform\PYGZus{}edt}\PYG{p}{(}\PYG{n}{img\PYGZus{}bw}\PYG{p}{)}
\PYG{n}{sns}\PYG{o}{.}\PYG{n}{heatmap}\PYG{p}{(}\PYG{n}{dmap}\PYG{p}{,} \PYG{n}{annot}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,}
            \PYG{n}{fmt}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{2.1f}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{nipy\PYGZus{}spectral}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{gca}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{set\PYGZus{}aspect}\PYG{p}{(}\PYG{n}{aspect}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{equal}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{06-AdvancedShapeAndTexture_12_0}.png}


\subsection{The distance map depends on the neighborhood}
\label{\detokenize{06-AdvancedShapeAndTexture:the-distance-map-depends-on-the-neighborhood}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{timeit} \PYG{k+kn}{import} \PYG{n}{timeit}
\PYG{n}{dmap\PYGZus{}list} \PYG{o}{=} \PYG{p}{[}\PYG{n}{ndimage}\PYG{o}{.}\PYG{n}{distance\PYGZus{}transform\PYGZus{}edt}\PYG{p}{,}
             \PYG{n}{ndimage}\PYG{o}{.}\PYG{n}{distance\PYGZus{}transform\PYGZus{}bf}\PYG{p}{,} \PYG{n}{ndimage}\PYG{o}{.}\PYG{n}{distance\PYGZus{}transform\PYGZus{}cdt}\PYG{p}{]}
\PYG{n}{fig}\PYG{p}{,} \PYG{n}{m\PYGZus{}axs} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{dmap\PYGZus{}list}\PYG{p}{)}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{20}\PYG{p}{,} \PYG{l+m+mi}{6}\PYG{p}{)}\PYG{p}{)}
\PYG{k}{for} \PYG{n}{dmap\PYGZus{}func}\PYG{p}{,} \PYG{n}{c\PYGZus{}ax} \PYG{o+ow}{in} \PYG{n+nb}{zip}\PYG{p}{(}\PYG{n}{dmap\PYGZus{}list}\PYG{p}{,} \PYG{n}{m\PYGZus{}axs}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{ms\PYGZus{}time} \PYG{o}{=} \PYG{n}{timeit}\PYG{p}{(}\PYG{k}{lambda}\PYG{p}{:} \PYG{n}{dmap\PYGZus{}func}\PYG{p}{(}\PYG{n}{img\PYGZus{}bw}\PYG{p}{)}\PYG{p}{,} \PYG{n}{number}\PYG{o}{=}\PYG{l+m+mi}{10000}\PYG{p}{)}\PYG{o}{/}\PYG{l+m+mi}{10000}\PYG{o}{*}\PYG{l+m+mf}{1e6}
    \PYG{n}{dmap} \PYG{o}{=} \PYG{n}{dmap\PYGZus{}func}\PYG{p}{(}\PYG{n}{img\PYGZus{}bw}\PYG{p}{)}
    \PYG{n}{sns}\PYG{o}{.}\PYG{n}{heatmap}\PYG{p}{(}\PYG{n}{dmap}\PYG{p}{,} \PYG{n}{annot}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,}
                \PYG{n}{fmt}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{2.1f}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{nipy\PYGZus{}spectral}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{ax}\PYG{o}{=}\PYG{n}{c\PYGZus{}ax}\PYG{p}{,} \PYG{n}{cbar}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}
    \PYG{n}{c\PYGZus{}ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+si}{\PYGZob{}\PYGZcb{}}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s+si}{\PYGZob{}\PYGZcb{}}\PYG{l+s+s1}{ \PYGZhy{} }\PYG{l+s+si}{\PYGZob{}\PYGZcb{}}\PYG{l+s+s1}{ us}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{dmap\PYGZus{}func}\PYG{o}{.}\PYG{n+nv+vm}{\PYGZus{}\PYGZus{}doc\PYGZus{}\PYGZus{}}\PYG{o}{.}\PYG{n}{split}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{strip}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,}
                                           \PYG{n}{dmap\PYGZus{}func}\PYG{o}{.}\PYG{n+nv+vm}{\PYGZus{}\PYGZus{}name\PYGZus{}\PYGZus{}}\PYG{p}{,}
                                           \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+si}{\PYGZpc{}2.2f}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{\PYGZpc{}} \PYG{n}{ms\PYGZus{}time}\PYG{p}{)}\PYG{p}{)}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{06-AdvancedShapeAndTexture_14_0}.png}


\subsection{Distance maps in python}
\label{\detokenize{06-AdvancedShapeAndTexture:distance-maps-in-python}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{help}\PYG{p}{(}\PYG{n}{ndimage}\PYG{o}{.}\PYG{n}{distance\PYGZus{}transform\PYGZus{}edt}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
Help on function distance\PYGZus{}transform\PYGZus{}edt in module scipy.ndimage.morphology:

distance\PYGZus{}transform\PYGZus{}edt(input, sampling=None, return\PYGZus{}distances=True, return\PYGZus{}indices=False, distances=None, indices=None)
    Exact Euclidean distance transform.
    
    In addition to the distance transform, the feature transform can
    be calculated. In this case the index of the closest background
    element is returned along the first axis of the result.
    
    Parameters
    \PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
    input : array\PYGZus{}like
        Input data to transform. Can be any type but will be converted
        into binary: 1 wherever input equates to True, 0 elsewhere.
    sampling : float or int, or sequence of same, optional
        Spacing of elements along each dimension. If a sequence, must be of
        length equal to the input rank; if a single number, this is used for
        all axes. If not specified, a grid spacing of unity is implied.
    return\PYGZus{}distances : bool, optional
        Whether to return distance matrix. At least one of
        return\PYGZus{}distances/return\PYGZus{}indices must be True. Default is True.
    return\PYGZus{}indices : bool, optional
        Whether to return indices matrix. Default is False.
    distances : ndarray, optional
        Used for output of distance array, must be of type float64.
    indices : ndarray, optional
        Used for output of indices, must be of type int32.
    
    Returns
    \PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
    distance\PYGZus{}transform\PYGZus{}edt : ndarray or list of ndarrays
        Either distance matrix, index matrix, or a list of the two,
        depending on `return\PYGZus{}x` flags and `distance` and `indices`
        input parameters.
    
    Notes
    \PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
    The Euclidean distance transform gives values of the Euclidean
    distance::
    
                    n
      y\PYGZus{}i = sqrt(sum (x[i]\PYGZhy{}b[i])**2)
                    i
    
    where b[i] is the background point (value 0) with the smallest
    Euclidean distance to input points x[i], and n is the
    number of dimensions.
    
    Examples
    \PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
    \PYGZgt{}\PYGZgt{}\PYGZgt{} from scipy import ndimage
    \PYGZgt{}\PYGZgt{}\PYGZgt{} a = np.array(([0,1,1,1,1],
    ...               [0,0,1,1,1],
    ...               [0,1,1,1,1],
    ...               [0,1,1,1,0],
    ...               [0,1,1,0,0]))
    \PYGZgt{}\PYGZgt{}\PYGZgt{} ndimage.distance\PYGZus{}transform\PYGZus{}edt(a)
    array([[ 0.    ,  1.    ,  1.4142,  2.2361,  3.    ],
           [ 0.    ,  0.    ,  1.    ,  2.    ,  2.    ],
           [ 0.    ,  1.    ,  1.4142,  1.4142,  1.    ],
           [ 0.    ,  1.    ,  1.4142,  1.    ,  0.    ],
           [ 0.    ,  1.    ,  1.    ,  0.    ,  0.    ]])
    
    With a sampling of 2 units along x, 1 along y:
    
    \PYGZgt{}\PYGZgt{}\PYGZgt{} ndimage.distance\PYGZus{}transform\PYGZus{}edt(a, sampling=[2,1])
    array([[ 0.    ,  1.    ,  2.    ,  2.8284,  3.6056],
           [ 0.    ,  0.    ,  1.    ,  2.    ,  3.    ],
           [ 0.    ,  1.    ,  2.    ,  2.2361,  2.    ],
           [ 0.    ,  1.    ,  2.    ,  1.    ,  0.    ],
           [ 0.    ,  1.    ,  1.    ,  0.    ,  0.    ]])
    
    Asking for indices as well:
    
    \PYGZgt{}\PYGZgt{}\PYGZgt{} edt, inds = ndimage.distance\PYGZus{}transform\PYGZus{}edt(a, return\PYGZus{}indices=True)
    \PYGZgt{}\PYGZgt{}\PYGZgt{} inds
    array([[[0, 0, 1, 1, 3],
            [1, 1, 1, 1, 3],
            [2, 2, 1, 3, 3],
            [3, 3, 4, 4, 3],
            [4, 4, 4, 4, 4]],
           [[0, 0, 1, 1, 4],
            [0, 1, 1, 1, 4],
            [0, 0, 1, 4, 4],
            [0, 0, 3, 3, 4],
            [0, 0, 3, 3, 4]]])
    
    With arrays provided for inplace outputs:
    
    \PYGZgt{}\PYGZgt{}\PYGZgt{} indices = np.zeros(((np.ndim(a),) + a.shape), dtype=np.int32)
    \PYGZgt{}\PYGZgt{}\PYGZgt{} ndimage.distance\PYGZus{}transform\PYGZus{}edt(a, return\PYGZus{}indices=True, indices=indices)
    array([[ 0.    ,  1.    ,  1.4142,  2.2361,  3.    ],
           [ 0.    ,  0.    ,  1.    ,  2.    ,  2.    ],
           [ 0.    ,  1.    ,  1.4142,  1.4142,  1.    ],
           [ 0.    ,  1.    ,  1.4142,  1.    ,  0.    ],
           [ 0.    ,  1.    ,  1.    ,  0.    ,  0.    ]])
    \PYGZgt{}\PYGZgt{}\PYGZgt{} indices
    array([[[0, 0, 1, 1, 3],
            [1, 1, 1, 1, 3],
            [2, 2, 1, 3, 3],
            [3, 3, 4, 4, 3],
            [4, 4, 4, 4, 4]],
           [[0, 0, 1, 1, 4],
            [0, 1, 1, 1, 4],
            [0, 0, 1, 4, 4],
            [0, 0, 3, 3, 4],
            [0, 0, 3, 3, 4]]])
\end{sphinxVerbatim}


\section{Why does speed matter?}
\label{\detokenize{06-AdvancedShapeAndTexture:why-does-speed-matter}}
\sphinxAtStartPar
As for the question why speed matters,
\begin{itemize}
\item {} 
\sphinxAtStartPar
for small images clearly the more efficient approaches don’t make much of a difference,

\item {} 
\sphinxAtStartPar
how about data from a Synchrotron measurement 2160x2560x2560 (SLS)?

\item {} 
\sphinxAtStartPar
even worse when we have series of large volumes…

\end{itemize}

\sphinxAtStartPar
Now, time becomes much more important


\subsection{Extrapolated execution time}
\label{\detokenize{06-AdvancedShapeAndTexture:extrapolated-execution-time}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{img\PYGZus{}bw} \PYG{o}{=} \PYG{n}{generate\PYGZus{}dot\PYGZus{}image}\PYG{p}{(}\PYG{l+m+mi}{512}\PYG{p}{,} \PYG{l+m+mf}{0.75}\PYG{p}{)}
\PYG{n}{sls\PYGZus{}fact} \PYG{o}{=} \PYG{l+m+mi}{2160}\PYG{o}{*}\PYG{l+m+mi}{2560}\PYG{o}{*}\PYG{l+m+mi}{2560}\PYG{o}{/}\PYG{n}{np}\PYG{o}{.}\PYG{n}{prod}\PYG{p}{(}\PYG{n}{img\PYGZus{}bw}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{)}
\PYG{n}{dmap\PYGZus{}list} \PYG{o}{=} \PYG{p}{[}\PYG{n}{ndimage}\PYG{o}{.}\PYG{n}{distance\PYGZus{}transform\PYGZus{}edt}\PYG{p}{,}
             \PYG{n}{ndimage}\PYG{o}{.}\PYG{n}{distance\PYGZus{}transform\PYGZus{}bf}\PYG{p}{,} \PYG{n}{ndimage}\PYG{o}{.}\PYG{n}{distance\PYGZus{}transform\PYGZus{}cdt}\PYG{p}{]}
\PYG{n}{fig}\PYG{p}{,} \PYG{n}{m\PYGZus{}axs} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{dmap\PYGZus{}list}\PYG{p}{)}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{20}\PYG{p}{,} \PYG{l+m+mi}{6}\PYG{p}{)}\PYG{p}{)}
\PYG{k}{for} \PYG{n}{dmap\PYGZus{}func}\PYG{p}{,} \PYG{n}{c\PYGZus{}ax} \PYG{o+ow}{in} \PYG{n+nb}{zip}\PYG{p}{(}\PYG{n}{dmap\PYGZus{}list}\PYG{p}{,} \PYG{n}{m\PYGZus{}axs}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{ms\PYGZus{}time} \PYG{o}{=} \PYG{n}{timeit}\PYG{p}{(}\PYG{k}{lambda}\PYG{p}{:} \PYG{n}{dmap\PYGZus{}func}\PYG{p}{(}\PYG{n}{img\PYGZus{}bw}\PYG{p}{)}\PYG{p}{,} \PYG{n}{number}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{o}{*}\PYG{l+m+mf}{1e3}
    \PYG{n}{dmap} \PYG{o}{=} \PYG{n}{dmap\PYGZus{}func}\PYG{p}{(}\PYG{n}{img\PYGZus{}bw}\PYG{p}{)}
    \PYG{n}{c\PYGZus{}ax}\PYG{o}{.}\PYG{n}{matshow}\PYG{p}{(}\PYG{n}{dmap}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{nipy\PYGZus{}spectral}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{c\PYGZus{}ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+si}{\PYGZob{}0\PYGZcb{}}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s+si}{\PYGZob{}1\PYGZcb{}}\PYG{l+s+s1}{ : }\PYG{l+s+si}{\PYGZob{}2:0.2f\PYGZcb{}}\PYG{l+s+s1}{ ms}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s+s1}{ For SLS scan }\PYG{l+s+si}{\PYGZob{}3:0.2f\PYGZcb{}}\PYG{l+s+s1}{ h}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{dmap\PYGZus{}func}\PYG{o}{.}\PYG{n+nv+vm}{\PYGZus{}\PYGZus{}doc\PYGZus{}\PYGZus{}}\PYG{o}{.}\PYG{n}{split}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{strip}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,}
                                                               \PYG{n}{dmap\PYGZus{}func}\PYG{o}{.}\PYG{n+nv+vm}{\PYGZus{}\PYGZus{}name\PYGZus{}\PYGZus{}}\PYG{p}{,}
                                                               \PYG{n}{ms\PYGZus{}time}\PYG{p}{,}
                                                               \PYG{p}{(}\PYG{n}{ms\PYGZus{}time}\PYG{o}{*}\PYG{n}{sls\PYGZus{}fact}\PYG{o}{/}\PYG{l+m+mi}{3600}\PYG{o}{/}\PYG{l+m+mf}{1e3}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{06-AdvancedShapeAndTexture_19_0}.png}


\section{Distance map \sphinxhyphen{} Definition}
\label{\detokenize{06-AdvancedShapeAndTexture:distance-map-definition}}
\sphinxAtStartPar
If we start with an image as a collection of points divided into two categories
\begin{itemize}
\item {} 
\sphinxAtStartPar
\(Im(x,y)=\) \{Foreground, Background\}

\item {} 
\sphinxAtStartPar
We can define a distance map operator (\(dist\)) that transforms the image into a distance map

\end{itemize}
\begin{equation*}
\begin{split} dist(\vec{x}) = \textrm{min}(||\vec{x}-\vec{y}|| \forall \vec{y} \in \textrm{Background}) \end{split}
\end{equation*}
\sphinxAtStartPar
We will use Euclidean distance \(||\vec{x}-\vec{y}||\) for this class but there are other metrics which make sense when dealing with other types of data like Manhattan/City\sphinxhyphen{}block or weighted metrics.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{simple\PYGZus{}distance\PYGZus{}iteration}\PYG{p}{(}\PYG{n}{last\PYGZus{}img}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{cur\PYGZus{}img} \PYG{o}{=} \PYG{n}{last\PYGZus{}img}\PYG{o}{.}\PYG{n}{copy}\PYG{p}{(}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{x} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{last\PYGZus{}img}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{:}
        \PYG{k}{for} \PYG{n}{y} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{last\PYGZus{}img}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{:}
            \PYG{k}{if} \PYG{n}{last\PYGZus{}img}\PYG{p}{[}\PYG{n}{x}\PYG{p}{,} \PYG{n}{y}\PYG{p}{]} \PYG{o}{\PYGZgt{}}\PYG{o}{=} \PYG{l+m+mi}{0}\PYG{p}{:}
                \PYG{n}{i\PYGZus{}xy} \PYG{o}{=} \PYG{n}{last\PYGZus{}img}\PYG{p}{[}\PYG{n}{x}\PYG{p}{,} \PYG{n}{y}\PYG{p}{]}
                \PYG{k}{for} \PYG{n}{xp} \PYG{o+ow}{in} \PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{:}
                    \PYG{k}{if} \PYG{p}{(}\PYG{n}{x}\PYG{o}{+}\PYG{n}{xp} \PYG{o}{\PYGZlt{}} \PYG{n}{last\PYGZus{}img}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)} \PYG{o+ow}{and} \PYG{p}{(}\PYG{n}{x}\PYG{o}{+}\PYG{n}{xp} \PYG{o}{\PYGZgt{}}\PYG{o}{=} \PYG{l+m+mi}{0}\PYG{p}{)}\PYG{p}{:}
                        \PYG{k}{for} \PYG{n}{yp} \PYG{o+ow}{in} \PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{:}
                            \PYG{k}{if} \PYG{p}{(}\PYG{n}{y}\PYG{o}{+}\PYG{n}{yp} \PYG{o}{\PYGZlt{}} \PYG{n}{last\PYGZus{}img}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)} \PYG{o+ow}{and} \PYG{p}{(}\PYG{n}{y}\PYG{o}{+}\PYG{n}{yp} \PYG{o}{\PYGZgt{}}\PYG{o}{=} \PYG{l+m+mi}{0}\PYG{p}{)}\PYG{p}{:}
                                \PYG{n}{p\PYGZus{}dist} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{sqrt}\PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{square}\PYG{p}{(}\PYG{n}{xp}\PYG{p}{)}\PYG{o}{+}\PYG{n}{np}\PYG{o}{.}\PYG{n}{square}\PYG{p}{(}\PYG{n}{yp}\PYG{p}{)}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{} Distance metric}
                                \PYG{k}{if} \PYG{n}{cur\PYGZus{}img}\PYG{p}{[}\PYG{n}{x}\PYG{o}{+}\PYG{n}{xp}\PYG{p}{,} \PYG{n}{y}\PYG{o}{+}\PYG{n}{yp}\PYG{p}{]} \PYG{o}{\PYGZgt{}} \PYG{p}{(}\PYG{n}{last\PYGZus{}img}\PYG{p}{[}\PYG{n}{x}\PYG{p}{,} \PYG{n}{y}\PYG{p}{]}\PYG{o}{+}\PYG{n}{p\PYGZus{}dist}\PYG{p}{)}\PYG{p}{:}
                                    \PYG{n}{cur\PYGZus{}img}\PYG{p}{[}\PYG{n}{x}\PYG{o}{+}\PYG{n}{xp}\PYG{p}{,} \PYG{n}{y}\PYG{o}{+}\PYG{n}{yp}\PYG{p}{]} \PYG{o}{=} \PYG{n}{last\PYGZus{}img}\PYG{p}{[}\PYG{n}{x}\PYG{p}{,} \PYG{n}{y}\PYG{p}{]}\PYG{o}{+}\PYG{n}{p\PYGZus{}dist}
    \PYG{k}{return} \PYG{n}{cur\PYGZus{}img}
\end{sphinxVerbatim}


\subsection{A test image for distance transform}
\label{\detokenize{06-AdvancedShapeAndTexture:a-test-image-for-distance-transform}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{fig}\PYG{p}{,} \PYG{n}{ax}\PYG{o}{=}\PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{10}\PYG{p}{,}\PYG{l+m+mi}{8}\PYG{p}{)}\PYG{p}{,} \PYG{n}{dpi}\PYG{o}{=}\PYG{l+m+mi}{100}\PYG{p}{)}
\PYG{n}{img\PYGZus{}bw} \PYG{o}{=} \PYG{n}{generate\PYGZus{}dot\PYGZus{}image}\PYG{p}{(}\PYG{l+m+mi}{10}\PYG{p}{,} \PYG{l+m+mf}{1.0}\PYG{p}{)}
\PYG{n}{sns}\PYG{o}{.}\PYG{n}{heatmap}\PYG{p}{(}\PYG{n}{img\PYGZus{}bw}\PYG{p}{,} \PYG{n}{ax}\PYG{o}{=}\PYG{n}{ax}\PYG{p}{,} \PYG{n}{annot}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,}
            \PYG{n}{fmt}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{d}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{gray}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}aspect}\PYG{p}{(}\PYG{n}{aspect}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{equal}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{06-AdvancedShapeAndTexture_23_0}.png}


\subsection{Animating the iterations}
\label{\detokenize{06-AdvancedShapeAndTexture:animating-the-iterations}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{fig}\PYG{p}{,} \PYG{n}{c\PYGZus{}ax} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,} \PYG{l+m+mi}{5}\PYG{p}{)}\PYG{p}{,} \PYG{n}{dpi}\PYG{o}{=}\PYG{l+m+mi}{100}\PYG{p}{)}
\PYG{n}{img\PYGZus{}base} \PYG{o}{=} \PYG{p}{(}\PYG{n}{img\PYGZus{}bw}\PYG{o}{*}\PYG{l+m+mi}{255}\PYG{p}{)}\PYG{o}{.}\PYG{n}{astype}\PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{float32}\PYG{p}{)}
\PYG{n}{img\PYGZus{}list} \PYG{o}{=} \PYG{p}{[}\PYG{n}{img\PYGZus{}base}\PYG{p}{]}
\PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{img\PYGZus{}base} \PYG{o}{=} \PYG{n}{simple\PYGZus{}distance\PYGZus{}iteration}\PYG{p}{(}\PYG{n}{img\PYGZus{}base}\PYG{p}{)}
    \PYG{n}{img\PYGZus{}list} \PYG{o}{+}\PYG{o}{=} \PYG{p}{[}\PYG{n}{img\PYGZus{}base}\PYG{p}{]}


\PYG{k}{def} \PYG{n+nf}{update\PYGZus{}frame}\PYG{p}{(}\PYG{n}{i}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{plt}\PYG{o}{.}\PYG{n}{cla}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{sns}\PYG{o}{.}\PYG{n}{heatmap}\PYG{p}{(}\PYG{n}{img\PYGZus{}list}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{,}\PYG{n}{annot}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,}
                \PYG{n}{fmt}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{2.1f}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{nipy\PYGZus{}spectral}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{ax}\PYG{o}{=}\PYG{n}{c\PYGZus{}ax}\PYG{p}{,} \PYG{n}{cbar}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{,}
                \PYG{n}{vmin}\PYG{o}{=}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{n}{vmax}\PYG{o}{=}\PYG{l+m+mi}{5}\PYG{p}{)}
    \PYG{n}{c\PYGZus{}ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Iteration \PYGZsh{}}\PYG{l+s+si}{\PYGZob{}\PYGZcb{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{i}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} write animation frames}
\PYG{n}{anim\PYGZus{}code} \PYG{o}{=} \PYG{n}{FuncAnimation}\PYG{p}{(}\PYG{n}{fig}\PYG{p}{,} \PYG{n}{update\PYGZus{}frame}\PYG{p}{,} \PYG{n}{frames}\PYG{o}{=}\PYG{l+m+mi}{5}\PYG{p}{,}\PYG{n}{interval}\PYG{o}{=}\PYG{l+m+mi}{1000}\PYG{p}{,}\PYG{n}{repeat\PYGZus{}delay}\PYG{o}{=}\PYG{l+m+mi}{2000}\PYG{p}{)}\PYG{o}{.}\PYG{n}{to\PYGZus{}html5\PYGZus{}video}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{close}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{all}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{HTML}\PYG{p}{(}\PYG{n}{anim\PYGZus{}code}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZlt{}IPython.core.display.HTML object\PYGZgt{}
\end{sphinxVerbatim}


\section{Distance Maps: Types}
\label{\detokenize{06-AdvancedShapeAndTexture:distance-maps-types}}
\sphinxAtStartPar
Using this rule a distance map can be made for the euclidean metric

\sphinxAtStartPar
Similarly the Manhattan or city block distance metric can be used where the distance is defined as
\$\( \sum_{i} |\vec{x}-\vec{y}|_i \)\$

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{simple\PYGZus{}distance\PYGZus{}iteration}\PYG{p}{(}\PYG{n}{last\PYGZus{}img}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{cur\PYGZus{}img} \PYG{o}{=} \PYG{n}{last\PYGZus{}img}\PYG{o}{.}\PYG{n}{copy}\PYG{p}{(}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{x} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{last\PYGZus{}img}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{:}
        \PYG{k}{for} \PYG{n}{y} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{last\PYGZus{}img}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{:}
            \PYG{k}{if} \PYG{n}{last\PYGZus{}img}\PYG{p}{[}\PYG{n}{x}\PYG{p}{,} \PYG{n}{y}\PYG{p}{]} \PYG{o}{\PYGZgt{}}\PYG{o}{=} \PYG{l+m+mi}{0}\PYG{p}{:}
                \PYG{n}{i\PYGZus{}xy} \PYG{o}{=} \PYG{n}{last\PYGZus{}img}\PYG{p}{[}\PYG{n}{x}\PYG{p}{,} \PYG{n}{y}\PYG{p}{]}
                \PYG{k}{for} \PYG{n}{xp} \PYG{o+ow}{in} \PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{:}
                    \PYG{k}{if} \PYG{p}{(}\PYG{n}{x}\PYG{o}{+}\PYG{n}{xp} \PYG{o}{\PYGZlt{}} \PYG{n}{last\PYGZus{}img}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)} \PYG{o+ow}{and} \PYG{p}{(}\PYG{n}{x}\PYG{o}{+}\PYG{n}{xp} \PYG{o}{\PYGZgt{}}\PYG{o}{=} \PYG{l+m+mi}{0}\PYG{p}{)}\PYG{p}{:}
                        \PYG{k}{for} \PYG{n}{yp} \PYG{o+ow}{in} \PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{:}
                            \PYG{k}{if} \PYG{p}{(}\PYG{n}{y}\PYG{o}{+}\PYG{n}{yp} \PYG{o}{\PYGZlt{}} \PYG{n}{last\PYGZus{}img}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)} \PYG{o+ow}{and} \PYG{p}{(}\PYG{n}{y}\PYG{o}{+}\PYG{n}{yp} \PYG{o}{\PYGZgt{}}\PYG{o}{=} \PYG{l+m+mi}{0}\PYG{p}{)}\PYG{p}{:}
                                \PYG{n}{p\PYGZus{}dist} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{abs}\PYG{p}{(}\PYG{n}{xp}\PYG{p}{)}\PYG{o}{+}\PYG{n}{np}\PYG{o}{.}\PYG{n}{abs}\PYG{p}{(}\PYG{n}{yp}\PYG{p}{)}     \PYG{c+c1}{\PYGZsh{} Distance metric}
                                \PYG{k}{if} \PYG{n}{cur\PYGZus{}img}\PYG{p}{[}\PYG{n}{x}\PYG{o}{+}\PYG{n}{xp}\PYG{p}{,} \PYG{n}{y}\PYG{o}{+}\PYG{n}{yp}\PYG{p}{]} \PYG{o}{\PYGZgt{}} \PYG{p}{(}\PYG{n}{last\PYGZus{}img}\PYG{p}{[}\PYG{n}{x}\PYG{p}{,} \PYG{n}{y}\PYG{p}{]}\PYG{o}{+}\PYG{n}{p\PYGZus{}dist}\PYG{p}{)}\PYG{p}{:}
                                    \PYG{n}{cur\PYGZus{}img}\PYG{p}{[}\PYG{n}{x}\PYG{o}{+}\PYG{n}{xp}\PYG{p}{,} \PYG{n}{y}\PYG{o}{+}\PYG{n}{yp}\PYG{p}{]} \PYG{o}{=} \PYG{n}{last\PYGZus{}img}\PYG{p}{[}\PYG{n}{x}\PYG{p}{,} \PYG{n}{y}\PYG{p}{]}\PYG{o}{+}\PYG{n}{p\PYGZus{}dist}
    \PYG{k}{return} \PYG{n}{cur\PYGZus{}img}
\end{sphinxVerbatim}


\subsection{Animating City\sphinxhyphen{}block distance}
\label{\detokenize{06-AdvancedShapeAndTexture:animating-city-block-distance}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{fig}\PYG{p}{,} \PYG{n}{c\PYGZus{}ax} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,} \PYG{l+m+mi}{5}\PYG{p}{)}\PYG{p}{,} \PYG{n}{dpi}\PYG{o}{=}\PYG{l+m+mi}{120}\PYG{p}{)}
\PYG{n}{img\PYGZus{}base} \PYG{o}{=} \PYG{p}{(}\PYG{n}{img\PYGZus{}bw}\PYG{o}{*}\PYG{l+m+mi}{255}\PYG{p}{)}\PYG{o}{.}\PYG{n}{astype}\PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{float32}\PYG{p}{)}
\PYG{n}{img\PYGZus{}list} \PYG{o}{=} \PYG{p}{[}\PYG{n}{img\PYGZus{}base}\PYG{p}{]}
\PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{img\PYGZus{}base} \PYG{o}{=} \PYG{n}{simple\PYGZus{}distance\PYGZus{}iteration}\PYG{p}{(}\PYG{n}{img\PYGZus{}base}\PYG{p}{)}
    \PYG{n}{img\PYGZus{}list} \PYG{o}{+}\PYG{o}{=} \PYG{p}{[}\PYG{n}{img\PYGZus{}base}\PYG{p}{]}


\PYG{k}{def} \PYG{n+nf}{update\PYGZus{}frame}\PYG{p}{(}\PYG{n}{i}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{plt}\PYG{o}{.}\PYG{n}{cla}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{sns}\PYG{o}{.}\PYG{n}{heatmap}\PYG{p}{(}\PYG{n}{img\PYGZus{}list}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{,} \PYG{n}{annot}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,} \PYG{n}{fmt}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{2.0f}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
                \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{nipy\PYGZus{}spectral}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{ax}\PYG{o}{=}\PYG{n}{c\PYGZus{}ax}\PYG{p}{,} \PYG{n}{cbar}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{,}
                \PYG{n}{vmin}\PYG{o}{=}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{n}{vmax}\PYG{o}{=}\PYG{l+m+mi}{5}\PYG{p}{)}
    \PYG{n}{c\PYGZus{}ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Iteration \PYGZsh{}}\PYG{l+s+si}{\PYGZob{}\PYGZcb{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{i}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{)}
    \PYG{n}{c\PYGZus{}ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}aspect}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}


\PYG{c+c1}{\PYGZsh{} write animation frames}
\PYG{n}{anim\PYGZus{}code} \PYG{o}{=} \PYG{n}{FuncAnimation}\PYG{p}{(}\PYG{n}{fig}\PYG{p}{,} \PYG{n}{update\PYGZus{}frame}\PYG{p}{,} \PYG{n}{frames}\PYG{o}{=}\PYG{l+m+mi}{5}\PYG{p}{,}
                          \PYG{n}{interval}\PYG{o}{=}\PYG{l+m+mi}{1000}\PYG{p}{,} \PYG{n}{repeat\PYGZus{}delay}\PYG{o}{=}\PYG{l+m+mi}{2000}\PYG{p}{)}\PYG{o}{.}\PYG{n}{to\PYGZus{}html5\PYGZus{}video}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{close}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{all}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{HTML}\PYG{p}{(}\PYG{n}{anim\PYGZus{}code}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZlt{}IPython.core.display.HTML object\PYGZgt{}
\end{sphinxVerbatim}


\section{Distance Maps: Precaution}
\label{\detokenize{06-AdvancedShapeAndTexture:distance-maps-precaution}}
\sphinxAtStartPar
The distance map is one of the crictical points where the resolution of the imaging system is important.
\begin{itemize}
\item {} 
\sphinxAtStartPar
We measure distances computationally in pixels or voxels

\item {} 
\sphinxAtStartPar
but for them to have a meaning physically they must be converted

\item {} 
\sphinxAtStartPar
Isotropic imaging (1 \(\mu\) m x 1\(\mu\) m x 1 \(\mu\) m) is \sphinxstylestrong{fine}

\end{itemize}


\bigskip\hrule\bigskip



\subsection{Anisotropic}
\label{\detokenize{06-AdvancedShapeAndTexture:anisotropic}}
\sphinxAtStartPar
Options to handle anisotropic voxels:
\begin{itemize}
\item {} 
\sphinxAtStartPar
as part of filtering, resample and convert to an isotropic scale.

\item {} 
\sphinxAtStartPar
custom distance map algorithms
\begin{itemize}
\item {} 
\sphinxAtStartPar
use the side\sphinxhyphen{}lengths of the voxels to calculate distance rather than assuming 1x1x1

\end{itemize}

\end{itemize}


\section{What does the Distance Maps show?}
\label{\detokenize{06-AdvancedShapeAndTexture:what-does-the-distance-maps-show}}
\sphinxAtStartPar
We can create 2 distance maps
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
Foreground \(\rightarrow\) Background

\end{enumerate}
\begin{itemize}
\item {} 
\sphinxAtStartPar
Information about the objects size and interior

\end{itemize}
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
Background \(\rightarrow\) Foreground

\end{enumerate}
\begin{itemize}
\item {} 
\sphinxAtStartPar
Information about the distance / space between objects

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{os}
\PYG{k+kn}{import} \PYG{n+nn}{seaborn} \PYG{k}{as} \PYG{n+nn}{sns}
\PYG{k+kn}{import} \PYG{n+nn}{matplotlib}\PYG{n+nn}{.}\PYG{n+nn}{pyplot} \PYG{k}{as} \PYG{n+nn}{plt}
\PYG{k+kn}{from} \PYG{n+nn}{scipy} \PYG{k+kn}{import} \PYG{n}{ndimage}
\PYG{k+kn}{import} \PYG{n+nn}{skimage}\PYG{n+nn}{.}\PYG{n+nn}{transform}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{o}{\PYGZpc{}}\PYG{k}{matplotlib} inline
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{generate\PYGZus{}dot\PYGZus{}image}\PYG{p}{(}\PYG{n}{size}\PYG{o}{=}\PYG{l+m+mi}{100}\PYG{p}{,} \PYG{n}{rad\PYGZus{}a}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{rad\PYGZus{}b}\PYG{o}{=}\PYG{k+kc}{None}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{xx}\PYG{p}{,} \PYG{n}{yy} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{meshgrid}\PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{linspace}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{size}\PYG{p}{)}\PYG{p}{,} \PYG{n}{np}\PYG{o}{.}\PYG{n}{linspace}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{size}\PYG{p}{)}\PYG{p}{)}
    \PYG{k}{if} \PYG{n}{rad\PYGZus{}b} \PYG{o+ow}{is} \PYG{k+kc}{None}\PYG{p}{:}
        \PYG{n}{rad\PYGZus{}b} \PYG{o}{=} \PYG{n}{rad\PYGZus{}a}
    \PYG{k}{return} \PYG{n}{np}\PYG{o}{.}\PYG{n}{sqrt}\PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{square}\PYG{p}{(}\PYG{n}{xx}\PYG{o}{/}\PYG{n}{rad\PYGZus{}a}\PYG{p}{)}\PYG{o}{+}\PYG{n}{np}\PYG{o}{.}\PYG{n}{square}\PYG{p}{(}\PYG{n}{yy}\PYG{o}{/}\PYG{n}{rad\PYGZus{}b}\PYG{p}{)}\PYG{p}{)} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{l+m+mf}{1.0}


\PYG{n}{img\PYGZus{}bw} \PYG{o}{=} \PYG{n}{generate\PYGZus{}dot\PYGZus{}image}\PYG{p}{(}\PYG{l+m+mi}{10}\PYG{p}{,} \PYG{l+m+mf}{0.5}\PYG{p}{,} \PYG{l+m+mf}{1.0}\PYG{p}{)}
\PYG{n}{fig}\PYG{p}{,} \PYG{p}{(}\PYG{n}{ax1}\PYG{p}{,} \PYG{n}{ax2}\PYG{p}{,} \PYG{n}{ax3}\PYG{p}{)} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{20}\PYG{p}{,} \PYG{l+m+mi}{6}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{sns}\PYG{o}{.}\PYG{n}{heatmap}\PYG{p}{(}\PYG{n}{img\PYGZus{}bw}\PYG{p}{,} \PYG{n}{annot}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,}
            \PYG{n}{fmt}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{d}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{gray}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{ax}\PYG{o}{=}\PYG{n}{ax1}\PYG{p}{)}\PYG{p}{,} \PYG{n}{ax1}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Bilevel image}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{n}{sns}\PYG{o}{.}\PYG{n}{heatmap}\PYG{p}{(}\PYG{n}{ndimage}\PYG{o}{.}\PYG{n}{distance\PYGZus{}transform\PYGZus{}edt}\PYG{p}{(}\PYG{n}{img\PYGZus{}bw}\PYG{p}{)}\PYG{p}{,}
            \PYG{n}{annot}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,}
            \PYG{n}{fmt}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{2.1f}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{nipy\PYGZus{}spectral}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{ax}\PYG{o}{=}\PYG{n}{ax2}\PYG{p}{)}\PYG{p}{,} \PYG{n}{ax2}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Foreground to Background}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{n}{sns}\PYG{o}{.}\PYG{n}{heatmap}\PYG{p}{(}\PYG{n}{ndimage}\PYG{o}{.}\PYG{n}{distance\PYGZus{}transform\PYGZus{}edt}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{o}{\PYGZhy{}}\PYG{n}{img\PYGZus{}bw}\PYG{p}{)}\PYG{p}{,}
            \PYG{n}{annot}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,}
            \PYG{n}{fmt}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{2.1f}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{nipy\PYGZus{}spectral}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{ax}\PYG{o}{=}\PYG{n}{ax3}\PYG{p}{)}\PYG{p}{,}\PYG{n}{ax3}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Background to Foreground}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{06-AdvancedShapeAndTexture_33_0}.png}


\section{Distance Map}
\label{\detokenize{06-AdvancedShapeAndTexture:distance-map}}
\sphinxAtStartPar
One of the most useful components of the distance map is that it is \sphinxstyleemphasis{relatively} insensitive to small changes in connectivity.
\begin{itemize}
\item {} 
\sphinxAtStartPar
Component Labeling would find radically different results for these two images

\item {} 
\sphinxAtStartPar
One has 4 small circles

\item {} 
\sphinxAtStartPar
One has 1 big blob

\end{itemize}


\subsection{Some code for the demo}
\label{\detokenize{06-AdvancedShapeAndTexture:some-code-for-the-demo}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{update\PYGZus{}frame}\PYG{p}{(}\PYG{n}{i}\PYG{p}{)}\PYG{p}{:}
    \PYG{p}{[}\PYG{n}{tax}\PYG{o}{.}\PYG{n}{cla}\PYG{p}{(}\PYG{p}{)} \PYG{k}{for} \PYG{n}{tax} \PYG{o+ow}{in} \PYG{n}{m\PYGZus{}axs}\PYG{o}{.}\PYG{n}{flatten}\PYG{p}{(}\PYG{p}{)}\PYG{p}{]}
    \PYG{p}{(}\PYG{p}{(}\PYG{n}{c\PYGZus{}ax}\PYG{p}{,} \PYG{n}{c\PYGZus{}hist}\PYG{p}{,} \PYG{n}{c\PYGZus{}dmean}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{n}{c\PYGZus{}lab}\PYG{p}{,} \PYG{n}{c\PYGZus{}labhist}\PYG{p}{,} \PYG{n}{c\PYGZus{}lmean}\PYG{p}{)}\PYG{p}{)} \PYG{o}{=} \PYG{n}{m\PYGZus{}axs}
    \PYG{n}{sns}\PYG{o}{.}\PYG{n}{heatmap}\PYG{p}{(}\PYG{n}{img\PYGZus{}list}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{,}
                \PYG{n}{annot}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,}
                \PYG{n}{fmt}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{2.0f}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
                \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{nipy\PYGZus{}spectral}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                \PYG{n}{ax}\PYG{o}{=}\PYG{n}{c\PYGZus{}ax}\PYG{p}{,}
                \PYG{n}{cbar}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{,}
                \PYG{n}{vmin}\PYG{o}{=}\PYG{l+m+mi}{0}\PYG{p}{,}
                \PYG{n}{vmax}\PYG{o}{=}\PYG{l+m+mi}{5}\PYG{p}{)}
    \PYG{n}{c\PYGZus{}ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{DMap \PYGZsh{}}\PYG{l+s+si}{\PYGZob{}\PYGZcb{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{i}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{)}
    \PYG{n}{c\PYGZus{}hist}\PYG{o}{.}\PYG{n}{hist}\PYG{p}{(}\PYG{n}{img\PYGZus{}list}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{o}{.}\PYG{n}{ravel}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,}
                \PYG{n}{np}\PYG{o}{.}\PYG{n}{linspace}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{,} \PYG{l+m+mi}{6}\PYG{p}{)}\PYG{p}{)}
    \PYG{n}{c\PYGZus{}hist}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Mean: }\PYG{l+s+si}{\PYGZpc{}2.2f}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s+s1}{Std: }\PYG{l+s+si}{\PYGZpc{}2.2f}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{\PYGZpc{}} \PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{n}{img\PYGZus{}list}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{[}\PYG{n}{img\PYGZus{}list}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]} \PYG{o}{\PYGZgt{}} \PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}
                                                  \PYG{n}{np}\PYG{o}{.}\PYG{n}{std}\PYG{p}{(}\PYG{n}{img\PYGZus{}list}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{[}\PYG{n}{img\PYGZus{}list}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]} \PYG{o}{\PYGZgt{}} \PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}

    \PYG{n}{c\PYGZus{}dmean}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{i}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{,} \PYG{p}{[}\PYG{n}{np}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{n}{img\PYGZus{}list}\PYG{p}{[}\PYG{n}{k}\PYG{p}{]}\PYG{p}{[}\PYG{n}{img\PYGZus{}list}\PYG{p}{[}\PYG{n}{k}\PYG{p}{]} \PYG{o}{\PYGZgt{}} \PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}
                              \PYG{k}{for} \PYG{n}{k} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{i}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{r+\PYGZhy{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{c\PYGZus{}dmean}\PYG{o}{.}\PYG{n}{set\PYGZus{}ylim}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{)}
    \PYG{n}{c\PYGZus{}dmean}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Avergage Distance}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

    \PYG{n}{lab\PYGZus{}img} \PYG{o}{=} \PYG{n}{ndimage}\PYG{o}{.}\PYG{n}{label}\PYG{p}{(}\PYG{n}{img\PYGZus{}list}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]} \PYG{o}{\PYGZgt{}} \PYG{l+m+mi}{0}\PYG{p}{)}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}

    \PYG{n}{sns}\PYG{o}{.}\PYG{n}{heatmap}\PYG{p}{(}\PYG{n}{lab\PYGZus{}img}\PYG{p}{,}
                \PYG{n}{annot}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,}
                \PYG{n}{fmt}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{d}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
                \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{nipy\PYGZus{}spectral}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                \PYG{n}{ax}\PYG{o}{=}\PYG{n}{c\PYGZus{}lab}\PYG{p}{,}
                \PYG{n}{cbar}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{,}
                \PYG{n}{vmin}\PYG{o}{=}\PYG{l+m+mi}{0}\PYG{p}{,}
                \PYG{n}{vmax}\PYG{o}{=}\PYG{l+m+mi}{2}\PYG{p}{)}
    \PYG{n}{c\PYGZus{}lab}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Component Labeled}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

    \PYG{k}{def} \PYG{n+nf}{avg\PYGZus{}area}\PYG{p}{(}\PYG{n}{c\PYGZus{}img}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{l\PYGZus{}img} \PYG{o}{=} \PYG{n}{ndimage}\PYG{o}{.}\PYG{n}{label}\PYG{p}{(}\PYG{n}{c\PYGZus{}img} \PYG{o}{\PYGZgt{}} \PYG{l+m+mi}{0}\PYG{p}{)}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}
        \PYG{k}{return} \PYG{n}{np}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{p}{[}\PYG{n}{np}\PYG{o}{.}\PYG{n}{sum}\PYG{p}{(}\PYG{n}{l\PYGZus{}img} \PYG{o}{==} \PYG{n}{k}\PYG{p}{)} \PYG{k}{for} \PYG{n}{k} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{l\PYGZus{}img}\PYG{o}{.}\PYG{n}{max}\PYG{p}{(}\PYG{p}{)}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{]}\PYG{p}{)}
    
    \PYG{n}{n}\PYG{p}{,} \PYG{n}{\PYGZus{}}\PYG{p}{,} \PYG{n}{\PYGZus{}} \PYG{o}{=} \PYG{n}{c\PYGZus{}labhist}\PYG{o}{.}\PYG{n}{hist}\PYG{p}{(}\PYG{n}{lab\PYGZus{}img}\PYG{p}{[}\PYG{n}{lab\PYGZus{}img} \PYG{o}{\PYGZgt{}} \PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{ravel}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,} \PYG{p}{[}
                             \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{]}\PYG{p}{,} \PYG{n}{rwidth}\PYG{o}{=}\PYG{l+m+mf}{0.8}\PYG{p}{)}
    \PYG{n}{c\PYGZus{}labhist}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{} Components: }\PYG{l+s+si}{\PYGZpc{}d}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s+s1}{Avg Area: }\PYG{l+s+si}{\PYGZpc{}d}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{\PYGZpc{}}
                        \PYG{p}{(}\PYG{n}{lab\PYGZus{}img}\PYG{o}{.}\PYG{n}{max}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,} \PYG{n}{avg\PYGZus{}area}\PYG{p}{(}\PYG{n}{img\PYGZus{}list}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}

    \PYG{n}{c\PYGZus{}lmean}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{i}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{,}
                 \PYG{p}{[}\PYG{n}{avg\PYGZus{}area}\PYG{p}{(}\PYG{n}{img\PYGZus{}list}\PYG{p}{[}\PYG{n}{k}\PYG{p}{]}\PYG{p}{)} \PYG{k}{for} \PYG{n}{k} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{i}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{r+\PYGZhy{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{c\PYGZus{}lmean}\PYG{o}{.}\PYG{n}{set\PYGZus{}ylim}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{150}\PYG{p}{)}
    \PYG{n}{c\PYGZus{}lmean}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Average Area}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{n}{fig}\PYG{p}{,} \PYG{n}{m\PYGZus{}axs} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{12}\PYG{p}{,} \PYG{l+m+mi}{8}\PYG{p}{)}\PYG{p}{,} \PYG{n}{dpi}\PYG{o}{=}\PYG{l+m+mi}{100}\PYG{p}{)}

\PYG{n}{img\PYGZus{}list} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n}{np}\PYG{o}{.}\PYG{n}{linspace}\PYG{p}{(}\PYG{l+m+mf}{0.6}\PYG{p}{,} \PYG{l+m+mf}{1.3}\PYG{p}{,} \PYG{l+m+mi}{7}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{img\PYGZus{}bw} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{concatenate}\PYG{p}{(}\PYG{p}{[}\PYG{n}{generate\PYGZus{}dot\PYGZus{}image}\PYG{p}{(}\PYG{l+m+mi}{12}\PYG{p}{,} \PYG{l+m+mf}{0.7}\PYG{p}{,} \PYG{n}{i}\PYG{p}{)}\PYG{p}{,}
                             \PYG{n}{generate\PYGZus{}dot\PYGZus{}image}\PYG{p}{(}\PYG{l+m+mi}{12}\PYG{p}{,} \PYG{l+m+mf}{0.6}\PYG{p}{,} \PYG{n}{i}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{)}
    \PYG{n}{img\PYGZus{}base} \PYG{o}{=} \PYG{n}{ndimage}\PYG{o}{.}\PYG{n}{distance\PYGZus{}transform\PYGZus{}edt}\PYG{p}{(}\PYG{n}{img\PYGZus{}bw}\PYG{p}{)}
    \PYG{n}{img\PYGZus{}list} \PYG{o}{+}\PYG{o}{=} \PYG{p}{[}\PYG{n}{img\PYGZus{}base}\PYG{p}{]}
    
\PYG{c+c1}{\PYGZsh{} write animation frames}
\PYG{n}{anim\PYGZus{}code} \PYG{o}{=} \PYG{n}{FuncAnimation}\PYG{p}{(}\PYG{n}{fig}\PYG{p}{,}
                          \PYG{n}{update\PYGZus{}frame}\PYG{p}{,}
                          \PYG{n}{frames}\PYG{o}{=}\PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{img\PYGZus{}list}\PYG{p}{)}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{,}
                          \PYG{n}{interval}\PYG{o}{=}\PYG{l+m+mi}{1000}\PYG{p}{,}
                          \PYG{n}{repeat\PYGZus{}delay}\PYG{o}{=}\PYG{l+m+mi}{2000}\PYG{p}{)}\PYG{o}{.}\PYG{n}{to\PYGZus{}html5\PYGZus{}video}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{close}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{all}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}


\subsection{Animate the distances}
\label{\detokenize{06-AdvancedShapeAndTexture:animate-the-distances}}
\sphinxAtStartPar
In this example we grow two objects and observe how the maximum distance changes compared to the area of labeled object. Initially, the two metrics behave similarly. It becomes interesting when the two objects grow into each other. Then the labeling only finds a single object and the area is double compared to before the merge. The distance, however, stay within the same magnitude thoughout the entire growing sequence.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{HTML}\PYG{p}{(}\PYG{n}{anim\PYGZus{}code}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZlt{}IPython.core.display.HTML object\PYGZgt{}
\end{sphinxVerbatim}


\chapter{Distance Map of Real Images}
\label{\detokenize{06-AdvancedShapeAndTexture:distance-map-of-real-images}}
\sphinxAtStartPar
We now have a basic idea of how the distance map works we can now try to apply it to real images


\section{The bone slice}
\label{\detokenize{06-AdvancedShapeAndTexture:the-bone-slice}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{bw\PYGZus{}img} \PYG{o}{=} \PYG{n}{imread}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{../Lecture\PYGZhy{}05/figures/bonegfiltslice.png}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

\PYG{n}{thresh\PYGZus{}img} \PYG{o}{=} \PYG{n}{binary\PYGZus{}closing}\PYG{p}{(}\PYG{n}{binary\PYGZus{}opening}\PYG{p}{(}\PYG{n}{bw\PYGZus{}img} \PYG{o}{\PYGZlt{}} \PYG{l+m+mi}{90}\PYG{p}{,} \PYG{n}{disk}\PYG{p}{(}\PYG{l+m+mi}{3}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,} \PYG{n}{disk}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{fg\PYGZus{}dmap} \PYG{o}{=} \PYG{n}{distance\PYGZus{}transform\PYGZus{}edt}\PYG{p}{(}\PYG{n}{thresh\PYGZus{}img}\PYG{p}{)}
\PYG{n}{bg\PYGZus{}dmap} \PYG{o}{=} \PYG{n}{distance\PYGZus{}transform\PYGZus{}edt}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{o}{\PYGZhy{}}\PYG{n}{thresh\PYGZus{}img}\PYG{p}{)}

\PYG{n}{fig}\PYG{p}{,} \PYG{p}{(}\PYG{n}{ax1}\PYG{p}{,} \PYG{n}{ax2}\PYG{p}{,} \PYG{n}{ax3}\PYG{p}{,} \PYG{n}{ax4}\PYG{p}{)} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{4}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{20}\PYG{p}{,} \PYG{l+m+mi}{6}\PYG{p}{)}\PYG{p}{,} \PYG{n}{dpi}\PYG{o}{=}\PYG{l+m+mi}{100}\PYG{p}{)}
\PYG{n}{ax1}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{n}{bw\PYGZus{}img}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{bone}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}           \PYG{n}{ax1}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Original image}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax2}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{n}{thresh\PYGZus{}img}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{bone}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}       \PYG{n}{ax2}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Mask}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)} 
\PYG{n}{ax3}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{n}{fg\PYGZus{}dmap}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{nipy\PYGZus{}spectral}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;} \PYG{n}{ax3}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Distance Map}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s+s1}{Foreground}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
\PYG{n}{ax4}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{n}{bg\PYGZus{}dmap}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{nipy\PYGZus{}spectral}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;} \PYG{n}{ax4}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Distance Map}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s+s1}{Background}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{06-AdvancedShapeAndTexture_41_0}.png}


\section{The cortex}
\label{\detokenize{06-AdvancedShapeAndTexture:the-cortex}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{cortex\PYGZus{}img} \PYG{o}{=} \PYG{n}{imread}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{figures/example\PYGZus{}poster.tif}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{[}\PYG{p}{:}\PYG{p}{:}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{p}{:}\PYG{p}{:}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{o}{/}\PYG{l+m+mi}{2048}
\PYG{n}{cortex\PYGZus{}mask} \PYG{o}{=} \PYG{n}{imread}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{figures/example\PYGZus{}poster\PYGZus{}mask.tif}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{[}\PYG{p}{:}\PYG{p}{:}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{p}{:}\PYG{p}{:}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{/}\PYG{l+m+mf}{255.0}
\PYG{n}{cortex\PYGZus{}dmap} \PYG{o}{=} \PYG{n}{distance\PYGZus{}transform\PYGZus{}edt}\PYG{p}{(}\PYG{n}{cortex\PYGZus{}mask}\PYG{p}{)}
\PYG{n}{fig}\PYG{p}{,} \PYG{p}{(}\PYG{n}{ax1}\PYG{p}{,} \PYG{n}{ax2}\PYG{p}{,} \PYG{n}{ax3}\PYG{p}{)} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{20}\PYG{p}{,} \PYG{l+m+mi}{6}\PYG{p}{)}\PYG{p}{,} \PYG{n}{dpi}\PYG{o}{=}\PYG{l+m+mi}{100}\PYG{p}{)}

\PYG{n}{ax1}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{n}{cortex\PYGZus{}img}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{bone}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,} \PYG{n}{ax1}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Brain image}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax2}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{n}{cortex\PYGZus{}mask}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{bone}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,} \PYG{n}{ax2}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Cortex mask}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax3}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{n}{cortex\PYGZus{}dmap}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{nipy\PYGZus{}spectral}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;} \PYG{n}{ax3}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Distance map of cortex}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{06-AdvancedShapeAndTexture_43_0}.png}


\section{How can we utilize this information?}
\label{\detokenize{06-AdvancedShapeAndTexture:how-can-we-utilize-this-information}}\begin{itemize}
\item {} 
\sphinxAtStartPar
So we can see in the distance map some information about the size of the object,

\item {} 
\sphinxAtStartPar
but the raw values and taking a histogram do not seem to provide this very clearly

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{fig}\PYG{p}{,} \PYG{p}{(}\PYG{n}{ax1}\PYG{p}{,} \PYG{n}{ax2}\PYG{p}{)} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{20}\PYG{p}{,} \PYG{l+m+mi}{6}\PYG{p}{)}\PYG{p}{,} \PYG{n}{dpi}\PYG{o}{=}\PYG{l+m+mi}{100}\PYG{p}{)}
\PYG{n}{cortex\PYGZus{}dmap\PYGZus{}roi} \PYG{o}{=} \PYG{n}{cortex\PYGZus{}dmap}\PYG{p}{[}\PYG{l+m+mi}{25}\PYG{p}{:}\PYG{l+m+mi}{175}\PYG{p}{,} \PYG{l+m+mi}{25}\PYG{p}{:}\PYG{l+m+mi}{150}\PYG{p}{]}
\PYG{n}{sns}\PYG{o}{.}\PYG{n}{heatmap}\PYG{p}{(}\PYG{n}{cortex\PYGZus{}dmap\PYGZus{}roi}\PYG{p}{[}\PYG{p}{:}\PYG{p}{:}\PYG{l+m+mi}{5}\PYG{p}{,} \PYG{p}{:}\PYG{p}{:}\PYG{l+m+mi}{5}\PYG{p}{]}\PYG{p}{,}
            \PYG{n}{annot}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,}
            \PYG{n}{fmt}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{2.0f}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
            \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{nipy\PYGZus{}spectral}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
            \PYG{n}{ax}\PYG{o}{=}\PYG{n}{ax1}\PYG{p}{,}
            \PYG{n}{cbar}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}\PYG{p}{;}

\PYG{n}{ax2}\PYG{o}{.}\PYG{n}{hist}\PYG{p}{(}\PYG{n}{cortex\PYGZus{}dmap\PYGZus{}roi}\PYG{p}{[}\PYG{n}{cortex\PYGZus{}dmap\PYGZus{}roi} \PYG{o}{\PYGZgt{}} \PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{ravel}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,} \PYG{l+m+mi}{50}\PYG{p}{)}\PYG{p}{;} \PYG{n}{ax2}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Histogram of distances}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{06-AdvancedShapeAndTexture_45_0}.png}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{skimage}\PYG{n+nn}{.}\PYG{n+nn}{morphology} \PYG{k+kn}{import} \PYG{n}{binary\PYGZus{}opening}\PYG{p}{,} \PYG{n}{binary\PYGZus{}closing}\PYG{p}{,} \PYG{n}{disk}
\PYG{k+kn}{from} \PYG{n+nn}{scipy}\PYG{n+nn}{.}\PYG{n+nn}{ndimage} \PYG{k+kn}{import} \PYG{n}{distance\PYGZus{}transform\PYGZus{}edt}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{matplotlib}\PYG{n+nn}{.}\PYG{n+nn}{pyplot} \PYG{k}{as} \PYG{n+nn}{plt}
\PYG{k+kn}{from} \PYG{n+nn}{skimage}\PYG{n+nn}{.}\PYG{n+nn}{io} \PYG{k+kn}{import} \PYG{n}{imread}
\PYG{o}{\PYGZpc{}}\PYG{k}{matplotlib} inline
\end{sphinxVerbatim}


\chapter{The thickness map}
\label{\detokenize{06-AdvancedShapeAndTexture:the-thickness-map}}
\sphinxAtStartPar
Thickness is a metric for assessing the size and structure of objects in a very generic manner.
For every point \(\vec{x}\) in the image you find the largest sphere which:
\begin{itemize}
\item {} 
\sphinxAtStartPar
contains that point

\item {} 
\sphinxAtStartPar
is entirely contained within the object

\end{itemize}

\sphinxAtStartPar
The thickness map is quantifying the regional sizes compared to the distance map which describes distances from pixel to pixel. That is, in the thickness map all pixels belonging to a sphere that can be inscribed in the object will have the value of the sphere radius. There will be many overlapping spheres and it is always the largest radius that defines the pixel value.

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics[scale=0.6]{{ThickOverview}.png}
\caption{The largest sphere inscribed in the object.}\label{\detokenize{06-AdvancedShapeAndTexture:id2}}\end{figure}

\sphinxAtStartPar
In the comparison below, you can see that the distance map has a greater representation of short distances while the thickness map has large areas with great distances.

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics[scale=0.6]{{poremap}.png}
\caption{Comparing the thickness map to the distance map.}\label{\detokenize{06-AdvancedShapeAndTexture:id3}}\end{figure}

\sphinxAtStartPar
The thickness map has many names. So, when you hear terms like pore radius map or pore size map, then it is all the same thing. One little difference would be that the thickness map indicates that you are measuring solid objects while the pore size map focuses on the voids between the objects.



\sphinxAtStartPar
Taken from \sphinxhref{https://doi.org/10.1046/j.1365-2818.1997.1340694.x}{Hildebrand 1997}
\begin{itemize}
\item {} 
\sphinxAtStartPar
The image shows a typical object

\item {} 
\sphinxAtStartPar
The sphere centered at point \(p\) with a radius \(r\) is the largest that fits

\end{itemize}


\section{Applications}
\label{\detokenize{06-AdvancedShapeAndTexture:applications}}\begin{itemize}
\item {} 
\sphinxAtStartPar
Ideal for spherical and cylindrical objects since it shows their radius

\item {} 
\sphinxAtStartPar
Also relevant for flow and diffusion since it can highlight bottlenecks in structure (then called pore radius map) \sphinxhref{https://doi.org/10.2136/vzj2004.0177}{Lehmann 2006}

\end{itemize}


\section{A thickness map implementation}
\label{\detokenize{06-AdvancedShapeAndTexture:a-thickness-map-implementation}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{simple\PYGZus{}thickness\PYGZus{}func}\PYG{p}{(}\PYG{n}{distance\PYGZus{}map}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{dm} \PYG{o}{=} \PYG{n}{distance\PYGZus{}map}\PYG{o}{.}\PYG{n}{ravel}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{th\PYGZus{}map} \PYG{o}{=} \PYG{n}{distance\PYGZus{}map}\PYG{o}{.}\PYG{n}{ravel}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{copy}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{xx}\PYG{p}{,} \PYG{n}{yy} \PYG{o}{=} \PYG{p}{[}\PYG{n}{v}\PYG{o}{.}\PYG{n}{ravel}\PYG{p}{(}\PYG{p}{)} \PYG{k}{for} \PYG{n}{v} \PYG{o+ow}{in} \PYG{n}{np}\PYG{o}{.}\PYG{n}{meshgrid}\PYG{p}{(}\PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{distance\PYGZus{}map}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}
                                             \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{distance\PYGZus{}map}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}\PYG{p}{]}

    \PYG{k}{for} \PYG{n}{idx} \PYG{o+ow}{in} \PYG{n}{np}\PYG{o}{.}\PYG{n}{argsort}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{n}{dm}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{dval} \PYG{o}{=} \PYG{n}{dm}\PYG{p}{[}\PYG{n}{idx}\PYG{p}{]}
        \PYG{k}{if} \PYG{n}{dval} \PYG{o}{\PYGZgt{}} \PYG{l+m+mi}{0}\PYG{p}{:}
            \PYG{n}{p\PYGZus{}mask} \PYG{o}{=} \PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{square}\PYG{p}{(}\PYG{n}{xx}\PYG{o}{\PYGZhy{}}\PYG{n}{xx}\PYG{p}{[}\PYG{n}{idx}\PYG{p}{]}\PYG{p}{)} \PYG{o}{+}
                      \PYG{n}{np}\PYG{o}{.}\PYG{n}{square}\PYG{p}{(}\PYG{n}{yy}\PYG{o}{\PYGZhy{}}\PYG{n}{yy}\PYG{p}{[}\PYG{n}{idx}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{square}\PYG{p}{(}\PYG{n}{dval}\PYG{p}{)}
            \PYG{n}{p\PYGZus{}mask} \PYG{o}{\PYGZam{}}\PYG{o}{=} \PYG{n}{th\PYGZus{}map} \PYG{o}{\PYGZlt{}} \PYG{n}{dval}
            \PYG{n}{th\PYGZus{}map}\PYG{p}{[}\PYG{n}{p\PYGZus{}mask}\PYG{p}{]} \PYG{o}{=} \PYG{n}{dval}
    \PYG{n}{th\PYGZus{}map}\PYG{p}{[}\PYG{n}{dm} \PYG{o}{==} \PYG{l+m+mi}{0}\PYG{p}{]} \PYG{o}{=} \PYG{l+m+mi}{0}  \PYG{c+c1}{\PYGZsh{} make sure zeros stay zero (rounding errors)}
    \PYG{k}{return} \PYG{n}{th\PYGZus{}map}\PYG{o}{.}\PYG{n}{reshape}\PYG{p}{(}\PYG{n}{distance\PYGZus{}map}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{)}
\end{sphinxVerbatim}


\section{Thickness map on foregrund and background}
\label{\detokenize{06-AdvancedShapeAndTexture:thickness-map-on-foregrund-and-background}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{fg\PYGZus{}th\PYGZus{}map} \PYG{o}{=} \PYG{n}{simple\PYGZus{}thickness\PYGZus{}func}\PYG{p}{(}\PYG{n}{fg\PYGZus{}dmap}\PYG{p}{)}
\PYG{n}{bg\PYGZus{}th\PYGZus{}map} \PYG{o}{=} \PYG{n}{simple\PYGZus{}thickness\PYGZus{}func}\PYG{p}{(}\PYG{n}{bg\PYGZus{}dmap}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{fig}\PYG{p}{,} \PYG{p}{(}\PYG{n}{ax3}\PYG{p}{,} \PYG{n}{ax4}\PYG{p}{)} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{20}\PYG{p}{,} \PYG{l+m+mi}{6}\PYG{p}{)}\PYG{p}{,} \PYG{n}{dpi}\PYG{o}{=}\PYG{l+m+mi}{100}\PYG{p}{)}

\PYG{n}{ax3}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{n}{fg\PYGZus{}th\PYGZus{}map}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{nipy\PYGZus{}spectral}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;} \PYG{n}{ax3}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Thickness Map \PYGZhy{} Foreground}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
\PYG{n}{ax4}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{n}{bg\PYGZus{}th\PYGZus{}map}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{nipy\PYGZus{}spectral}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;} \PYG{n}{ax4}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Thickness Map \PYGZhy{} Background}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{06-AdvancedShapeAndTexture_55_0}.png}


\section{Thickness distributions}
\label{\detokenize{06-AdvancedShapeAndTexture:thickness-distributions}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{fig}\PYG{p}{,} \PYG{p}{(}\PYG{n}{ax3}\PYG{p}{,} \PYG{n}{ax4}\PYG{p}{)} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{20}\PYG{p}{,} \PYG{l+m+mi}{6}\PYG{p}{)}\PYG{p}{,} \PYG{n}{dpi}\PYG{o}{=}\PYG{l+m+mi}{100}\PYG{p}{)}

\PYG{n}{ax3}\PYG{o}{.}\PYG{n}{hist}\PYG{p}{(}\PYG{n}{fg\PYGZus{}th\PYGZus{}map}\PYG{p}{[}\PYG{n}{fg\PYGZus{}th\PYGZus{}map} \PYG{o}{\PYGZgt{}} \PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{ravel}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,} \PYG{l+m+mi}{20}\PYG{p}{)}\PYG{p}{;} \PYG{n}{ax3}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Thickness Map \PYGZhy{} Foreground}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
\PYG{n}{ax4}\PYG{o}{.}\PYG{n}{hist}\PYG{p}{(}\PYG{n}{bg\PYGZus{}th\PYGZus{}map}\PYG{p}{[}\PYG{n}{bg\PYGZus{}th\PYGZus{}map} \PYG{o}{\PYGZgt{}} \PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{ravel}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,} \PYG{l+m+mi}{20}\PYG{p}{)}\PYG{p}{;} \PYG{n}{ax4}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Thickness Map \PYGZhy{} Background}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{06-AdvancedShapeAndTexture_57_0}.png}


\chapter{Distance Maps in 3D}
\label{\detokenize{06-AdvancedShapeAndTexture:distance-maps-in-3d}}\begin{itemize}
\item {} 
\sphinxAtStartPar
Distance maps work in more than two dimensions and can be used in n\sphinxhyphen{}d problems.

\item {} 
\sphinxAtStartPar
Beyond 3D requires serious thought about what the meaning of this distance is.

\end{itemize}


\section{Let’s load a 3D image}
\label{\detokenize{06-AdvancedShapeAndTexture:let-s-load-a-3d-image}}
\sphinxAtStartPar
We need some dadta to demonstrate the distance transform of 3D images. This an image of oblatoid grains which are aligned with the major axis in the vertical direction.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{montage\PYGZus{}pad}\PYG{p}{(}\PYG{n}{x}\PYG{p}{)}\PYG{p}{:} \PYG{k}{return} \PYG{n}{montage2d}\PYG{p}{(}
    \PYG{n}{np}\PYG{o}{.}\PYG{n}{pad}\PYG{p}{(}\PYG{n}{x}\PYG{p}{,} \PYG{p}{[}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{l+m+mi}{10}\PYG{p}{,} \PYG{l+m+mi}{10}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{l+m+mi}{10}\PYG{p}{,} \PYG{l+m+mi}{10}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,} \PYG{n}{mode}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{constant}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{constant\PYGZus{}values}\PYG{o}{=}\PYG{l+m+mi}{0}\PYG{p}{)}\PYG{p}{)}

\PYG{n}{bw\PYGZus{}img} \PYG{o}{=} \PYG{l+m+mi}{255} \PYG{o}{\PYGZhy{}} \PYG{n}{imread}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{data/plateau\PYGZus{}border.tif}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{[}\PYG{p}{:}\PYG{p}{,} \PYG{l+m+mi}{100}\PYG{p}{:}\PYG{l+m+mi}{400}\PYG{p}{,} \PYG{l+m+mi}{100}\PYG{p}{:}\PYG{l+m+mi}{400}\PYG{p}{]}\PYG{p}{[}\PYG{p}{:}\PYG{p}{,} \PYG{p}{:}\PYG{p}{:}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{p}{:}\PYG{p}{:}\PYG{l+m+mi}{2}\PYG{p}{]}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Loaded Image:}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{bw\PYGZus{}img}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{,} \PYG{n}{bw\PYGZus{}img}\PYG{o}{.}\PYG{n}{max}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{fig}\PYG{p}{,} \PYG{p}{(}\PYG{n}{ax1}\PYG{p}{,} \PYG{n}{ax2}\PYG{p}{)} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{18}\PYG{p}{,} \PYG{l+m+mi}{8}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{ax1}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{n}{montage\PYGZus{}pad}\PYG{p}{(}\PYG{n}{bw\PYGZus{}img}\PYG{p}{[}\PYG{p}{:}\PYG{p}{:}\PYG{l+m+mi}{10}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{bone}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}\PYG{n}{ax1}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Axial Slices}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax2}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{n}{montage\PYGZus{}pad}\PYG{p}{(}\PYG{n}{bw\PYGZus{}img}\PYG{o}{.}\PYG{n}{swapaxes}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{[}\PYG{p}{:}\PYG{p}{:}\PYG{l+m+mi}{10}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{bone}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;} \PYG{n}{ax2}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Sagittal Slices}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
Loaded Image: (154, 150, 150) 255
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{06-AdvancedShapeAndTexture_61_1}.png}


\section{Inspecting the data in 3D}
\label{\detokenize{06-AdvancedShapeAndTexture:inspecting-the-data-in-3d}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{show\PYGZus{}3d\PYGZus{}mesh}\PYG{p}{(}\PYG{n}{image}\PYG{p}{,} \PYG{n}{thresholds}\PYG{p}{,} \PYG{n}{edgecolor}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{none}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{alpha}\PYG{o}{=}\PYG{l+m+mf}{0.5}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{p} \PYG{o}{=} \PYG{n}{image}\PYG{p}{[}\PYG{p}{:}\PYG{p}{:}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{swapaxes}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{)}
    \PYG{n}{cmap} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{cm}\PYG{o}{.}\PYG{n}{get\PYGZus{}cmap}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{nipy\PYGZus{}spectral\PYGZus{}r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{fig} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{figure}\PYG{p}{(}\PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{10}\PYG{p}{,} \PYG{l+m+mi}{10}\PYG{p}{)}\PYG{p}{)}
    \PYG{n}{ax} \PYG{o}{=} \PYG{n}{fig}\PYG{o}{.}\PYG{n}{add\PYGZus{}subplot}\PYG{p}{(}\PYG{l+m+mi}{111}\PYG{p}{,} \PYG{n}{projection}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{3d}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{i}\PYG{p}{,} \PYG{n}{c\PYGZus{}threshold} \PYG{o+ow}{in} \PYG{n+nb}{list}\PYG{p}{(}\PYG{n+nb}{enumerate}\PYG{p}{(}\PYG{n}{thresholds}\PYG{p}{)}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{verts}\PYG{p}{,} \PYG{n}{faces}\PYG{p}{,} \PYG{n}{\PYGZus{}}\PYG{p}{,} \PYG{n}{\PYGZus{}} \PYG{o}{=} \PYG{n}{measure}\PYG{o}{.}\PYG{n}{marching\PYGZus{}cubes}\PYG{p}{(}\PYG{n}{p}\PYG{p}{,} \PYG{n}{c\PYGZus{}threshold}\PYG{p}{)}
        \PYG{n}{mesh} \PYG{o}{=} \PYG{n}{Poly3DCollection}\PYG{p}{(}\PYG{n}{verts}\PYG{p}{[}\PYG{n}{faces}\PYG{p}{]}\PYG{p}{,} \PYG{n}{alpha}\PYG{o}{=}\PYG{n}{alpha}\PYG{p}{,} \PYG{n}{edgecolor}\PYG{o}{=}\PYG{n}{edgecolor}\PYG{p}{,} \PYG{n}{linewidth}\PYG{o}{=}\PYG{l+m+mf}{0.1}\PYG{p}{)}
        \PYG{n}{mesh}\PYG{o}{.}\PYG{n}{set\PYGZus{}facecolor}\PYG{p}{(}\PYG{n}{cmap}\PYG{p}{(}\PYG{n}{i} \PYG{o}{/} \PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{thresholds}\PYG{p}{)}\PYG{p}{)}\PYG{p}{[}\PYG{p}{:}\PYG{l+m+mi}{3}\PYG{p}{]}\PYG{p}{)}
        \PYG{n}{ax}\PYG{o}{.}\PYG{n}{add\PYGZus{}collection3d}\PYG{p}{(}\PYG{n}{mesh}\PYG{p}{)}
    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}xlim}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{n}{p}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{;} \PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}ylim}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{n}{p}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{;} \PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}zlim}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{n}{p}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{p}{)}

    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{view\PYGZus{}init}\PYG{p}{(}\PYG{l+m+mi}{45}\PYG{p}{,} \PYG{l+m+mi}{45}\PYG{p}{)}
    \PYG{k}{return} \PYG{n}{fig}


\PYG{n}{smooth\PYGZus{}pt\PYGZus{}img} \PYG{o}{=} \PYG{n}{gaussian}\PYG{p}{(}\PYG{n}{bw\PYGZus{}img}\PYG{p}{[}\PYG{p}{:}\PYG{p}{:}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{p}{:}\PYG{p}{:}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{p}{:}\PYG{p}{:}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{o}{*}\PYG{l+m+mf}{1.0}\PYG{o}{/}\PYG{n}{bw\PYGZus{}img}\PYG{o}{.}\PYG{n}{max}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,} \PYG{l+m+mf}{1.5}\PYG{p}{)}
\PYG{n}{show\PYGZus{}3d\PYGZus{}mesh}\PYG{p}{(}\PYG{n}{smooth\PYGZus{}pt\PYGZus{}img}\PYG{p}{,} \PYG{p}{[}\PYG{n}{smooth\PYGZus{}pt\PYGZus{}img}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,}
             \PYG{n}{alpha}\PYG{o}{=}\PYG{l+m+mf}{0.75}\PYG{p}{,} \PYG{n}{edgecolor}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{black}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{06-AdvancedShapeAndTexture_63_0}.png}


\subsection{Rendering the mesh as a surface}
\label{\detokenize{06-AdvancedShapeAndTexture:rendering-the-mesh-as-a-surface}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{py}\PYG{o}{.}\PYG{n}{init\PYGZus{}notebook\PYGZus{}mode}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{verts}\PYG{p}{,} \PYG{n}{faces}\PYG{p}{,} \PYG{n}{\PYGZus{}}\PYG{p}{,} \PYG{n}{\PYGZus{}} \PYG{o}{=} \PYG{n}{measure}\PYG{o}{.}\PYG{n}{marching\PYGZus{}cubes}\PYG{p}{(}
    \PYG{c+c1}{\PYGZsh{} you can make it bigger but the file\PYGZhy{}size gets HUUUEGE}
    \PYG{n}{smooth\PYGZus{}pt\PYGZus{}img}\PYG{p}{[}\PYG{p}{:}\PYG{l+m+mi}{20}\PYG{p}{,} \PYG{p}{:}\PYG{l+m+mi}{20}\PYG{p}{,} \PYG{p}{:}\PYG{l+m+mi}{20}\PYG{p}{]}\PYG{p}{,}
    \PYG{n}{smooth\PYGZus{}pt\PYGZus{}img}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{x}\PYG{p}{,} \PYG{n}{y}\PYG{p}{,} \PYG{n}{z} \PYG{o}{=} \PYG{n+nb}{zip}\PYG{p}{(}\PYG{o}{*}\PYG{n}{verts}\PYG{p}{)}
\PYG{n}{ff\PYGZus{}fig} \PYG{o}{=} \PYG{n}{FF}\PYG{o}{.}\PYG{n}{create\PYGZus{}trisurf}\PYG{p}{(}\PYG{n}{x}\PYG{o}{=}\PYG{n}{x}\PYG{p}{,} \PYG{n}{y}\PYG{o}{=}\PYG{n}{y}\PYG{p}{,} \PYG{n}{z}\PYG{o}{=}\PYG{n}{z}\PYG{p}{,}
                           \PYG{n}{simplices}\PYG{o}{=}\PYG{n}{faces}\PYG{p}{,}
                           \PYG{n}{title}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Foam Plataeu Border}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
                           \PYG{n}{aspectratio}\PYG{o}{=}\PYG{n+nb}{dict}\PYG{p}{(}\PYG{n}{x}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{y}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{z}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{,}
                           \PYG{n}{plot\PYGZus{}edges}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}
\PYG{n}{c\PYGZus{}mesh} \PYG{o}{=} \PYG{n}{ff\PYGZus{}fig}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{data}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}
\PYG{n}{c\PYGZus{}mesh}\PYG{o}{.}\PYG{n}{update}\PYG{p}{(}\PYG{n}{lighting}\PYG{o}{=}\PYG{n+nb}{dict}\PYG{p}{(}\PYG{n}{ambient}\PYG{o}{=}\PYG{l+m+mf}{0.18}\PYG{p}{,}
                            \PYG{n}{diffuse}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{,}
                            \PYG{n}{fresnel}\PYG{o}{=}\PYG{l+m+mf}{0.1}\PYG{p}{,}
                            \PYG{n}{specular}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{,}
                            \PYG{n}{roughness}\PYG{o}{=}\PYG{l+m+mf}{0.1}\PYG{p}{,}
                            \PYG{n}{facenormalsepsilon}\PYG{o}{=}\PYG{l+m+mf}{1e\PYGZhy{}6}\PYG{p}{,}
                            \PYG{n}{vertexnormalsepsilon}\PYG{o}{=}\PYG{l+m+mf}{1e\PYGZhy{}12}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{c\PYGZus{}mesh}\PYG{o}{.}\PYG{n}{update}\PYG{p}{(}\PYG{n}{flatshading}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}
\PYG{n}{py}\PYG{o}{.}\PYG{n}{iplot}\PYG{p}{(}\PYG{n}{ff\PYGZus{}fig}\PYG{p}{)}
\end{sphinxVerbatim}


\section{Look at the distance transform}
\label{\detokenize{06-AdvancedShapeAndTexture:look-at-the-distance-transform}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{bubble\PYGZus{}dist} \PYG{o}{=} \PYG{n}{distance\PYGZus{}transform\PYGZus{}edt}\PYG{p}{(}\PYG{n}{bw\PYGZus{}img}\PYG{p}{)}
\PYG{n}{fig}\PYG{p}{,} \PYG{p}{(}\PYG{n}{ax1}\PYG{p}{,} \PYG{n}{ax2}\PYG{p}{)} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{18}\PYG{p}{,} \PYG{l+m+mi}{8}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{ax1}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{n}{montage\PYGZus{}pad}\PYG{p}{(}\PYG{n}{bubble\PYGZus{}dist}\PYG{p}{[}\PYG{p}{:}\PYG{p}{:}\PYG{l+m+mi}{10}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{nipy\PYGZus{}spectral}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax1}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Distance maps \PYGZhy{} Axial Slices}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax2}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{n}{montage\PYGZus{}pad}\PYG{p}{(}\PYG{n}{bubble\PYGZus{}dist}\PYG{o}{.}\PYG{n}{swapaxes}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{[}\PYG{p}{:}\PYG{p}{:}\PYG{l+m+mi}{10}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{nipy\PYGZus{}spectral}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax2}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Distance maps \PYGZhy{} Sagittal Slices}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;} 
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{06-AdvancedShapeAndTexture_67_0}.png}


\chapter{Thickness in 3D Images}
\label{\detokenize{06-AdvancedShapeAndTexture:thickness-in-3d-images}}
\sphinxAtStartPar
While the examples and demonstrations so far have been shown in 2D, the same exact technique can be applied to 3D data as well. For example for this liquid foam structure


\begin{itemize}
\item {} 
\sphinxAtStartPar
The thickness can be calculated of the background (air) voxels in the same manner.

\item {} 
\sphinxAtStartPar
With care, this can be used as a proxy for bubble size distribution in systems where all the bubbles are connected to it is difficult to identify single ones.

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{skimage}\PYG{n+nn}{.}\PYG{n+nn}{feature} \PYG{k+kn}{import} \PYG{n}{peak\PYGZus{}local\PYGZus{}max}
\PYG{n}{bubble\PYGZus{}candidates} \PYG{o}{=} \PYG{n}{peak\PYGZus{}local\PYGZus{}max}\PYG{p}{(}\PYG{n}{bubble\PYGZus{}dist}\PYG{p}{,} \PYG{n}{min\PYGZus{}distance}\PYG{o}{=}\PYG{l+m+mi}{12}\PYG{p}{)}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Found}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{bubble\PYGZus{}candidates}\PYG{p}{)}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{bubbles}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{n}{thickness\PYGZus{}map} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{zeros}\PYG{p}{(}\PYG{n}{bubble\PYGZus{}dist}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{,} \PYG{n}{dtype}\PYG{o}{=}\PYG{n}{np}\PYG{o}{.}\PYG{n}{float32}\PYG{p}{)}
\PYG{n}{xx}\PYG{p}{,} \PYG{n}{yy}\PYG{p}{,} \PYG{n}{zz} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{meshgrid}\PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{arange}\PYG{p}{(}\PYG{n}{bubble\PYGZus{}dist}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}
                         \PYG{n}{np}\PYG{o}{.}\PYG{n}{arange}\PYG{p}{(}\PYG{n}{bubble\PYGZus{}dist}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}
                         \PYG{n}{np}\PYG{o}{.}\PYG{n}{arange}\PYG{p}{(}\PYG{n}{bubble\PYGZus{}dist}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{p}{)}
                         \PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} sort candidates by size}
\PYG{n}{sorted\PYGZus{}candidates} \PYG{o}{=} \PYG{n+nb}{sorted}\PYG{p}{(}
    \PYG{n}{bubble\PYGZus{}candidates}\PYG{p}{,} \PYG{n}{key}\PYG{o}{=}\PYG{k}{lambda} \PYG{n}{xyz}\PYG{p}{:} \PYG{n}{bubble\PYGZus{}dist}\PYG{p}{[}\PYG{n+nb}{tuple}\PYG{p}{(}\PYG{n}{xyz}\PYG{p}{)}\PYG{p}{]}\PYG{p}{)}
\PYG{k}{for} \PYG{n}{label\PYGZus{}idx}\PYG{p}{,} \PYG{p}{(}\PYG{n}{x}\PYG{p}{,} \PYG{n}{y}\PYG{p}{,} \PYG{n}{z}\PYG{p}{)} \PYG{o+ow}{in} \PYG{n+nb}{enumerate}\PYG{p}{(}\PYG{n}{sorted\PYGZus{}candidates}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{cur\PYGZus{}bubble\PYGZus{}radius} \PYG{o}{=} \PYG{n}{bubble\PYGZus{}dist}\PYG{p}{[}\PYG{n}{x}\PYG{p}{,} \PYG{n}{y}\PYG{p}{,} \PYG{n}{z}\PYG{p}{]}
    \PYG{n}{cur\PYGZus{}bubble} \PYG{o}{=} \PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{power}\PYG{p}{(}\PYG{n}{xx}\PYG{o}{\PYGZhy{}}\PYG{n+nb}{float}\PYG{p}{(}\PYG{n}{y}\PYG{p}{)}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{)} \PYG{o}{+}
                  \PYG{n}{np}\PYG{o}{.}\PYG{n}{power}\PYG{p}{(}\PYG{n}{yy}\PYG{o}{\PYGZhy{}}\PYG{n+nb}{float}\PYG{p}{(}\PYG{n}{x}\PYG{p}{)}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{)} \PYG{o}{+}
                  \PYG{n}{np}\PYG{o}{.}\PYG{n}{power}\PYG{p}{(}\PYG{n}{zz}\PYG{o}{\PYGZhy{}}\PYG{n+nb}{float}\PYG{p}{(}\PYG{n}{z}\PYG{p}{)}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{)}\PYG{p}{)} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{power}\PYG{p}{(}\PYG{n}{cur\PYGZus{}bubble\PYGZus{}radius}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{)}
    \PYG{n}{thickness\PYGZus{}map}\PYG{p}{[}\PYG{n}{cur\PYGZus{}bubble}\PYG{p}{]} \PYG{o}{=} \PYG{n}{cur\PYGZus{}bubble\PYGZus{}radius}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
Found 180 bubbles
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{fig}\PYG{p}{,} \PYG{p}{(}\PYG{n}{ax1}\PYG{p}{,} \PYG{n}{ax2}\PYG{p}{,} \PYG{n}{ax3}\PYG{p}{)} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{12}\PYG{p}{,} \PYG{l+m+mi}{4}\PYG{p}{)}\PYG{p}{,} \PYG{n}{dpi}\PYG{o}{=}\PYG{l+m+mi}{150}\PYG{p}{)}
\PYG{k}{for} \PYG{n}{i}\PYG{p}{,} \PYG{p}{(}\PYG{n}{cax}\PYG{p}{,} \PYG{n}{clabel}\PYG{p}{)} \PYG{o+ow}{in} \PYG{n+nb}{enumerate}\PYG{p}{(}\PYG{n+nb}{zip}\PYG{p}{(}\PYG{p}{[}\PYG{n}{ax1}\PYG{p}{,} \PYG{n}{ax2}\PYG{p}{,} \PYG{n}{ax3}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{xy}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{zy}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{zx}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{cax}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{max}\PYG{p}{(}\PYG{n}{thickness\PYGZus{}map}\PYG{p}{,} \PYG{n}{i}\PYG{p}{)}\PYG{o}{.}\PYG{n}{squeeze}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,}
               \PYG{n}{interpolation}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{none}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{jet}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{cax}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+si}{\PYGZpc{}s}\PYG{l+s+s1}{ Projection}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{\PYGZpc{}} \PYG{n}{clabel}\PYG{p}{)}
    \PYG{n}{cax}\PYG{o}{.}\PYG{n}{set\PYGZus{}xlabel}\PYG{p}{(}\PYG{n}{clabel}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}
    \PYG{n}{cax}\PYG{o}{.}\PYG{n}{set\PYGZus{}ylabel}\PYG{p}{(}\PYG{n}{clabel}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{06-AdvancedShapeAndTexture_70_0}.png}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{fig}\PYG{p}{,} \PYG{p}{(}\PYG{n}{ax1}\PYG{p}{,} \PYG{n}{ax2}\PYG{p}{)} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{18}\PYG{p}{,} \PYG{l+m+mi}{8}\PYG{p}{)}\PYG{p}{,}\PYG{n}{dpi}\PYG{o}{=}\PYG{l+m+mi}{100}\PYG{p}{)}
\PYG{n}{ax1}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{n}{montage\PYGZus{}pad}\PYG{p}{(}\PYG{n}{thickness\PYGZus{}map}\PYG{p}{[}\PYG{p}{:}\PYG{p}{:}\PYG{l+m+mi}{10}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{nipy\PYGZus{}spectral}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax1}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Axial Slices}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax2}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{n}{montage\PYGZus{}pad}\PYG{p}{(}\PYG{n}{thickness\PYGZus{}map}\PYG{o}{.}\PYG{n}{swapaxes}\PYG{p}{(}
    \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{[}\PYG{p}{:}\PYG{p}{:}\PYG{l+m+mi}{10}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{nipy\PYGZus{}spectral}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax2}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Sagittal Slices}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{06-AdvancedShapeAndTexture_71_0}.png}


\chapter{Interactive 3D Views}
\label{\detokenize{06-AdvancedShapeAndTexture:interactive-3d-views}}
\sphinxAtStartPar
Here we can show the thickness map in an interactive 3D manner using the ipyvolume tools (probably only works in the Chrome browser)

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{fig} \PYG{o}{=} \PYG{n}{p3}\PYG{o}{.}\PYG{n}{figure}\PYG{p}{(}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} create a custom LUT}
\PYG{n}{temp\PYGZus{}tf} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{cm}\PYG{o}{.}\PYG{n}{nipy\PYGZus{}spectral}\PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{linspace}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{256}\PYG{p}{)}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} make transparency more aggressive}
\PYG{n}{temp\PYGZus{}tf}\PYG{p}{[}\PYG{p}{:}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{]} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{linspace}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{o}{.}\PYG{l+m+mi}{3}\PYG{p}{,} \PYG{l+m+mf}{0.5}\PYG{p}{,} \PYG{l+m+mi}{256}\PYG{p}{)}\PYG{o}{.}\PYG{n}{clip}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{)}
\PYG{n}{tf} \PYG{o}{=} \PYG{n}{p3}\PYG{o}{.}\PYG{n}{transferfunction}\PYG{o}{.}\PYG{n}{TransferFunction}\PYG{p}{(}\PYG{n}{rgba}\PYG{o}{=}\PYG{n}{temp\PYGZus{}tf}\PYG{p}{)}
\PYG{n}{p3}\PYG{o}{.}\PYG{n}{volshow}\PYG{p}{(}\PYG{p}{(}\PYG{n}{thickness\PYGZus{}map}\PYG{p}{[}\PYG{p}{:}\PYG{p}{:}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{p}{:}\PYG{p}{:}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{p}{:}\PYG{p}{:}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{o}{/}\PYG{n}{thickness\PYGZus{}map}\PYG{o}{.}\PYG{n}{max}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}\PYG{o}{.}\PYG{n}{astype}\PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{float32}\PYG{p}{)}\PYG{p}{,}
           \PYG{n}{lighting}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,}
           \PYG{n}{max\PYGZus{}opacity}\PYG{o}{=}\PYG{l+m+mf}{0.5}\PYG{p}{,}
           \PYG{n}{tf}\PYG{o}{=}\PYG{n}{tf}\PYG{p}{,}
           \PYG{n}{controls}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}

\PYG{n}{p3}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{p3}\PYG{o}{.}\PYG{n}{save}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{bubbles.html}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
VBox(children=(Figure(camera=PerspectiveCamera(fov=45.0, position=(0.0, 0.0, 2.0), projectionMatrix=(1.0, 0.0,…
\end{sphinxVerbatim}


\chapter{Interfaces / Surfaces}
\label{\detokenize{06-AdvancedShapeAndTexture:interfaces-surfaces}}
\sphinxAtStartPar
Many physical and chemical processes occur at surfaces and interfaces and consequently these structures are important in material science and biology. For this lecture surface and interface will be used interchangebly and refers to the boundary between two different materials (calcified bone and soft tissue, magma and water, liquid and gas) Through segmentation we have identified the unique phases in the sample under investigation.
\begin{itemize}
\item {} 
\sphinxAtStartPar
Segmentation identifying volumes (3D) or areas (2D)

\item {} 
\sphinxAtStartPar
Interfaces are one dimension lower corresponding to surface area (3D) or perimeter (2D)

\item {} 
\sphinxAtStartPar
Interfaces are important for

\item {} 
\sphinxAtStartPar
connectivity of cell networks, particularly neurons

\item {} 
\sphinxAtStartPar
material science processes like coarsening or rheological behavior

\item {} 
\sphinxAtStartPar
chemical processes (surface\sphinxhyphen{}bound diffusion, catalyst action)

\end{itemize}


\chapter{Surface Area / Perimeter}
\label{\detokenize{06-AdvancedShapeAndTexture:surface-area-perimeter}}
\sphinxAtStartPar
We see that the dilation and erosion affects are strongly related to the surface area of an object:
\begin{itemize}
\item {} 
\sphinxAtStartPar
the more surface area

\item {} 
\sphinxAtStartPar
the larger the effect of a single dilation or erosion step.

\end{itemize}


\chapter{Meshing}
\label{\detokenize{06-AdvancedShapeAndTexture:meshing}}
\sphinxAtStartPar
The process of turning a (connected) set of pixels into a list of vertices and edges
\begin{itemize}
\item {} 
\sphinxAtStartPar
For these vertices and edges we can define forces.

\item {} 
\sphinxAtStartPar
Most crucially this comes when looking at physical processes like deformation.

\item {} 
\sphinxAtStartPar
Meshes are also useful for visualization.

\end{itemize}

\sphinxAtStartPar
\sphinxincludegraphics{{Approx-3tori}.png}

\sphinxAtStartPar
\sphinxstylestrong{Example}

\sphinxAtStartPar
Looking at stress\sphinxhyphen{}strain relationships in mechanics using Hooke’s Model
\begin{equation*}
\begin{split} \vec{F}=k (\vec{x}_0-\vec{x}) \end{split}
\end{equation*}
\sphinxAtStartPar
the force needed to stretch one of these edges is proportional to how far it is stretched.


\section{Meshing of images}
\label{\detokenize{06-AdvancedShapeAndTexture:meshing-of-images}}
\sphinxAtStartPar
Since we uses voxels to image and identify the volume we can use the voxels themselves as an approimation for the surface of the structure.
\begin{itemize}
\item {} 
\sphinxAtStartPar
Each ‘exposed’ face of a voxel belongs to the surface

\end{itemize}

\sphinxAtStartPar
From this we can create a mesh by
\begin{itemize}
\item {} 
\sphinxAtStartPar
adding each exposed voxel face to a list of surface squares.

\item {} 
\sphinxAtStartPar
adding connectivity information for the different squares (shared edges and vertices)

\end{itemize}

\sphinxAtStartPar
A wide variety of methods of which we will only graze the surface (\sphinxurl{http://en.wikipedia.org/wiki/Image-based\_meshing})


\section{Marching Cubes}
\label{\detokenize{06-AdvancedShapeAndTexture:marching-cubes}}
\sphinxAtStartPar
\sphinxstylestrong{Why}

\sphinxAtStartPar
Voxels are very poor approximations for the surface and are very rough (they are either normal to the x, y, or z axis and nothing between).

\sphinxAtStartPar
Because of their inherently orthogonal surface normals, any analysis which utilizes the surface normal to calculate another value (growth, curvature, etc) is going to be very inaccurate at best and very wrong at worst.



\sphinxAtStartPar
\sphinxstylestrong{How} (\sphinxurl{https://en.wikipedia.org/wiki/Marching\_cubes})

\sphinxAtStartPar
The image is processed one voxel at a time and the neighborhood (not quite the same is the morphological definition) is checked at every voxel. From this configuration of values, faces are added to the mesh to incorporate the most simple surface which would explain the values.
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
The 2x2x2 neighborhood is checked at every voxel.

\item {} 
\sphinxAtStartPar
Different faces are assigned depending on the neighborhood configuration.

\end{enumerate}

\sphinxAtStartPar
This algortihm is nicely explained in this \sphinxhref{https://youtu.be/M3iI2l0ltbE}{video}

\sphinxAtStartPar
\sphinxhref{http://en.wikipedia.org/wiki/Marching\_tetrahedra}{Marching tetrahedra} is for some applications a better suited approach


\chapter{Curvature}
\label{\detokenize{06-AdvancedShapeAndTexture:curvature}}
\sphinxAtStartPar
Curvature is a metric related to the surface or interface between phases or objects.
\begin{itemize}
\item {} 
\sphinxAtStartPar
It is most easily understood in its 1D sense or being the radius of the circle that matchs the local shape of a curve

\end{itemize}

\sphinxAtStartPar
\sphinxincludegraphics{{250px-Osculating_circle.svg}.png}
\begin{itemize}
\item {} 
\sphinxAtStartPar
Mathematically it is defined as

\end{itemize}
\begin{equation*}
\begin{split} \kappa = \frac{1}{R} \end{split}
\end{equation*}\begin{itemize}
\item {} 
\sphinxAtStartPar
Thus a low curvature means the value means a very large radius

\item {} 
\sphinxAtStartPar
and high curvature means a very small radius

\end{itemize}


\section{Curvature: Surface Normal}
\label{\detokenize{06-AdvancedShapeAndTexture:curvature-surface-normal}}
\sphinxAtStartPar
In order to meaningfully talk about curvatures of surfaces, we first need to define a consistent frame of reference for examining the surface of an object.

\sphinxAtStartPar
We thus define a surface normal vector as a vector oriented orthogonally to the surface away from the interior of the object \(\rightarrow \vec{N}\)




\section{Curvature in 3D}
\label{\detokenize{06-AdvancedShapeAndTexture:curvature-in-3d}}
\sphinxAtStartPar
With the notion of surface normal defined (\(\vec{N}\)), we can define many curvatures at point \(\vec{x}\) on the surface.
\begin{itemize}
\item {} 
\sphinxAtStartPar
This is because there are infinitely many planes which contain both point \(\vec{x}\) and \(\vec{N}\)

\item {} 
\sphinxAtStartPar
More generally we can define an angle \(\theta\) about which a single plane containing both can be freely rotated

\item {} 
\sphinxAtStartPar
We can then define two principal curvatures by taking the maximum and minimum of this curve

\end{itemize}
\begin{equation*}
\begin{split} \kappa_1 = \textrm{max}(\kappa(\theta)) \end{split}
\end{equation*}\begin{equation*}
\begin{split} \kappa_2 = \textrm{min}(\kappa(\theta)) \end{split}
\end{equation*}

\subsection{Mean Curvature}
\label{\detokenize{06-AdvancedShapeAndTexture:mean-curvature}}
\sphinxAtStartPar
The mean of the two principal curvatures
\$\( H = \frac{1}{2}(\kappa_1+\kappa_2) \)\$


\subsection{Gaussian Curvature}
\label{\detokenize{06-AdvancedShapeAndTexture:gaussian-curvature}}
\sphinxAtStartPar
The product of the two principal curvatures
\$\( K = \kappa_1\kappa_2 \)\$
\begin{itemize}
\item {} 
\sphinxAtStartPar
positive for spheres (or spherical inclusions)

\item {} 
\sphinxAtStartPar
curvatures agree in sign

\item {} 
\sphinxAtStartPar
negative for saddles (hyperboloid surfaces)

\item {} 
\sphinxAtStartPar
curvatures disgree in sign

\item {} 
\sphinxAtStartPar
0 for planes

\end{itemize}


\section{Curvature: 3D Examples}
\label{\detokenize{06-AdvancedShapeAndTexture:curvature-3d-examples}}
\sphinxAtStartPar
Examining a complex structure with no meaningful ellipsoidal or watershed model.

\sphinxAtStartPar
The images themselves show the type of substructures and shapes which are present in the sample.


\begin{itemize}
\item {} 
\sphinxAtStartPar
the comparative amount of surface at, above, and below 0

\item {} 
\sphinxAtStartPar
from spherical particles into annealed mesh of balls

\end{itemize}




\section{Characteristic Shape}
\label{\detokenize{06-AdvancedShapeAndTexture:characteristic-shape}}
\sphinxAtStartPar
Characteristic shape can be calculated by
\begin{itemize}
\item {} 
\sphinxAtStartPar
measuring principal curvatures and normalizing them by scaling to the structure size.

\item {} 
\sphinxAtStartPar
A distribution of these curvatures then provides shape information on a structure indepedent of the size.




\end{itemize}

\sphinxAtStartPar
For example a structure transitioning from a collection of perfectly spherical particles to a annealed solid will go
\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstylestrong{from} having many round spherical faces with positive gaussian curvature

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{to} many saddles and more complicated structures with 0 or negative curvature.

\end{itemize}


\section{Curvature: Take Home Message}
\label{\detokenize{06-AdvancedShapeAndTexture:curvature-take-home-message}}
\sphinxAtStartPar
It provides another metric for characterizing complex shapes
\begin{itemize}
\item {} 
\sphinxAtStartPar
Particularly useful for examining interfaces

\item {} 
\sphinxAtStartPar
Folds,

\item {} 
\sphinxAtStartPar
saddles,

\item {} 
\sphinxAtStartPar
and many other types of points that are not characterized well with ellipsoids or thickness maps

\item {} 
\sphinxAtStartPar
Provides a scale\sphinxhyphen{}free metric for assessing structures

\item {} 
\sphinxAtStartPar
Can provide visual indications of structural changes

\end{itemize}


\chapter{Other Techniques}
\label{\detokenize{06-AdvancedShapeAndTexture:other-techniques}}
\sphinxAtStartPar
There are hundreds of other techniques which can be applied to these complicated structures, but they go beyond the scope of this course.

\sphinxAtStartPar
Many of them are model\sphinxhyphen{}based which means they work well but only for particular types of samples or images.

\sphinxAtStartPar
Of the more general techniques several which are easily testable inside of FIJI are
\begin{itemize}
\item {} 
\sphinxAtStartPar
Directional Analysis = Looking at the orientation of different components using Fourier analysis (\sphinxstyleemphasis{Analyze} \(\rightarrow\) \sphinxstyleemphasis{Directionality})

\item {} 
\sphinxAtStartPar
Tubeness / Surfaceness (\sphinxstyleemphasis{Plugins} \(\rightarrow\) \sphinxstyleemphasis{Analyze} \(\rightarrow\)) characterize binary images and the shape at each point similar to curvature but with a different underlying model

\end{itemize}


\section{References to other techniques}
\label{\detokenize{06-AdvancedShapeAndTexture:references-to-other-techniques}}\begin{itemize}
\item {} 
\sphinxAtStartPar
Fractal Dimensionality = A metric for assessing the structure as you scale up and down by examining various spatial relationships

\item {} 
\sphinxAtStartPar
Ma, D., Stoica, A. D., \& Wang, X.\sphinxhyphen{}L. (2009). Power\sphinxhyphen{}law scaling and fractal nature of medium\sphinxhyphen{}range order in metallic glasses. Nature Materials, 8(1), 30\textendash{}4. doi:10.1038/nmat2340

\item {} 
\sphinxAtStartPar
Two (or more) point correlation functions = Used in theoretical material science and physics to describe random materials and can be used to characterize distances, orientations, and organization in complex samples

\item {} 
\sphinxAtStartPar
Jiao, Y., Stillinger, F., \& Torquato, S. (2007). Modeling heterogeneous materials via two\sphinxhyphen{}point correlation functions: Basic principles. Physical Review E, 76(3). doi:10.1103/PhysRevE.76.031110

\item {} 
\sphinxAtStartPar
Andrey, P., Kiêu, K., Kress, C., Lehmann, G., Tirichine, L., Liu, Z., … Debey, P. (2010). Statistical analysis of 3D images detects regular spatial distributions of centromeres and chromocenters in animal and plant nuclei. PLoS Computational Biology, 6(7), e1000853. doi:10.1371/journal.pcbi.1000853

\item {} 
\sphinxAtStartPar
Haghpanahi, M., \& Miramini, S. (2008). Extraction of morphological parameters of tissue engineering scaffolds using two\sphinxhyphen{}point correlation function, 463\textendash{}466. Retrieved from \sphinxurl{http://portal.acm.org/citation.cfm?id=1713360.1713456}

\end{itemize}


\chapter{Texture Analysis}
\label{\detokenize{06-AdvancedShapeAndTexture:texture-analysis}}
\sphinxAtStartPar
The world is full of patterns (aka Textures)



\sphinxAtStartPar
\sphinxhref{https://www.cs.auckland.ac.nz/~georgy/research/texture/thesis-html/node5.html}{Example taken from}

\sphinxAtStartPar
Some metrics to characterize textures
\sphinxhref{http://murphylab.web.cmu.edu/publications/boland/boland\_node26.html}{Haralick texture features}


\section{Sample Textures}
\label{\detokenize{06-AdvancedShapeAndTexture:sample-textures}}
\sphinxAtStartPar
Let’s create some sample textures

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{x}\PYG{p}{,} \PYG{n}{y} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{meshgrid}\PYG{p}{(}\PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{8}\PYG{p}{)}\PYG{p}{,} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{8}\PYG{p}{)}\PYG{p}{)}

\PYG{k}{def} \PYG{n+nf}{blur\PYGZus{}img}\PYG{p}{(}\PYG{n}{c\PYGZus{}img}\PYG{p}{)}\PYG{p}{:} \PYG{k}{return} \PYG{p}{(}\PYG{n}{ndimage}\PYG{o}{.}\PYG{n}{zoom}\PYG{p}{(}\PYG{n}{c\PYGZus{}img}\PYG{o}{.}\PYG{n}{astype}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{float}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
                                          \PYG{l+m+mi}{3}\PYG{p}{,}
                                          \PYG{n}{order}\PYG{o}{=}\PYG{l+m+mi}{3}\PYG{p}{,}
                                          \PYG{n}{prefilter}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}\PYG{o}{*}\PYG{l+m+mi}{4}\PYG{p}{)}\PYG{o}{.}\PYG{n}{astype}\PYG{p}{(}\PYG{n+nb}{int}\PYG{p}{)}\PYG{o}{.}\PYG{n}{clip}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{4}\PYG{p}{)}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}

\PYG{n}{text\PYGZus{}imgs} \PYG{o}{=} \PYG{p}{[}\PYG{n}{blur\PYGZus{}img}\PYG{p}{(}\PYG{n}{c\PYGZus{}img}\PYG{p}{)}
             \PYG{k}{for} \PYG{n}{c\PYGZus{}img} \PYG{o+ow}{in} \PYG{p}{[}\PYG{n}{x} \PYG{o}{\PYGZpc{}} \PYG{l+m+mi}{2}\PYG{p}{,}
                           \PYG{n}{y} \PYG{o}{\PYGZpc{}} \PYG{l+m+mi}{2}\PYG{p}{,}
                           \PYG{p}{(}\PYG{n}{x} \PYG{o}{\PYGZpc{}} \PYG{l+m+mi}{2}\PYG{o}{+}\PYG{n}{y} \PYG{o}{\PYGZpc{}} \PYG{l+m+mi}{2}\PYG{p}{)}\PYG{o}{/}\PYG{l+m+mf}{2.0}\PYG{p}{,}
                           \PYG{p}{(}\PYG{n}{x} \PYG{o}{\PYGZpc{}} \PYG{l+m+mi}{4}\PYG{o}{+}\PYG{n}{y} \PYG{o}{\PYGZpc{}} \PYG{l+m+mi}{2}\PYG{p}{)}\PYG{o}{/}\PYG{l+m+mf}{2.5}\PYG{p}{,}
                           \PYG{p}{(}\PYG{n}{x} \PYG{o}{\PYGZpc{}} \PYG{l+m+mi}{4}\PYG{o}{+}\PYG{n}{y} \PYG{o}{\PYGZpc{}} \PYG{l+m+mi}{3}\PYG{p}{)}\PYG{o}{/}\PYG{l+m+mf}{3.5}\PYG{p}{,}
                           \PYG{p}{(}\PYG{p}{(}\PYG{n}{x}\PYG{o}{+}\PYG{n}{y}\PYG{p}{)} \PYG{o}{\PYGZpc{}} \PYG{l+m+mi}{3}\PYG{p}{)}\PYG{o}{/}\PYG{l+m+mf}{2.0}\PYG{p}{]}\PYG{p}{]}

\PYG{n}{fig}\PYG{p}{,} \PYG{n}{m\PYGZus{}axs} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{20}\PYG{p}{,} \PYG{l+m+mi}{10}\PYG{p}{)}\PYG{p}{)}

\PYG{k}{for} \PYG{n}{c\PYGZus{}ax}\PYG{p}{,} \PYG{n}{c\PYGZus{}img} \PYG{o+ow}{in} \PYG{n+nb}{zip}\PYG{p}{(}\PYG{n}{m\PYGZus{}axs}\PYG{o}{.}\PYG{n}{flatten}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,} \PYG{n}{text\PYGZus{}imgs}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{c\PYGZus{}ax}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{n}{c\PYGZus{}img}\PYG{p}{,}\PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{viridis}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{vmin}\PYG{o}{=}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{n}{vmax}\PYG{o}{=}\PYG{l+m+mi}{3}\PYG{p}{)}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{06-AdvancedShapeAndTexture_96_0}.png}


\section{Methods to characterize textures: Co\sphinxhyphen{}occurrence matrix}
\label{\detokenize{06-AdvancedShapeAndTexture:methods-to-characterize-textures-co-occurrence-matrix}}\begin{equation*}
\begin{split}
C_{\Delta x, \Delta y}(i,j)=\sum_{x=1}^n\sum_{y=1}^m\begin{cases} 1, & \text{if }I(x, y)=i\text{ and }I(x+\Delta x, y+\Delta y)=j \\ 0, & \text{otherwise}\end{cases}
\end{split}
\end{equation*}\begin{itemize}
\item {} 
\sphinxAtStartPar
As text \(\rightarrow\) for every possible offset \(\vec{r}\) = (\(\Delta x\), \(\Delta y\)) given the current intensity (\(i\)) how likely is it that value at a point offset by that amount is \(j\).

\item {} 
\sphinxAtStartPar
This is similar to the two point correlation function but is a 4D representation instead of just a 2D

\item {} 
\sphinxAtStartPar
In order to use this we need to discretize the image into bins

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{montage\PYGZus{}nd}\PYG{p}{(}\PYG{n}{in\PYGZus{}img}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{if} \PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{in\PYGZus{}img}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{)} \PYG{o}{\PYGZgt{}} \PYG{l+m+mi}{3}\PYG{p}{:}
        \PYG{k}{return} \PYG{n}{montage2d}\PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{stack}\PYG{p}{(}\PYG{p}{[}\PYG{n}{montage\PYGZus{}nd}\PYG{p}{(}\PYG{n}{x\PYGZus{}slice}\PYG{p}{)} \PYG{k}{for} \PYG{n}{x\PYGZus{}slice} \PYG{o+ow}{in} \PYG{n}{in\PYGZus{}img}\PYG{p}{]}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{)}\PYG{p}{)}
    \PYG{k}{elif} \PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{in\PYGZus{}img}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{)} \PYG{o}{==} \PYG{l+m+mi}{3}\PYG{p}{:}
        \PYG{k}{return} \PYG{n}{montage2d}\PYG{p}{(}\PYG{n}{in\PYGZus{}img}\PYG{p}{)}
    \PYG{k}{else}\PYG{p}{:}
        \PYG{n}{warn}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Input less than 3d image, returning original}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n+ne}{RuntimeWarning}\PYG{p}{)}
        \PYG{k}{return} \PYG{n}{in\PYGZus{}img}


\PYG{n}{dist\PYGZus{}list}  \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{linspace}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{6}\PYG{p}{,} \PYG{l+m+mi}{15}\PYG{p}{)}
\PYG{n}{angle\PYGZus{}list} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{linspace}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{o}{*}\PYG{n}{np}\PYG{o}{.}\PYG{n}{pi}\PYG{p}{,} \PYG{l+m+mi}{15}\PYG{p}{)}

\PYG{k}{def} \PYG{n+nf}{calc\PYGZus{}coomatrix}\PYG{p}{(}\PYG{n}{in\PYGZus{}img}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{return} \PYG{n}{greycomatrix}\PYG{p}{(}\PYG{n}{image}\PYG{o}{=}\PYG{n}{in\PYGZus{}img}\PYG{p}{,}
                        \PYG{n}{distances}\PYG{o}{=}\PYG{n}{dist\PYGZus{}list}\PYG{p}{,}
                        \PYG{n}{angles}\PYG{o}{=}\PYG{n}{angle\PYGZus{}list}\PYG{p}{,}
                        \PYG{n}{levels}\PYG{o}{=}\PYG{l+m+mi}{4}\PYG{p}{)}

\PYG{k}{def} \PYG{n+nf}{coo\PYGZus{}tensor\PYGZus{}to\PYGZus{}df}\PYG{p}{(}\PYG{n}{x}\PYG{p}{)}\PYG{p}{:} \PYG{k}{return} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}
    \PYG{n}{np}\PYG{o}{.}\PYG{n}{stack}\PYG{p}{(}\PYG{p}{[}\PYG{n}{x}\PYG{o}{.}\PYG{n}{ravel}\PYG{p}{(}\PYG{p}{)}\PYG{p}{]}\PYG{o}{+}\PYG{p}{[}\PYG{n}{c\PYGZus{}vec}\PYG{o}{.}\PYG{n}{ravel}\PYG{p}{(}\PYG{p}{)} \PYG{k}{for} \PYG{n}{c\PYGZus{}vec} \PYG{o+ow}{in} \PYG{n}{np}\PYG{o}{.}\PYG{n}{meshgrid}\PYG{p}{(}\PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{x}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}
                                                                 \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{x}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}
                                                                 \PYG{n}{dist\PYGZus{}list}\PYG{p}{,}
                                                                 \PYG{n}{angle\PYGZus{}list}\PYG{p}{,}
                                                                 \PYG{n}{indexing}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{xy}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,} \PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{,}
    \PYG{n}{columns}\PYG{o}{=}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{E}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{i}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{j}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{d}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{theta}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}


\PYG{n}{coo\PYGZus{}tensor\PYGZus{}to\PYGZus{}df}\PYG{p}{(}\PYG{n}{calc\PYGZus{}coomatrix}\PYG{p}{(}\PYG{n}{text\PYGZus{}imgs}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}\PYG{o}{.}\PYG{n}{sample}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
          E    i    j         d     theta
805     0.0  3.0  0.0  3.857143  4.487990
1213   23.0  1.0  1.0  2.785714  5.834386
2518    0.0  3.0  2.0  1.714286  5.834386
3197    0.0  2.0  3.0  2.071429  0.897598
286   184.0  1.0  0.0  2.428571  0.448799
\end{sphinxVerbatim}


\subsection{Co\sphinxhyphen{}occurence matrices for the test patterns}
\label{\detokenize{06-AdvancedShapeAndTexture:co-occurence-matrices-for-the-test-patterns}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{fig}\PYG{p}{,} \PYG{n}{m\PYGZus{}axs} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{3}\PYG{p}{,} \PYG{l+m+mi}{6}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{15}\PYG{p}{,} \PYG{l+m+mi}{10}\PYG{p}{)}\PYG{p}{,} \PYG{n}{dpi}\PYG{o}{=}\PYG{l+m+mi}{150}\PYG{p}{)}

\PYG{k}{for} \PYG{p}{(}\PYG{n}{c\PYGZus{}ax}\PYG{p}{,} \PYG{n}{d\PYGZus{}ax}\PYG{p}{,} \PYG{n}{f\PYGZus{}ax}\PYG{p}{)}\PYG{p}{,} \PYG{n}{c\PYGZus{}img} \PYG{o+ow}{in} \PYG{n+nb}{zip}\PYG{p}{(}\PYG{n}{m\PYGZus{}axs}\PYG{o}{.}\PYG{n}{T}\PYG{p}{,} \PYG{n}{text\PYGZus{}imgs}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{c\PYGZus{}ax}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{n}{c\PYGZus{}img}\PYG{p}{,} \PYG{n}{vmin}\PYG{o}{=}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{n}{vmax}\PYG{o}{=}\PYG{l+m+mi}{4}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{gray}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;} \PYG{n}{c\PYGZus{}ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Pattern}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{full\PYGZus{}coo\PYGZus{}matrix} \PYG{o}{=} \PYG{n}{calc\PYGZus{}coomatrix}\PYG{p}{(}\PYG{n}{c\PYGZus{}img}\PYG{p}{)}
    \PYG{n}{d\PYGZus{}ax}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{n}{montage\PYGZus{}nd}\PYG{p}{(}\PYG{n}{full\PYGZus{}coo\PYGZus{}matrix}\PYG{p}{)}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{gray}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{d\PYGZus{}ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Co\PYGZhy{}occurence Matrix}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s+si}{\PYGZob{}\PYGZcb{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{full\PYGZus{}coo\PYGZus{}matrix}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{)}\PYG{p}{)}
    \PYG{n}{d\PYGZus{}ax}\PYG{o}{.}\PYG{n}{axis}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{off}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{avg\PYGZus{}coo\PYGZus{}matrix} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{n}{full\PYGZus{}coo\PYGZus{}matrix}\PYG{o}{*}\PYG{l+m+mf}{1.0}\PYG{p}{,} \PYG{n}{axis}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{)}
    \PYG{n}{f\PYGZus{}ax}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{n}{avg\PYGZus{}coo\PYGZus{}matrix}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{gray}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{f\PYGZus{}ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Average Co\PYGZhy{}occurence}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s+si}{\PYGZob{}\PYGZcb{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{avg\PYGZus{}coo\PYGZus{}matrix}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{)}\PYG{p}{)}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{06-AdvancedShapeAndTexture_100_0}.png}


\section{Simple Correlation}
\label{\detokenize{06-AdvancedShapeAndTexture:simple-correlation}}
\sphinxAtStartPar
Using the mean difference (\(E[i-j]\)) instead of all of the i,j pair possiblities

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{text\PYGZus{}df} \PYG{o}{=} \PYG{n}{coo\PYGZus{}tensor\PYGZus{}to\PYGZus{}df}\PYG{p}{(}\PYG{n}{calc\PYGZus{}coomatrix}\PYG{p}{(}\PYG{n}{text\PYGZus{}imgs}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{text\PYGZus{}df}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ij\PYGZus{}diff}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{text\PYGZus{}df}\PYG{o}{.}\PYG{n}{apply}\PYG{p}{(}\PYG{k}{lambda} \PYG{n}{x}\PYG{p}{:} \PYG{n}{x}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{i}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{\PYGZhy{}}\PYG{n}{x}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{j}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,} \PYG{n}{axis}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{)}

\PYG{n}{simple\PYGZus{}corr\PYGZus{}df} \PYG{o}{=} \PYG{n}{text\PYGZus{}df}\PYG{o}{.}\PYG{n}{groupby}\PYG{p}{(}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ij\PYGZus{}diff}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{d}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{theta}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}\PYG{o}{.}\PYG{n}{agg}\PYG{p}{(}\PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{E}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{mean}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{\PYGZcb{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{reset\PYGZus{}index}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{simple\PYGZus{}corr\PYGZus{}df}\PYG{o}{.}\PYG{n}{sample}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}\PYG{o}{.}\PYG{n}{round}\PYG{p}{(}\PYG{n}{decimals}\PYG{o}{=}\PYG{l+m+mi}{3}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
     ij\PYGZus{}diff      d  theta     E
53      \PYGZhy{}3.0  2.071  3.590   0.0
719      0.0  1.714  6.283  48.0
63      \PYGZhy{}3.0  2.429  1.346   0.0
813      0.0  4.214  1.346  80.0
112     \PYGZhy{}3.0  3.500  3.142   0.0
\end{sphinxVerbatim}


\subsection{Inspecting the mean difference}
\label{\detokenize{06-AdvancedShapeAndTexture:inspecting-the-mean-difference}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{grouped\PYGZus{}weighted\PYGZus{}avg}\PYG{p}{(}\PYG{n}{values}\PYG{p}{,} \PYG{n}{weights}\PYG{p}{,} \PYG{n}{by}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{return} \PYG{p}{(}\PYG{n}{values} \PYG{o}{*} \PYG{n}{weights}\PYG{p}{)}\PYG{o}{.}\PYG{n}{groupby}\PYG{p}{(}\PYG{n}{by}\PYG{p}{)}\PYG{o}{.}\PYG{n}{sum}\PYG{p}{(}\PYG{p}{)} \PYG{o}{/} \PYG{n}{weights}\PYG{o}{.}\PYG{n}{groupby}\PYG{p}{(}\PYG{n}{by}\PYG{p}{)}\PYG{o}{.}\PYG{n}{sum}\PYG{p}{(}\PYG{p}{)}


\PYG{n}{fig}\PYG{p}{,} \PYG{n}{m\PYGZus{}axs} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{3}\PYG{p}{,} \PYG{l+m+mi}{6}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{20}\PYG{p}{,} \PYG{l+m+mi}{10}\PYG{p}{)}\PYG{p}{)}

\PYG{k}{for} \PYG{p}{(}\PYG{n}{c\PYGZus{}ax}\PYG{p}{,} \PYG{n}{d\PYGZus{}ax}\PYG{p}{,} \PYG{n}{f\PYGZus{}ax}\PYG{p}{)}\PYG{p}{,} \PYG{n}{c\PYGZus{}img} \PYG{o+ow}{in} \PYG{n+nb}{zip}\PYG{p}{(}\PYG{n}{m\PYGZus{}axs}\PYG{o}{.}\PYG{n}{T}\PYG{p}{,} \PYG{n}{text\PYGZus{}imgs}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{c\PYGZus{}ax}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{n}{c\PYGZus{}img}\PYG{p}{,} \PYG{n}{vmin}\PYG{o}{=}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{n}{vmax}\PYG{o}{=}\PYG{l+m+mi}{4}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{gray}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{c\PYGZus{}ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Pattern}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{full\PYGZus{}coo\PYGZus{}matrix} \PYG{o}{=} \PYG{n}{calc\PYGZus{}coomatrix}\PYG{p}{(}\PYG{n}{c\PYGZus{}img}\PYG{p}{)}
    \PYG{n}{text\PYGZus{}df} \PYG{o}{=} \PYG{n}{coo\PYGZus{}tensor\PYGZus{}to\PYGZus{}df}\PYG{p}{(}\PYG{n}{full\PYGZus{}coo\PYGZus{}matrix}\PYG{p}{)}
    \PYG{n}{text\PYGZus{}df}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ij\PYGZus{}diff}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{text\PYGZus{}df}\PYG{o}{.}\PYG{n}{apply}\PYG{p}{(}\PYG{k}{lambda} \PYG{n}{x}\PYG{p}{:} \PYG{n}{x}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{i}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{\PYGZhy{}}\PYG{n}{x}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{j}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,} \PYG{n}{axis}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{)}

    \PYG{n}{simple\PYGZus{}corr\PYGZus{}df} \PYG{o}{=} \PYG{n}{text\PYGZus{}df}\PYG{o}{.}\PYG{n}{groupby}\PYG{p}{(}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ij\PYGZus{}diff}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{d}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{theta}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}\PYG{o}{.}\PYG{n}{agg}\PYG{p}{(}\PYG{p}{\PYGZob{}}
        \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{E}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sum}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{\PYGZcb{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{reset\PYGZus{}index}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{gwa\PYGZus{}d} \PYG{o}{=} \PYG{n}{grouped\PYGZus{}weighted\PYGZus{}avg}\PYG{p}{(}
        \PYG{n}{simple\PYGZus{}corr\PYGZus{}df}\PYG{o}{.}\PYG{n}{ij\PYGZus{}diff}\PYG{p}{,} \PYG{n}{simple\PYGZus{}corr\PYGZus{}df}\PYG{o}{.}\PYG{n}{E}\PYG{p}{,} \PYG{n}{simple\PYGZus{}corr\PYGZus{}df}\PYG{o}{.}\PYG{n}{d}\PYG{p}{)}
    \PYG{n}{d\PYGZus{}ax}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{gwa\PYGZus{}d}\PYG{o}{.}\PYG{n}{index}\PYG{p}{,} \PYG{n}{gwa\PYGZus{}d}\PYG{o}{.}\PYG{n}{values}\PYG{p}{)}
    \PYG{n}{d\PYGZus{}ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Distance Co\PYGZhy{}occurence}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

    \PYG{n}{gwa\PYGZus{}theta} \PYG{o}{=} \PYG{n}{grouped\PYGZus{}weighted\PYGZus{}avg}\PYG{p}{(}
        \PYG{n}{simple\PYGZus{}corr\PYGZus{}df}\PYG{o}{.}\PYG{n}{ij\PYGZus{}diff}\PYG{p}{,} \PYG{n}{simple\PYGZus{}corr\PYGZus{}df}\PYG{o}{.}\PYG{n}{E}\PYG{p}{,} \PYG{n}{simple\PYGZus{}corr\PYGZus{}df}\PYG{o}{.}\PYG{n}{theta}\PYG{p}{)}
    \PYG{n}{f\PYGZus{}ax}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{gwa\PYGZus{}theta}\PYG{o}{.}\PYG{n}{index}\PYG{p}{,} \PYG{n}{gwa\PYGZus{}theta}\PYG{o}{.}\PYG{n}{values}\PYG{p}{)}
    \PYG{n}{f\PYGZus{}ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Angular Co\PYGZhy{}occurence}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{06-AdvancedShapeAndTexture_104_0}.png}


\section{Applying Texture analysis to Brain}
\label{\detokenize{06-AdvancedShapeAndTexture:applying-texture-analysis-to-brain}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{cortex\PYGZus{}img} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{clip}\PYG{p}{(}\PYG{n}{imread}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{figures/example\PYGZus{}poster.tif}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
                     \PYG{p}{[}\PYG{p}{:}\PYG{p}{:}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{p}{:}\PYG{p}{:}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{o}{/}\PYG{l+m+mi}{270}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{255}\PYG{p}{)}\PYG{o}{.}\PYG{n}{astype}\PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{uint8}\PYG{p}{)}

\PYG{n}{cortex\PYGZus{}mask} \PYG{o}{=} \PYG{n}{imread}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{figures/example\PYGZus{}poster\PYGZus{}mask.tif}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{[}\PYG{p}{:}\PYG{p}{:}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{p}{:}\PYG{p}{:}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{/}\PYG{l+m+mf}{255.0}

\PYG{c+c1}{\PYGZsh{} show the slice and threshold}
\PYG{n}{fig}\PYG{p}{,} \PYG{p}{(}\PYG{n}{ax1}\PYG{p}{,} \PYG{n}{ax2}\PYG{p}{,} \PYG{n}{ax3}\PYG{p}{)} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{11}\PYG{p}{,} \PYG{l+m+mi}{5}\PYG{p}{)}\PYG{p}{,}\PYG{n}{dpi}\PYG{o}{=}\PYG{l+m+mi}{100}\PYG{p}{)}
\PYG{n}{ax1}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{n}{cortex\PYGZus{}img}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{gray}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;} \PYG{n}{ax1}\PYG{o}{.}\PYG{n}{axis}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{off}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)} \PYG{p}{;} \PYG{n}{ax1}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Image}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax2}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{n}{cortex\PYGZus{}mask}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{gray}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;} \PYG{n}{ax2}\PYG{o}{.}\PYG{n}{axis}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{off}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;} \PYG{n}{ax2}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Segmentation}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} here we mark the threshold on the original image}

\PYG{n}{ax3}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{n}{label2rgb}\PYG{p}{(}\PYG{n}{cortex\PYGZus{}mask} \PYG{o}{\PYGZgt{}} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{n}{cortex\PYGZus{}img}\PYG{p}{,} \PYG{n}{bg\PYGZus{}label}\PYG{o}{=}\PYG{l+m+mi}{0}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{ax3}\PYG{o}{.}\PYG{n}{axis}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{off}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;} \PYG{n}{ax3}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Overlayed}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{06-AdvancedShapeAndTexture_106_0}.png}


\section{Tiling the image}
\label{\detokenize{06-AdvancedShapeAndTexture:tiling-the-image}}
\sphinxAtStartPar
Here we divide the image up into unique tiles for further processing. Each tile is 48\(\times{}\)48 pixels.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{xx}\PYG{p}{,} \PYG{n}{yy} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{meshgrid}\PYG{p}{(}
    \PYG{n}{np}\PYG{o}{.}\PYG{n}{arange}\PYG{p}{(}\PYG{n}{cortex\PYGZus{}img}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}
    \PYG{n}{np}\PYG{o}{.}\PYG{n}{arange}\PYG{p}{(}\PYG{n}{cortex\PYGZus{}img}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{region\PYGZus{}labels} \PYG{o}{=} \PYG{p}{(}\PYG{n}{xx}\PYG{o}{/}\PYG{o}{/}\PYG{l+m+mi}{48}\PYG{p}{)} \PYG{o}{*} \PYG{l+m+mi}{64}\PYG{o}{+}\PYG{n}{yy}\PYG{o}{/}\PYG{o}{/}\PYG{l+m+mi}{48}
\PYG{n}{region\PYGZus{}labels} \PYG{o}{=} \PYG{n}{region\PYGZus{}labels}\PYG{o}{.}\PYG{n}{astype}\PYG{p}{(}\PYG{n+nb}{int}\PYG{p}{)}
\PYG{n}{sns}\PYG{o}{.}\PYG{n}{heatmap}\PYG{p}{(}\PYG{n}{region\PYGZus{}labels}\PYG{p}{[}\PYG{p}{:}\PYG{p}{:}\PYG{l+m+mi}{48}\PYG{p}{,} \PYG{p}{:}\PYG{p}{:}\PYG{l+m+mi}{48}\PYG{p}{]}\PYG{o}{.}\PYG{n}{astype}\PYG{p}{(}\PYG{n+nb}{int}\PYG{p}{)}\PYG{p}{,}
            \PYG{n}{annot}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,}
            \PYG{n}{fmt}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{03d}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
            \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{nipy\PYGZus{}spectral}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
            \PYG{n}{cbar}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{,}
            \PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{06-AdvancedShapeAndTexture_108_0}.png}


\section{Calculating Texture}
\label{\detokenize{06-AdvancedShapeAndTexture:calculating-texture}}
\sphinxAtStartPar
Here we calculate the texture by using a tool called the gray level co\sphinxhyphen{}occurrence matrix which are part of the \sphinxhref{http://scikit-image.org/docs/dev/auto\_examples/features\_detection/plot\_glcm.html}{features library in skimage}. We focus on two metrics in this, specifically dissimilarity and correlation which we calculate for each tile. We then want to see which of these parameters correlated best with belonging to a nerve fiber.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} compute some gray level co\PYGZhy{}occurrence matrix (GLCM) properties each patch}
\PYG{k+kn}{from} \PYG{n+nn}{skimage}\PYG{n+nn}{.}\PYG{n+nn}{feature} \PYG{k+kn}{import} \PYG{n}{greycomatrix}\PYG{p}{,} \PYG{n}{greycoprops}
\PYG{k+kn}{from} \PYG{n+nn}{tqdm}\PYG{n+nn}{.}\PYG{n+nn}{notebook} \PYG{k+kn}{import} \PYG{n}{tqdm}
\PYG{n}{grayco\PYGZus{}prop\PYGZus{}list} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{contrast}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{dissimilarity}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{homogeneity}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{energy}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{correlation}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ASM}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}

\PYG{n}{prop\PYGZus{}imgs} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{p}{\PYGZcb{}}
\PYG{k}{for} \PYG{n}{c\PYGZus{}prop} \PYG{o+ow}{in} \PYG{n}{grayco\PYGZus{}prop\PYGZus{}list}\PYG{p}{:}
    \PYG{n}{prop\PYGZus{}imgs}\PYG{p}{[}\PYG{n}{c\PYGZus{}prop}\PYG{p}{]} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{zeros\PYGZus{}like}\PYG{p}{(}\PYG{n}{cortex\PYGZus{}img}\PYG{p}{,} \PYG{n}{dtype}\PYG{o}{=}\PYG{n}{np}\PYG{o}{.}\PYG{n}{float32}\PYG{p}{)}
\PYG{n}{score\PYGZus{}img} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{zeros\PYGZus{}like}\PYG{p}{(}\PYG{n}{cortex\PYGZus{}img}\PYG{p}{,} \PYG{n}{dtype}\PYG{o}{=}\PYG{n}{np}\PYG{o}{.}\PYG{n}{float32}\PYG{p}{)}
\PYG{n}{out\PYGZus{}df\PYGZus{}list} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{k}{for} \PYG{n}{patch\PYGZus{}idx} \PYG{o+ow}{in} \PYG{n}{np}\PYG{o}{.}\PYG{n}{unique}\PYG{p}{(}\PYG{n}{region\PYGZus{}labels}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{xx\PYGZus{}box}\PYG{p}{,} \PYG{n}{yy\PYGZus{}box} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{where}\PYG{p}{(}\PYG{n}{region\PYGZus{}labels} \PYG{o}{==} \PYG{n}{patch\PYGZus{}idx}\PYG{p}{)}

    \PYG{n}{glcm} \PYG{o}{=} \PYG{n}{greycomatrix}\PYG{p}{(}\PYG{n}{cortex\PYGZus{}img}\PYG{p}{[}\PYG{n}{xx\PYGZus{}box}\PYG{o}{.}\PYG{n}{min}\PYG{p}{(}\PYG{p}{)}\PYG{p}{:}\PYG{n}{xx\PYGZus{}box}\PYG{o}{.}\PYG{n}{max}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,}
                                   \PYG{n}{yy\PYGZus{}box}\PYG{o}{.}\PYG{n}{min}\PYG{p}{(}\PYG{p}{)}\PYG{p}{:}\PYG{n}{yy\PYGZus{}box}\PYG{o}{.}\PYG{n}{max}\PYG{p}{(}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,}
                        \PYG{p}{[}\PYG{l+m+mi}{5}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{l+m+mi}{256}\PYG{p}{,} \PYG{n}{symmetric}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,} \PYG{n}{normed}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}

    \PYG{n}{mean\PYGZus{}score} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{n}{cortex\PYGZus{}mask}\PYG{p}{[}\PYG{n}{region\PYGZus{}labels} \PYG{o}{==} \PYG{n}{patch\PYGZus{}idx}\PYG{p}{]}\PYG{p}{)}
    \PYG{n}{score\PYGZus{}img}\PYG{p}{[}\PYG{n}{region\PYGZus{}labels} \PYG{o}{==} \PYG{n}{patch\PYGZus{}idx}\PYG{p}{]} \PYG{o}{=} \PYG{n}{mean\PYGZus{}score}

    \PYG{n}{out\PYGZus{}row} \PYG{o}{=} \PYG{n+nb}{dict}\PYG{p}{(}
        \PYG{n}{intensity\PYGZus{}mean}\PYG{o}{=}\PYG{n}{np}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{n}{cortex\PYGZus{}img}\PYG{p}{[}\PYG{n}{region\PYGZus{}labels} \PYG{o}{==} \PYG{n}{patch\PYGZus{}idx}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}
        \PYG{n}{intensity\PYGZus{}std}\PYG{o}{=}\PYG{n}{np}\PYG{o}{.}\PYG{n}{std}\PYG{p}{(}\PYG{n}{cortex\PYGZus{}img}\PYG{p}{[}\PYG{n}{region\PYGZus{}labels} \PYG{o}{==} \PYG{n}{patch\PYGZus{}idx}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}
        \PYG{n}{score}\PYG{o}{=}\PYG{n}{mean\PYGZus{}score}\PYG{p}{)}

    \PYG{k}{for} \PYG{n}{c\PYGZus{}prop} \PYG{o+ow}{in} \PYG{n}{grayco\PYGZus{}prop\PYGZus{}list}\PYG{p}{:}
        \PYG{n}{out\PYGZus{}row}\PYG{p}{[}\PYG{n}{c\PYGZus{}prop}\PYG{p}{]} \PYG{o}{=} \PYG{n}{greycoprops}\PYG{p}{(}\PYG{n}{glcm}\PYG{p}{,} \PYG{n}{c\PYGZus{}prop}\PYG{p}{)}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{]}
        \PYG{n}{prop\PYGZus{}imgs}\PYG{p}{[}\PYG{n}{c\PYGZus{}prop}\PYG{p}{]}\PYG{p}{[}\PYG{n}{region\PYGZus{}labels} \PYG{o}{==} \PYG{n}{patch\PYGZus{}idx}\PYG{p}{]} \PYG{o}{=} \PYG{n}{out\PYGZus{}row}\PYG{p}{[}\PYG{n}{c\PYGZus{}prop}\PYG{p}{]}

    \PYG{n}{out\PYGZus{}df\PYGZus{}list} \PYG{o}{+}\PYG{o}{=} \PYG{p}{[}\PYG{n}{out\PYGZus{}row}\PYG{p}{]}\PYG{p}{;}
\end{sphinxVerbatim}


\subsection{Resulting gray level co\sphinxhyphen{}occurrence properties}
\label{\detokenize{06-AdvancedShapeAndTexture:resulting-gray-level-co-occurrence-properties}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} show the slice and threshold}
\PYG{n}{fig}\PYG{p}{,} \PYG{n}{m\PYGZus{}axs} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{4}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{20}\PYG{p}{,} \PYG{l+m+mi}{10}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{n\PYGZus{}axs} \PYG{o}{=} \PYG{n}{m\PYGZus{}axs}\PYG{o}{.}\PYG{n}{flatten}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{ax1} \PYG{o}{=} \PYG{n}{n\PYGZus{}axs}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}
\PYG{n}{ax2} \PYG{o}{=} \PYG{n}{n\PYGZus{}axs}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}
\PYG{n}{ax1}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{n}{cortex\PYGZus{}img}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{gray}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax1}\PYG{o}{.}\PYG{n}{axis}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{off}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax1}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Image}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax2}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{n}{score\PYGZus{}img}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{gray}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax2}\PYG{o}{.}\PYG{n}{axis}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{off}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax2}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Regions}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{k}{for} \PYG{n}{c\PYGZus{}ax}\PYG{p}{,} \PYG{n}{c\PYGZus{}prop} \PYG{o+ow}{in} \PYG{n+nb}{zip}\PYG{p}{(}\PYG{n}{n\PYGZus{}axs}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{:}\PYG{p}{]}\PYG{p}{,} \PYG{n}{grayco\PYGZus{}prop\PYGZus{}list}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{c\PYGZus{}ax}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{n}{prop\PYGZus{}imgs}\PYG{p}{[}\PYG{n}{c\PYGZus{}prop}\PYG{p}{]}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{gray}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{c\PYGZus{}ax}\PYG{o}{.}\PYG{n}{axis}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{off}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{c\PYGZus{}ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+si}{\PYGZob{}\PYGZcb{}}\PYG{l+s+s1}{ Image}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{c\PYGZus{}prop}\PYG{p}{)}\PYG{p}{)}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{06-AdvancedShapeAndTexture_112_0}.png}


\subsection{Resulting gray level co\sphinxhyphen{}occurrence properties}
\label{\detokenize{06-AdvancedShapeAndTexture:id1}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{pandas} \PYG{k}{as} \PYG{n+nn}{pd}
\PYG{n}{out\PYGZus{}df} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{n}{out\PYGZus{}df\PYGZus{}list}\PYG{p}{)}
\PYG{n}{out\PYGZus{}df}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{positive\PYGZus{}score}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{out\PYGZus{}df}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{score}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{map}\PYG{p}{(}
    \PYG{k}{lambda} \PYG{n}{x}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{FG}\PYG{l+s+s1}{\PYGZsq{}} \PYG{k}{if} \PYG{n}{x} \PYG{o}{\PYGZgt{}} \PYG{l+m+mi}{0} \PYG{k}{else} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{BG}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{out\PYGZus{}df}\PYG{o}{.}\PYG{n}{describe}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
       intensity\PYGZus{}mean  intensity\PYGZus{}std      score      contrast  dissimilarity  \PYGZbs{}
count       99.000000      99.000000  99.000000     99.000000      99.000000   
mean        61.214533      28.922878   0.159290    888.349768      15.933864   
std         32.747924      20.736974   0.310034   1736.226189      10.016607   
min          1.274123       3.241296   0.000000     14.721364       1.666023   
25\PYGZpc{}         39.180681      14.174057   0.000000    249.179078      11.847264   
50\PYGZpc{}         62.908854      20.017975   0.000000    334.321682      13.734549   
75\PYGZpc{}         80.434896      35.653407   0.078170    779.776342      18.028875   
max        131.299479      94.529072   1.000000  13619.651391      82.260229   

       homogeneity     energy  correlation        ASM  
count    99.000000  99.000000    99.000000  99.000000  
mean      0.179556   0.128972     0.468967   0.045523  
std       0.173307   0.170833     0.268096   0.096791  
min       0.033100   0.019123    \PYGZhy{}0.094922   0.000366  
25\PYGZpc{}       0.070740   0.025010     0.247538   0.000626  
50\PYGZpc{}       0.082297   0.030073     0.504085   0.000904  
75\PYGZpc{}       0.250455   0.191400     0.677313   0.036697  
max       0.718922   0.651809     0.958805   0.424854  
\end{sphinxVerbatim}


\subsection{A pair plot to show how the properties are related}
\label{\detokenize{06-AdvancedShapeAndTexture:a-pair-plot-to-show-how-the-properties-are-related}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{sns}\PYG{o}{.}\PYG{n}{pairplot}\PYG{p}{(}\PYG{n}{out\PYGZus{}df}\PYG{p}{,} \PYG{n}{hue}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{positive\PYGZus{}score}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{kind}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{reg}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
/Users/kaestner/opt/anaconda3/lib/python3.8/site\PYGZhy{}packages/seaborn/distributions.py:305: UserWarning:

Dataset has 0 variance; skipping density estimate.
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{06-AdvancedShapeAndTexture_116_1}.png}


\chapter{Summary}
\label{\detokenize{06-AdvancedShapeAndTexture:summary}}

\section{Distance maps}
\label{\detokenize{06-AdvancedShapeAndTexture:distance-maps}}\begin{itemize}
\item {} 
\sphinxAtStartPar
Definition

\item {} 
\sphinxAtStartPar
Importance of neighborhood

\item {} 
\sphinxAtStartPar
Thickness/Pore radius map

\end{itemize}


\section{Visualizing 3D data}
\label{\detokenize{06-AdvancedShapeAndTexture:visualizing-3d-data}}\begin{itemize}
\item {} 
\sphinxAtStartPar
Meshes

\item {} 
\sphinxAtStartPar
Surfaces

\item {} 
\sphinxAtStartPar
Tools in python

\end{itemize}


\section{Surface description}
\label{\detokenize{06-AdvancedShapeAndTexture:surface-description}}\begin{itemize}
\item {} 
\sphinxAtStartPar
Curvatures

\end{itemize}


\section{Texture}
\label{\detokenize{06-AdvancedShapeAndTexture:texture}}\begin{itemize}
\item {} 
\sphinxAtStartPar
Textures are patterns in images

\item {} 
\sphinxAtStartPar
Measure texture characteristics

\end{itemize}







\renewcommand{\indexname}{Index}
\printindex
\end{document}